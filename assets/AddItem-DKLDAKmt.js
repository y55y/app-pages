import{P as m,r as u,j as e,I as q,as as O,B as t,G as a,m as E,n as v,$ as _,a0 as $}from"./index-CueZ4Wa3.js";import{I as M}from"./InputFileUpload-BL2SYyQB.js";import{c as U}from"./item-DSwFOboM.js";import{A as g}from"./AutocompleteSearch-CVjOnPg0.js";import{D as G,a as Q,b as H}from"./DialogContent-yIpzZ0TU.js";import{D as V}from"./DialogTitle-Ch6mwdU1.js";import{T as n}from"./TextField-uODX9c0x.js";import{T as J,a as k}from"./Tabs-D8iMM4qa.js";import"./formik.esm-BVQIQPwy.js";import"./CardMedia-BFSmWoNi.js";import"./Delete-DgApnwFx.js";import"./FormHelperText-DN8iqFKU.js";import"./Search-6_vXAUh5.js";import"./fetchdata-Dv3niiQS.js";import"./Autocomplete-DOICnJc7.js";import"./InputAdornment-CtuQ4nhT.js";import"./CircularProgress-JslihfJ8.js";import"./KeyboardArrowRight-Aqaw--QZ.js";const D=({children:h,value:l,index:c,...o})=>e.jsx("div",{role:"tabpanel",hidden:l!==c,id:`tabpanel-${c}`,"aria-labelledby":`tab-${c}`,...o,children:l===c&&e.jsx(t,{sx:{p:3},children:h})});D.propTypes={children:m.node,value:m.any.isRequired,index:m.any.isRequired};const K=({open:h,onClose:l,onAddItem:c})=>{const[o,d]=u.useState({ID:"",ItemLookupCode:"",BarCodeNo:"",Name:"",Description:"",Notes:"",Cost:"",Price:"",salePrice:"",Quantity:"",DepartmentID:"",CategoryID:"",SupplierID:"",StoreID:0,image_base64:null}),[R,b]=u.useState(!1),[T,C]=u.useState(""),[W,f]=u.useState("success"),[I,N]=u.useState({}),[j,P]=u.useState(0),B=s=>{d(r=>({...r,SupplierID:s?s.ID:""}))},w=s=>{d(r=>({...r,CategoryID:s?s.ID:""}))},z=s=>{d(r=>({...r,StoreID:s?s.ID:""}))},i=s=>{const{name:r,value:p}=s.target;d(x=>({...x,[r]:p})),r==="DepartmentID"&&d(x=>({...x,CategoryID:""}))},A=s=>{const r=new FileReader;r.onload=()=>{const p=r.result.split(",")[1];d(x=>({...x,image_base64:p}))},r.onerror=p=>{console.error("FileReader error:",p)},r.readAsDataURL(s)},F=async s=>{s.preventDefault();try{const r=await U(o);r&&r.ItemID?(c(r),d({ID:"",ItemLookupCode:"",BarCodeNo:"",Name:"",Description:"",Notes:"",Cost:"",Price:"",salePrice:"",Quantity:"",DepartmentID:"",CategoryID:"",SupplierID:"",image_base64:null}),N({}),l()):(f("error"),C("Unexpected error: Item ID missing in response."),b(!0))}catch(r){console.error("Error creating item:",r.response?r.response.data:r.message),f("error"),C("Failed to save item. Please try again."),b(!0)}},S=()=>{b(!1)},y=s=>({error:!!I[s],helperText:I[s]?"This field is required":""}),L=(s,r)=>{P(r)};return e.jsxs(G,{open:h,onClose:l,fullWidth:!0,maxWidth:"md",sx:{"& .MuiDialog-paper":{maxWidth:"80%",width:"80%"}},children:[e.jsxs(V,{children:["اضف منتج جديد",e.jsx(q,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(O,{})})]}),e.jsx(Q,{children:e.jsx(t,{sx:{p:2.5},children:e.jsxs(a,{container:!0,spacing:E,children:[e.jsx(a,{item:!0,xs:6,children:e.jsxs(t,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(t,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"الرئيسية"}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:8,children:e.jsx(n,{fullWidth:!0,label:"اسم المنتج",name:"Name",value:o.Name,onChange:i,size:"small",required:!0,...y("Name")})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(n,{fullWidth:!0,label:"رقم المنتج",name:"BarCodeNo",value:o.BarCodeNo,onChange:i,size:"small"})})]})]})}),e.jsx(a,{item:!0,xs:6,children:e.jsxs(t,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(t,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"الاسعار"}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(n,{fullWidth:!0,label:"التكلفة",name:"Cost",value:o.Cost,onChange:i,size:"small"})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(n,{fullWidth:!0,label:"سعر البيع",name:"Price",value:o.Price,onChange:i,size:"small",required:!0,...y("Price")})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(n,{fullWidth:!0,label:"سعر التخفيض",name:"salePrice",value:o.salePrice,onChange:i,size:"small"})})]})]})}),e.jsx(a,{item:!0,xs:6,children:e.jsxs(t,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(t,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"المورد"}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(g,{placeholder:"بحث عن المورد",noOptionsText:"لا يوجد موردين",onOptionSelect:B,type:"Supplier"})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(n,{fullWidth:!0,label:"كود المنتج",name:"ItemLookupCode",value:o.ItemLookupCode,onChange:i,size:"small"})})]})]})}),e.jsx(a,{item:!0,xs:6,children:e.jsxs(t,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(t,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"التصنيفات"}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(g,{onOptionSelect:z,placeholder:"ابحث عن مخزن",type:"Store",LoadAllData:!0})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(g,{onOptionSelect:w,placeholder:"ابحث عن تصنيف",type:"Category",getOptionLabel:s=>`${s.Name}`,LoadAllData:!0})})]})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(t,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsxs(J,{value:j,onChange:L,"aria-label":"Description and Image Tabs",children:[e.jsx(k,{label:"الوصف",id:"tab-0","aria-controls":"tabpanel-0"}),e.jsx(k,{label:"الصورة",id:"tab-1","aria-controls":"tabpanel-1"})]}),e.jsxs(D,{value:j,index:0,children:[e.jsx(n,{fullWidth:!0,label:"وصف",multiline:!0,rows:2,name:"Description",value:o.Description,onChange:i}),e.jsx(n,{fullWidth:!0,label:"ملاحظات",multiline:!0,rows:2,name:"Notes",value:o.Notes,onChange:i,sx:{mt:2}})]}),e.jsx(D,{value:j,index:1,children:e.jsx(t,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e.jsx(M,{handleFileSelect:A})})})]})})]})})}),e.jsxs(H,{children:[e.jsx(v,{onClick:l,color:"secondary",children:"إغلاق"}),e.jsx(v,{variant:"contained",size:"large",onClick:F,children:"حفظ"})]}),e.jsx(_,{open:R,autoHideDuration:4e3,onClose:S,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx($,{onClose:S,severity:W,sx:{width:"100%"},children:T})})]})};K.propTypes={open:m.bool.isRequired,onClose:m.func.isRequired};export{K as default};
