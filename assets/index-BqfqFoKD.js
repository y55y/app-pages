import{O as w,K as q,N as $,r as i,j as e,M as G,B as b,G as a,I as R,D as v,S as K,ay as C,n as S,z as _}from"./index-CK2eHZDS.js";import{d as H,A as J}from"./AdapterDayjs-DckWbV4k.js";import{d as Q}from"./PaymentTitle-B8T3sgaM.js";import{g as U,s as X,c as Y}from"./payment-KmgVbcvK.js";import{T as m,S as M}from"./TextField--NRucxkR.js";import{I as Z}from"./InputAdornment-B3MGI1qD.js";import{A as N}from"./Autocomplete-DwoJzscJ.js";import{L as V,D as ee}from"./DatePicker-CWdWvRtF.js";import{a as z,I as A}from"./FormHelperText-DhsFkHK6.js";import{M as L}from"./MenuItem-CGopNoQ2.js";import{C as te}from"./CardActions-BKL2b1Gz.js";import"./DialogContent-B6RC-5yg.js";import"./ListItem-D-HS7Szc.js";const xe=()=>{const{id:o}=w();q();const O=$(),[x,P]=i.useState(H()),[p,f]=i.useState(""),[h,W]=i.useState([]),[j,F]=i.useState([]),[I,T]=i.useState([]),[g,k]=i.useState([]),[s,d]=i.useState({sandNo:p,amount:"",SandType:o,reference:"",note:"",clientID:"",paymentMethod:"",safe:"",comment:"",account:"",transactions:[]}),[l,D]=i.useState({});i.useEffect(()=>{(async()=>{try{const r=await U(o);f(r.nextSandNo)}catch(r){console.error("Failed to fetch new رقم السند:",r)}})(),(async()=>{let r=[];try{const c=await X();r=c.safes.filter(y=>parseInt(o)===1||parseInt(o)===2?!y.isBank:y.isBank),W(r),F(c.paymentMethods),T(c.AccList),k(c.ClientList)}catch(c){console.error("Failed to fetch safes:",c)}console.log(r),r.length>0&&d(c=>({...c,safe:r[0].safeID,paymentMethod:r[0].safePD}))})()},[]);const u=t=>{d({...s,[t.target.name]:t.target.value}),t.target.name==="amount"&&l.amount&&D({...l,amount:""})},B=()=>{const t={};return s.amount||(t.amount="المبلغ المستلم مطلوب"),s.safe||(t.safe="الصندوق مطلوب"),s.paymentMethod||(t.paymentMethod="طريقة الدفع مطلوبة"),s.account||(t.account="الحساب مطلوب"),t},E=async t=>{t.preventDefault();const n=B();if(Object.keys(n).length>0)D(n);else try{const r={...s,sandNo:p,date:x.toISOString()};await Y(r),O(`/apps/invoice/payment/list/${o}`)}catch(r){console.error("Error creating new payment:",r)}};return e.jsx(G,{children:e.jsxs("form",{onSubmit:E,children:[e.jsx(b,{sx:{p:2.5},children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:6,md:6,children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,label:"المبلغ",id:"amount",name:"amount",size:"small",value:s.amount,onChange:u,error:!!l.amount,helperText:l.amount,sx:{"& .MuiOutlinedInput-input":{fontSize:"xx-large"}},InputProps:{endAdornment:e.jsx(Z,{position:"end",children:e.jsx(R,{onClick:()=>d({...s,amount:"0.00"}),children:e.jsx(Q,{})})})}})}),e.jsx(a,{item:!0,xs:8,children:e.jsx(N,{fullWidth:!0,id:"account-autocomplete",options:I,getOptionLabel:t=>`${t.AccID} - ${t.AccName}`,renderInput:t=>e.jsx(m,{...t,label:"الحساب",size:"small",required:!0,error:!!l.account,helperText:l.account}),value:I.find(t=>t.AccID===s.account)||null,onChange:(t,n)=>{d({...s,account:n?n.AccID:""})},noOptionsText:"لا يوجد حسابات مضافة"})}),e.jsx(a,{item:!0,xs:4,children:e.jsx(N,{id:"autocomplete-client",options:g,getOptionLabel:t=>t?t.ClientName:"",renderInput:t=>e.jsx(m,{...t,label:parseInt(o)===2||parseInt(o)===3?"المورد":"العميل",size:"small"}),value:g.find(t=>t.ClientID===s.clientID)||null,onChange:(t,n)=>{d({...s,clientID:n?n.ClientID:"",account:n&&n.accNo?n.accNo:""})},isOptionEqualToValue:(t,n)=>t.ClientID===n.ClientID,noOptionsText:"لا يوجد عملاء مضافين"})}),e.jsx(a,{item:!0,xs:8,children:e.jsx(m,{fullWidth:!0,label:parseInt(o)===2||parseInt(o)===3?"المستلم":"وذلك مقابل",id:"comment",name:"comment",size:"small",value:s.comment,onChange:u})}),e.jsx(a,{item:!0,xs:4,children:e.jsx(m,{fullWidth:!0,label:"المرجع",id:"reference",name:"reference",size:"small",value:s.reference,onChange:u})})]})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"رقم السند",id:"receiptID",name:"receiptID",size:"small",value:p,required:!0,onChange:t=>f(t.target.value)})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(V,{dateAdapter:J,children:e.jsx(ee,{slotProps:{textField:{fullWidth:!0,size:"small"}},label:"التاريخ",value:x,onChange:t=>P(t)})})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(z,{fullWidth:!0,children:[e.jsxs(A,{id:"box-select-label",size:"small",children:[parseInt(o)===1||parseInt(o)===2?"الصندوق":"البنك"," "]}),e.jsx(M,{labelId:"box-select-label",label:parseInt(o)===1||parseInt(o)===2?"الصندوق":"البنك",size:"small",name:"safe",value:s.safe||(h.length>0?h[0].safeID:""),onChange:u,error:!!l.safe,children:h.map(t=>e.jsx(L,{value:t.safeID,children:t.safeName},t.safeID))})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(A,{id:"payment-method-label",size:"small",children:"طريقة الدفع"}),e.jsx(M,{labelId:"payment-method-label",label:"طريقة الدفع",size:"small",name:"paymentMethod",value:s.paymentMethod||(j.length>0?h[0].safePD:""),onChange:u,error:!!l.paymentMethod,children:j.map(t=>e.jsx(L,{value:t.paymentMethodID,children:t.paymentMethodName},t.paymentMethodID))})]})})]})})]})}),e.jsx(v,{}),e.jsx(b,{sx:{p:2.5},children:e.jsx(m,{fullWidth:!0,multiline:!0,rows:2,label:"ملاحظات",id:"note",name:"note",value:s.note,onChange:u})}),e.jsx(v,{}),e.jsx(te,{sx:{justifyContent:"flex-end"},children:e.jsxs(K,{direction:"row",spacing:1.5,children:[e.jsx(C,{children:e.jsx(S,{variant:"contained",size:"large",type:"submit",children:"حفظ"})}),e.jsx(C,{children:e.jsx(S,{variant:"outlined",component:_,to:"/apps/invoice/payment/list",size:"large",children:"الغاء"})})]})})]})})};export{xe as default};
