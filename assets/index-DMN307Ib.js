import{r as l,j as e,B as b,n as W,bM as J,bN as U,bO as X,I as V,as as Y,k as H,D as se,$ as Z,a0 as ee,bP as re,bQ as ne,R as ae,bR as le}from"./index-CK2eHZDS.js";import{g as Q}from"./fetchdata-7caSym0v.js";import{B as ie}from"./index-DSVdJgwI.js";import"./SubCard-CzQO0sgK.js";import"./index-B-q1d0Qz.js";import{D as M,a as q,b as z}from"./DialogContent-B6RC-5yg.js";import{D as B}from"./DialogTitle-Do-b2gQd.js";import{T as v}from"./TextField--NRucxkR.js";import{A as _}from"./Autocomplete-DwoJzscJ.js";import{C as K}from"./CircularProgress-CbH74Q3r.js";import{D as te}from"./DialogContentText-BTgKtHs8.js";import{d as ce,A as ue,a as de}from"./ag-theme-alpine-DnlVQJ0Z.js";import{d as Ce}from"./Delete-nHBTa-3K.js";import{s as me}from"./payment-KmgVbcvK.js";import{D as he}from"./DataGrid-BEzGpxqb.js";import"./Search-BXw6LGI1.js";import"./InputAdornment-B3MGI1qD.js";import"./FormHelperText-DhsFkHK6.js";import"./MenuItem-CGopNoQ2.js";import"./MessageSnackbar-CYglifX9.js";import"./typeof-QjJsDpFa.js";import"./Checkbox-CKFEckdw.js";import"./Skeleton-DhBIoPx7.js";import"./TablePagination-0KQBaQp2.js";import"./KeyboardArrowRight-CmUX_fuU.js";import"./TableCell-BJINaop2.js";import"./FormControlLabel-Bwr4sx4_.js";const fe=({open:y,onClose:g,addType:d=1,rows:k,selectedRowId:A,mainAccounts:C})=>{const[t,r]=l.useState({Name:"",CostNote:"",CostID:"",mainAccount:null,accountType:1,CostCode:""}),[i,D]=l.useState({}),[E,w]=l.useState(!1);l.useEffect(()=>{r(o=>({...o,Name:"",CostNote:""}))},[y]),l.useEffect(()=>{const o=C.find(c=>c.CostID===A);o&&j("mainAccount")(null,o)},[A,C]);const S=o=>{if(!o){r(n=>({...n,CostID:"",accountType:1}));return}const c=o.AccD?1:0,h=d===1?C.filter(n=>n.Father===o.CostID):k.filter(n=>n.Father===o.CostID);let N;h.length>0?N=(Math.max(...h.map(a=>parseInt(a.CostID)))+1).toString():N=o.CostID+(d===1?"01":"001"),r(n=>({...n,CostID:N,accountType:c}))},j=o=>(c,h)=>{o==="mainAccount"?(r({...t,mainAccount:h}),S(h)):r(o==="accountType"?{...t,accountType:parseInt(c.target.value)}:{...t,[o]:c.target.value}),D({...i,[o]:""})},I=async()=>{const o={};if(t.Name.trim()||(o.Name="اسم مركز التكلفة مطلوب"),t.CostID.trim()||(o.CostID="رقم مركز التكلفة مطلوب"),!t.mainAccount&&d!==1&&(o.mainAccount="مركز التكلفة الرئيسي مطلوب"),Object.keys(o).length>0){D(o);return}w(!0);try{const c={CostID:t.CostID,CostType:d,CostName:t.Name,Father:t.mainAccount?t.mainAccount.CostID:0,AccD:t.accountType,CostNote:t.CostNote,CostCode:t.CostCode};await J(c),g()}catch(c){console.error("Error submitting form:",c)}finally{w(!1)}};return e.jsxs(M,{open:y,onClose:g,maxWidth:"sm",fullWidth:!0,children:[e.jsx(B,{children:d===1?"اضافة مركز تكلفة رئيسي":"اضافة مركز تكلفة"}),e.jsx(q,{children:e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"اسم مركز التكلفة",value:t.Name,onChange:j("Name"),fullWidth:!0,required:!0,margin:"normal",error:!!i.Name,helperText:i.Name}),e.jsx(v,{label:"رقم المرجع",value:t.CostCode,onChange:j("CostCode"),type:"number",fullWidth:!0,margin:"normal",error:!!i.CostCode,helperText:i.CostCode}),e.jsx(v,{label:"ملاحظات",value:t.CostNote,onChange:j("CostNote"),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]}),e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"رقم مركز تكلفة",value:t.CostID,onChange:j("CostID"),type:"number",fullWidth:!0,required:!0,margin:"normal",error:!!i.CostID,helperText:i.CostID}),e.jsx(_,{options:C,getOptionLabel:o=>`${o.CostID} - ${o.Name}`,value:t.mainAccount||null,onChange:(o,c)=>{j("mainAccount")(o,c),c||r(h=>({...h,mainAccount:null}))},renderInput:o=>e.jsx(v,{...o,label:"مركز التكلفة الرئيسي",margin:"normal",required:d!==1,error:!!i.mainAccount,helperText:i.mainAccount}),renderOption:(o,c)=>e.jsx("li",{...o,children:`${c.CostID} - ${c.Name}`}),fullWidth:!0})]})]})}),e.jsxs(z,{children:[e.jsx(W,{onClick:g,color:"secondary",children:"إلغاء"}),e.jsx(W,{onClick:I,color:"primary",variant:"contained",disabled:E,children:E?e.jsxs(e.Fragment,{children:["قيد الاضافة",e.jsx(K,{size:24,sx:{ml:1}})]}):"إضافة مركز تكلفة"})]})]})},xe=({open:y,onClose:g,editType:d=1,rows:k,selectedRowId:A,mainAccounts:C})=>{const[t,r]=l.useState({Name:"",CostNote:"",CostID:"",mainAccount:null,accountType:1,CostCode:""}),[i,D]=l.useState({}),[E,w]=l.useState(!1),[S,j]=l.useState(!1);l.useEffect(()=>{if(A){const n=d===1?C.find(a=>a.CostID===A):k.find(a=>a.CostID===A);n&&r({Name:n.Name,CostNote:n.CostNote||"",CostID:n.CostID,mainAccount:C.find(a=>a.CostID===n.Father)||null,accountType:n.AccD?1:0,CostCode:n.CostCode||""})}},[A,C]);const I=()=>{j(!0)},o=async()=>{w(!0);try{const n={CostID:t.CostID,CostType:d};await U(n),g()}catch(n){console.error("Error deleting account:",n)}finally{w(!1),j(!1)}},c=()=>{j(!1)},h=n=>(a,f)=>{r(n==="mainAccount"?{...t,mainAccount:f}:n==="accountType"?{...t,accountType:parseInt(a.target.value)}:{...t,[n]:a.target.value}),D({...i,[n]:""})},N=async()=>{const n={};if(t.Name.trim()||(n.Name="اسم مركز التكلفة مطلوب"),String(t.CostID).trim()||(n.CostID="رقم مركز التكلفة مطلوب"),!t.mainAccount&d!==1&&(n.mainAccount="مركز التكلفة الرئيسي مطلوب"),Object.keys(n).length>0){D(n);return}w(!0);try{const a={CostID:t.CostID,CostType:d,CostName:t.Name,Father:t.mainAccount?t.mainAccount.CostID:0,AccD:t.accountType,CostNote:t.CostNote,CostCode:t.CostCode};await X(a),g()}catch(a){console.error("Error updating form:",a)}finally{w(!1)}};return e.jsxs(M,{open:y,onClose:g,maxWidth:"sm",fullWidth:!0,children:[e.jsx(B,{children:d===1?"تعديل مركز تكلفة رئيسي":"تعديل مركز التكلفة"}),e.jsx(q,{children:e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"اسم مركز تكلفة",value:t.Name,onChange:h("Name"),fullWidth:!0,required:!0,margin:"normal",error:!!i.Name,helperText:i.Name}),e.jsx(v,{label:"رقم المرجع",value:t.CostCode,onChange:h("CostCode"),type:"number",fullWidth:!0,margin:"normal",error:!!i.CostCode,helperText:i.CostCode}),e.jsx(v,{label:"ملاحظات",value:t.CostNote,onChange:h("CostNote"),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]}),e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"رقم مركز التكلفة",value:t.CostID,onChange:h("CostID"),type:"number",fullWidth:!0,required:!0,margin:"normal",error:!!i.CostID,helperText:i.CostID,disabled:!0}),e.jsx(_,{options:C.filter(n=>{const a=n.CostID!==t.CostID,f=R=>{if(R.Father===t.CostID)return!1;const s=C.find(u=>u.CostID===R.Father);return s?f(s):!0};return a&&f(n)}),getOptionLabel:n=>`${n.CostID} - ${n.Name}`,value:t.mainAccount||null,onChange:h("mainAccount"),renderInput:n=>e.jsx(v,{...n,label:"مركز التكلفة الرئيسي",margin:"normal",required:d!==1,error:!!i.mainAccount,helperText:i.mainAccount}),fullWidth:!0})]})]})}),e.jsxs(z,{children:[e.jsx(W,{onClick:I,color:"error",variant:"outlined",disabled:E,children:"حذف"}),e.jsx(b,{sx:{flexGrow:1}}),e.jsx(W,{onClick:g,color:"secondary",children:"إلغاء"}),e.jsx(W,{onClick:N,color:"primary",variant:"contained",disabled:E,children:E?e.jsxs(e.Fragment,{children:["قيد الحفظ",e.jsx(K,{size:24,sx:{ml:1}})]}):"حفظ التغييرات"})]}),e.jsxs(M,{open:S,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(B,{id:"alert-dialog-title",children:"تأكيد الحذف"}),e.jsx(q,{children:e.jsx(te,{id:"alert-dialog-description",children:"هل أنت متأكد من حذف مركز التكلفة؟"})}),e.jsxs(z,{children:[e.jsx(W,{onClick:c,children:"إلغاء"}),e.jsx(W,{onClick:o,autoFocus:!0,children:"تأكيد"})]})]})]})},pe=({open:y,onClose:g,addType:d=2,rows:k,selectedRowId:A,mainAccounts:C})=>{const[t,r]=l.useState({Name:"",CostNote:"",CostID:"",mainAccount:null,accountType:1,CostCode:""}),[i,D]=l.useState({}),[E,w]=l.useState(!1);l.useEffect(()=>{r(o=>({...o,Name:"",CostNote:""}))},[y]),l.useEffect(()=>{const o=C.find(c=>c.CostID===A);o&&j("mainAccount")(null,o)},[A,C]);const S=o=>{if(!o){r(n=>({...n,CostID:"",accountType:1}));return}const c=o.AccD?1:0,h=d===1?C.filter(n=>n.Father===o.CostID):k.filter(n=>n.Father===o.CostID);let N;h.length>0?N=(Math.max(...h.map(a=>parseInt(a.CostID)))+1).toString():N=o.CostID+(d===1?"01":"001"),r(n=>({...n,CostID:N,accountType:c}))},j=o=>(c,h)=>{o==="mainAccount"?(r({...t,mainAccount:h}),S(h)):r(o==="accountType"?{...t,accountType:parseInt(c.target.value)}:{...t,[o]:c.target.value}),D({...i,[o]:""})},I=async()=>{const o={};if(t.Name.trim()||(o.Name="اسم مركز التكلفة مطلوب"),t.CostID.trim()||(o.CostID="رقم مركز التكلفة مطلوب"),!t.mainAccount&&d!==1&&(o.mainAccount="مركز التكلفة الرئيسي مطلوب"),Object.keys(o).length>0){D(o);return}w(!0);try{const c={CostID:t.CostID,CostType:d,CostName:t.Name,Father:t.mainAccount?t.mainAccount.CostID:0,AccD:t.accountType,CostNote:t.CostNote,CostCode:t.CostCode};await J(c),g()}catch(c){console.error("Error submitting form:",c)}finally{w(!1)}};return e.jsxs(M,{open:y,onClose:g,maxWidth:"sm",fullWidth:!0,children:[e.jsx(B,{children:d===1?"اضافة مركز تكلفة رئيسي":"اضافة مركز تكلفة"}),e.jsx(q,{children:e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"اسم مركز التكلفة",value:t.Name,onChange:j("Name"),fullWidth:!0,required:!0,margin:"normal",error:!!i.Name,helperText:i.Name}),e.jsx(v,{label:"رقم المرجع",value:t.CostCode,onChange:j("CostCode"),type:"number",fullWidth:!0,margin:"normal",error:!!i.CostCode,helperText:i.CostCode}),e.jsx(v,{label:"ملاحظات",value:t.CostNote,onChange:j("CostNote"),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]}),e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"رقم مركز تكلفة",value:t.CostID,onChange:j("CostID"),type:"number",fullWidth:!0,required:!0,margin:"normal",error:!!i.CostID,helperText:i.CostID}),e.jsx(_,{options:C,getOptionLabel:o=>`${o.CostID} - ${o.Name}`,value:t.mainAccount||null,onChange:(o,c)=>{j("mainAccount")(o,c),c||r(h=>({...h,mainAccount:null}))},renderInput:o=>e.jsx(v,{...o,label:"مركز التكلفة الرئيسي",margin:"normal",required:d!==1,error:!!i.mainAccount,helperText:i.mainAccount}),renderOption:(o,c)=>e.jsx("li",{...o,children:`${c.CostID} - ${c.Name}`}),fullWidth:!0})]})]})}),e.jsxs(z,{children:[e.jsx(W,{onClick:g,color:"secondary",children:"إلغاء"}),e.jsx(W,{onClick:I,color:"primary",variant:"contained",disabled:E,children:E?e.jsxs(e.Fragment,{children:["قيد الاضافة",e.jsx(K,{size:24,sx:{ml:1}})]}):"إضافة مركز تكلفة"})]})]})},ge=({open:y,onClose:g,editType:d=2,rows:k,selectedRowId:A,mainAccounts:C,selectedSubRowId:t})=>{const[r,i]=l.useState({Name:"",CostNote:"",CostID:"",mainAccount:null,accountType:1,CostCode:""}),[D,E]=l.useState({}),[w,S]=l.useState(!1),[j,I]=l.useState(!1);l.useEffect(()=>{if(A){const a=d===1?C.find(f=>f.CostID===A):k.find(f=>f.CostID===t);a&&i({Name:a.Name,CostNote:a.CostNote||"",CostID:a.CostID,mainAccount:C.find(f=>f.CostID===a.Father)||null,accountType:a.AccD?1:0,CostCode:a.CostCode||""})}},[A,C,t]);const o=()=>{I(!0)},c=async()=>{S(!0);try{const a={CostID:r.CostID,CostType:d};await U(a),g()}catch(a){console.error("Error deleting account:",a)}finally{S(!1),I(!1)}},h=()=>{I(!1)},N=a=>(f,R)=>{i(a==="mainAccount"?{...r,mainAccount:R}:a==="accountType"?{...r,accountType:parseInt(f.target.value)}:{...r,[a]:f.target.value}),E({...D,[a]:""})},n=async()=>{const a={};if(r.Name.trim()||(a.Name="اسم مركز التكلفة مطلوب"),String(r.CostID).trim()||(a.CostID="رقم مركز التكلفة مطلوب"),!r.mainAccount&d!==1&&(a.mainAccount="مركز التكلفة الرئيسي مطلوب"),Object.keys(a).length>0){E(a);return}S(!0);try{const f={CostID:r.CostID,CostType:d,CostName:r.Name,Father:r.mainAccount?r.mainAccount.CostID:0,AccD:r.accountType,CostNote:r.CostNote,CostCode:r.CostCode};await X(f),g()}catch(f){console.error("Error updating form:",f)}finally{S(!1)}};return e.jsxs(M,{open:y,onClose:g,maxWidth:"sm",fullWidth:!0,children:[e.jsx(B,{children:d===1?"تعديل مركز تكلفة رئيسي":"تعديل مركز التكلفة"}),e.jsx(q,{children:e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"اسم مركز تكلفة",value:r.Name,onChange:N("Name"),fullWidth:!0,required:!0,margin:"normal",error:!!D.Name,helperText:D.Name}),e.jsx(v,{label:"رقم المرجع",value:r.CostCode,onChange:N("CostCode"),type:"number",fullWidth:!0,margin:"normal",error:!!D.CostCode,helperText:D.CostCode}),e.jsx(v,{label:"ملاحظات",value:r.CostNote,onChange:N("CostNote"),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]}),e.jsxs(b,{sx:{flex:1},children:[e.jsx(v,{label:"رقم مركز التكلفة",value:r.CostID,onChange:N("CostID"),type:"number",fullWidth:!0,required:!0,margin:"normal",error:!!D.CostID,helperText:D.CostID,disabled:!0}),e.jsx(_,{options:C.filter(a=>{const f=a.CostID!==r.CostID,R=s=>{if(s.Father===r.CostID)return!1;const u=C.find(p=>p.CostID===s.Father);return u?R(u):!0};return f&&R(a)}),getOptionLabel:a=>`${a.CostID} - ${a.Name}`,value:r.mainAccount||null,onChange:N("mainAccount"),renderInput:a=>e.jsx(v,{...a,label:"مركز التكلفة الرئيسي",margin:"normal",required:d!==1,error:!!D.mainAccount,helperText:D.mainAccount}),fullWidth:!0})]})]})}),e.jsxs(z,{children:[e.jsx(W,{onClick:o,color:"error",variant:"outlined",disabled:w,children:"حذف"}),e.jsx(b,{sx:{flexGrow:1}}),e.jsx(W,{onClick:g,color:"secondary",children:"إلغاء"}),e.jsx(W,{onClick:n,color:"primary",variant:"contained",disabled:w,children:w?e.jsxs(e.Fragment,{children:["قيد الحفظ",e.jsx(K,{size:24,sx:{ml:1}})]}):"حفظ التغييرات"})]}),e.jsxs(M,{open:j,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(B,{id:"alert-dialog-title",children:"تأكيد الحذف"}),e.jsx(q,{children:e.jsx(te,{id:"alert-dialog-description",children:"هل أنت متأكد من حذف مركز التكلفة؟"})}),e.jsxs(z,{children:[e.jsx(W,{onClick:h,children:"إلغاء"}),e.jsx(W,{onClick:c,autoFocus:!0,children:"تأكيد"})]})]})]})},De=({id:y,name:g,onClose:d,open:k,costCenters:A,acc:C,containData:t})=>{const[r,i]=l.useState([]),[D,E]=l.useState(null),[w,S]=l.useState(null),[j,I]=l.useState(!1);l.useEffect(()=>{k&&y&&g&&t!==!1?(async()=>{I(!0);try{const u=await re(y);Array.isArray(u.data)&&u.data.length>0?i(u.data.map(p=>({costCenter:p.CostC,percentage:p.pcnt,automatic:p.auto}))):u.message==="No entries found"?(i([]),console.log("No entries found, grid is ready for new data")):(console.error("Invalid data format received:",u),S("تم استلام بيانات بتنسيق غير صالح. يرجى المحاولة مرة أخرى."))}catch(u){console.error("Error fetching AccCost list:",u),S("حدث خطأ أثناء جلب قائمة مراكز التكلفة. يرجى المحاولة مرة أخرى.")}finally{I(!1)}})():i([])},[y,k,g,t]);const c=[{headerName:"مركز التكلفة",field:"costCenter",editable:!0,cellEditor:s=>{const[u,p]=l.useState(s.value||""),[O,P]=l.useState(null),F=ae.useRef(null);l.useEffect(()=>{F.current&&F.current.focus()},[]),l.useEffect(()=>{p(s.value||""),P(A.find(m=>m.CostID===s.value)||null)},[s.value]);const L=(m,T)=>{const $=T?T.CostID:"";p($),P(T),G($)},G=m=>{i(T=>{const $=[...T];return $[s.rowIndex]={...$[s.rowIndex],costCenter:m,percentage:$[s.rowIndex].percentage||0},$})},x=m=>{m.key==="Enter"&&(m.preventDefault(),s.api.stopEditing(),s.api.setFocusedCell(s.rowIndex,s.column))};return e.jsx(b,{sx:{display:"flex",alignItems:"center",width:"100%",minHeight:"110%"},children:e.jsx(_,{options:A,getOptionLabel:m=>`${m.CostID} - ${m.CostName}`,value:O,onChange:L,inputValue:u,onInputChange:(m,T)=>{p(T)},renderInput:m=>e.jsx(v,{...m,size:"small",fullWidth:!0,inputRef:F,onKeyDown:x,sx:{"& .MuiInputBase-root":{height:"100%"}}}),sx:{width:"100%",height:"100%"},disableClearable:!0})})},cellRenderer:s=>{if(s.value){const u=A.find(p=>p.CostID===s.value);return u?`${u.CostID} - ${u.CostName}`:s.value}return""},suppressKeyboardEvent:s=>!!(s.event.key==="Enter"&&s.editing)},{headerName:"النسبة",field:"percentage",editable:!0,flex:1,cellEditor:"numberCellEditor",valueParser:s=>{const u=parseFloat(s.newValue);return isNaN(u)?0:u},valueFormatter:s=>`${s.value.toFixed(2)}%`},{headerName:"تلقائي",field:"automatic",editable:!0,flex:1,cellEditor:"agSelectCellEditor",cellEditorParams:{values:["نعم","لا"]},valueGetter:s=>s.data.automatic?"نعم":"لا",valueSetter:s=>(s.data.automatic=s.newValue==="نعم",!0)},{headerName:"حذف",field:"delete",width:100,cellRenderer:s=>e.jsx(V,{onClick:()=>f(s.node.rowIndex),size:"small",sx:{color:"error.main"},children:e.jsx(Ce,{})})}],h=s=>{E(s.api)},N=l.useCallback((s,u,p)=>{const P=100-s.reduce((F,L,G)=>G===u?F:F+L.percentage,0);return p<=P?s.map((F,L)=>L===u?{...F,percentage:p}:F):s.map((F,L)=>L===u?{...F,percentage:P}:F)},[]),n=l.useCallback(s=>{if(s.column.colId==="percentage"){const u=parseFloat(s.newValue);if(isNaN(u)||u<0){s.api.undoCellEditing();return}const p=D.getModel().rowsToDisplay.map(P=>P.data),O=N(p,s.rowIndex,u);i(O)}},[D,N]),a=()=>{const s={costCenter:null,percentage:0,automatic:!0},u=[...r,s];i(u)},f=s=>{const u=r.filter((p,O)=>O!==s);i(u)},R=async()=>{try{let s=[],u=[];C&&C.length>0?(u=C.map(p=>p.id),s=r.map(p=>({ACC:y,CostC:p.costCenter,pcnt:p.percentage,auto:p.automatic?1:0}))):(s=r.map(p=>({ACC:y,CostC:p.costCenter,pcnt:p.percentage,auto:p.automatic?1:0})),u=[y]),await ne(s,u),d()}catch(s){console.error("Error saving AccCost entries:",s),S("حدث خطأ أثناء حفظ البيانات. يرجى المحاولة مرة أخرى.")}};return e.jsxs(M,{open:k,onClose:d,maxWidth:"md",fullWidth:!0,children:[e.jsxs(B,{children:[C&&C.length>0?"إدخال مراكز التكلفة لحسابات متعددة":"مراكز التكلفة",e.jsx(V,{"aria-label":"close",onClick:d,sx:{position:"absolute",right:8,top:8},children:e.jsx(Y,{})})]}),e.jsxs(q,{children:[C&&C.length>0?e.jsxs(b,{children:[e.jsx(H,{children:"سيتم إدخال مراكز التكلفة للحسابات التالية:"}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2},children:C.map(s=>e.jsx(b,{sx:{border:"1px solid #ccc",borderRadius:1,padding:1,backgroundColor:"#f5f5f5"},children:e.jsxs(H,{variant:"body2",children:[s.name," (",s.id,")"]})},s.id))})]}):e.jsx(b,{mb:2,sx:{backgroundColor:"#f5f5f5",padding:2,borderRadius:1},children:e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(H,{variant:"subtitle1",children:["اسم الحساب: ",e.jsx("span",{style:{fontWeight:"bold",color:"primary.main"},children:g})]}),e.jsxs(H,{variant:"subtitle1",children:["رقم الحساب: ",e.jsx("span",{style:{fontWeight:"bold",color:"primary.main"},children:y})]})]})}),e.jsxs(b,{children:[e.jsx(se,{sx:{my:2}}),e.jsx(b,{sx:{display:"flex",gap:"10px",marginBottom:"10px"},children:e.jsx(W,{startIcon:e.jsx(ce,{}),onClick:a,sx:{mr:1},children:"إضافة صف"})}),j?e.jsx(b,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(K,{})}):e.jsx("div",{className:"ag-theme-alpine",style:{height:300,width:"100%"},children:e.jsx(ue,{columnDefs:c,rowData:r,onGridReady:h,enableRtl:!0,rowSelection:"single",onCellValueChanged:n})}),e.jsx(W,{variant:"contained",color:"primary",onClick:R,children:"حفظ"})]}),e.jsx(Z,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:!!w,autoHideDuration:6e3,onClose:()=>S(null),children:e.jsx(ee,{onClose:()=>S(null),severity:"error",sx:{width:"100%"},children:w})})]})]})},oe=({open:y,onClose:g,isCostCAccList:d=!1})=>{var G;const[k,A]=l.useState([]),[C,t]=l.useState([]),[r,i]=l.useState([]),[D,E]=l.useState(""),[w,S]=l.useState(!1),[j,I]=l.useState(null),[o,c]=l.useState([]),[h,N]=l.useState(!1),[n,a]=l.useState(null),[f,R]=l.useState([]),s=l.useCallback(async()=>{if(y)try{const x=await le(d);if(x&&x.data){const m=x.data.map(T=>({...T,id:T.AccID}));A(m),t(m),i(m.filter(T=>T.isSelected))}else console.error("No data received from getIsCostCAccList")}catch(x){console.error("Error fetching accounts:",x),I("Failed to fetch accounts. Please try again.")}finally{S(!1)}},[y,d]);l.useEffect(()=>{S(!0),s()},[s]);const u=l.useCallback(async()=>{try{const x=await me(["CostCenter"]);c(x.CostCenter)}catch(x){console.error("Error fetching payment methods:",x)}},[]);l.useEffect(()=>{u()},[u]);const p=l.useCallback(x=>{const m=x.target.value.toLowerCase();E(m),t(k.filter(T=>T.AccName.toLowerCase().includes(m)||T.id.toString().includes(m)))},[k]),O=l.useCallback((x,m)=>{m.stopPropagation(),a(x),N(!0)},[]),P=l.useCallback(()=>{N(!1),a(null),R([]),s()},[]),F=l.useCallback(()=>{R(r.map(x=>({id:x.id,name:x.AccName}))),N(!0)},[r]),L=l.useMemo(()=>[{field:"id",headerName:"رقم الحساب",flex:1,minWidth:150},{field:"AccName",headerName:"اسم الحساب",flex:2,minWidth:200},{field:"edit",headerName:"تعديل",flex:.5,minWidth:80,renderCell:x=>e.jsx(V,{color:"primary",onClick:m=>O(x.row.id,m),children:e.jsx(de,{})})}],[O]);return e.jsxs(M,{open:y,onClose:g,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{width:"80%",maxWidth:"none"}},children:[e.jsxs(B,{children:[d?"حسابات مراكز تكلفة":"حسابات بدون مراكر تكلفه",e.jsx(V,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8},children:e.jsx(Y,{})})]}),e.jsxs(q,{children:[e.jsx(b,{mt:2,mb:4,children:e.jsx(v,{label:"البحث عن الحسابات",variant:"outlined",fullWidth:!0,value:D,onChange:p,sx:{marginBottom:2}})}),r.length>1&&e.jsx(b,{mt:2,display:"flex",justifyContent:"flex-start",children:e.jsx(W,{variant:"contained",color:"primary",onClick:F,children:"تعين مراكز تكلفة للحسابات"})}),w?e.jsx(b,{display:"flex",justifyContent:"center",alignItems:"center",height:300,children:e.jsx(K,{})}):e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(he,{rows:C,columns:L,checkboxSelection:!0,onRowSelectionModelChange:x=>{i(C.filter(m=>x.includes(m.id)))},rowSelectionModel:r.map(x=>x.id),onRowClick:x=>{i(m=>m.some($=>$.id===x.id)?m.filter($=>$.id!==x.id):[...m,x.row])}})}),e.jsx(Z,{open:!!j,autoHideDuration:6e3,onClose:()=>I(null),children:e.jsx(ee,{onClose:()=>I(null),severity:"error",children:j})}),e.jsx(De,{id:n,name:((G=C.find(x=>x.id===n))==null?void 0:G.AccName)||"",onClose:P,open:h,costCenters:o,acc:f,containData:d})]})]})},je=y=>e.jsx(oe,{...y,isCostCAccList:!0}),Qe=()=>{const[y,g]=l.useState([]),[d,k]=l.useState([]),[A,C]=l.useState(0),[t,r]=l.useState(!1),[i,D]=l.useState(0),E=[{text:"تقرير مراكز التكلفه",component:{},isDisabled:!1},{text:"حسابات بدون مراكز تكلفه",component:oe,isDisabled:!1},{text:"حسابات مراكز التكلفه",component:je,isDisabled:!1},{text:"حركة مراكز التكلفه",component:{},isDisabled:!1}],w=[{field:"Name",headerName:"العميل",flex:2,valueGetter:I=>`${I.row.CostID} - ${I.row.Name}`},{field:"MobileNumber",headerName:"رقم الجوال",flex:1},{field:"vat",headerName:"الرقم الضريبي",flex:1},{field:"Balance",headerName:"الرصيد",flex:1}],S=async()=>{try{const I=await Q("/api/accounting/costc/list/main",{});g(I)}catch(I){console.error("Error fetching client tree data:",I)}},j=async(I,o,c,h,N,n,a)=>{try{r(!0);const f=await Q("/api/accounting/costc/list/sub",{Father:I,page:o,pageSize:c,rowID:h,search:N,field:n,sort:a});r(!1),k(f.data),C(f.totalRows),f.page!==null&&D(f.page)}catch(f){console.error("Error fetching client tree data:",f),r(!1)}};return l.useEffect(()=>{S()},[]),e.jsx(ie,{mainData:y,rows:d,dataKey:"CostID",dataCode:"CostID",fetchTreeData:S,fetchSubTreeData:j,columns:w,apiSearchEndpoint:"/api/accounting/costc/search",PopupAddMain:fe,PopupEditMain:xe,AddEntityComponent:pe,EditEntityComponent:ge,rowCount:A,isLoading:t,entityName:"مركز تكلفة",mainName:"مجموعة",page:i,setPage:D,reportOptions:E})};export{Qe as default};
