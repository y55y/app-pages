import{O as w,r as d,j as e,I as O,as as P,B as m,G as l,m as f,D as $,n as L,$ as G,a0 as U}from"./index-CueZ4Wa3.js";import{D as q}from"./DeleteComponent-p0HKWr_n.js";import{b as H,u as _}from"./client-NqRsthxz.js";import{I as J}from"./InputFileUpload-BL2SYyQB.js";import{D as K,a as Q}from"./DialogContent-yIpzZ0TU.js";import{D as X}from"./DialogTitle-Ch6mwdU1.js";import{C as Y}from"./CircularProgress-JslihfJ8.js";import{T as Z,a as C}from"./Tabs-D8iMM4qa.js";import{T as i}from"./TextField-uODX9c0x.js";import{A as V}from"./Autocomplete-DOICnJc7.js";import"./fetchdata-Dv3niiQS.js";import"./MessageSnackbar-CSneSHnJ.js";import"./DialogContentText-6d9iZtp4.js";import"./formik.esm-BVQIQPwy.js";import"./CardMedia-BFSmWoNi.js";import"./Delete-DgApnwFx.js";import"./FormHelperText-DN8iqFKU.js";import"./KeyboardArrowRight-Aqaw--QZ.js";const N=({children:s,value:a,index:t,...u})=>e.jsx("div",{role:"tabpanel",hidden:a!==t,id:`tabpanel-${t}`,"aria-labelledby":`tab-${t}`,...u,children:a===t&&e.jsx(m,{sx:{p:3},children:s})}),ee=({formData:s,handleInputChange:a,errors:t,mainAccounts:u})=>e.jsxs(l,{container:!0,spacing:f,children:[e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(i,{fullWidth:!0,label:"رقم العميل",name:"code",value:s.code,onChange:a,error:!!t.id,helperText:t.id,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4.5,children:e.jsx(i,{fullWidth:!0,label:"اسم العميل",name:"Name",value:s.Name,onChange:a,error:!!t.Name,helperText:t.Name,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4.5,children:e.jsx(V,{fullWidth:!0,options:u,getOptionLabel:r=>`${r.Code} - ${r.Name}`,value:u.find(r=>r.ClientID===s.ClientMain)||null,onChange:(r,c)=>{a({target:{name:"ClientMain",value:c?c.ClientID:""}})},renderInput:r=>e.jsx(i,{...r,label:"تصنيف العميل",error:!!t.ClientMain,helperText:t.ClientMain,size:"small"})})})]}),te=({formData:s,handleInputChange:a,errors:t})=>e.jsxs(l,{container:!0,spacing:f,children:[e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"اسم الشركة",name:"company",value:s.company,onChange:a,error:!!t.company,helperText:t.company,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"العلامة التجارية",name:"brand",value:s.brand,onChange:a,error:!!t.brand,helperText:t.brand,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"رقم الهاتف",name:"mobileNumber",value:s.mobileNumber,onChange:a,error:!!t.mobileNumber,helperText:t.mobileNumber,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"الايميل",name:"emailAddress",value:s.emailAddress,onChange:a,error:!!t.emailAddress,helperText:t.emailAddress,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"الرقم الضريبي",name:"vat",value:s.vat,onChange:a,error:!!t.vat,helperText:t.vat,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"الرقم في المحاسبة",name:"accNo",value:s.accNo,onChange:a,error:!!t.accNo,helperText:t.accNo,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:12,children:e.jsx(i,{fullWidth:!0,label:"العنوان",name:"address",multiline:!0,value:s.address,onChange:a,error:!!t.address,helperText:t.address,size:"small"})})]}),ae=({formData:s,handleInputChange:a,errors:t})=>e.jsxs(l,{container:!0,spacing:f,children:[e.jsx(l,{item:!0,xs:12,sm:3,children:e.jsx(i,{fullWidth:!0,label:"الافتتاحي",name:"openingBalance",value:s.openingBalance,disabled:!0,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:3,children:e.jsx(i,{fullWidth:!0,label:"المبلغ",name:"credit",value:s.credit,onChange:a,error:!!t.credit,helperText:t.credit,disabled:!0,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:3,children:e.jsx(i,{fullWidth:!0,label:"المدفوع",name:"debit",value:s.debit,onChange:a,error:!!t.debit,helperText:t.debit,disabled:!0,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:3,children:e.jsx(i,{fullWidth:!0,label:"الرصيد",name:"Balance",value:s.balance,onChange:a,error:!!t.balance,helperText:t.balance,disabled:!0,size:"small"})})]}),le=({formData:s,handleInputChange:a,errors:t})=>e.jsxs(l,{container:!0,spacing:f,children:[e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"اسم الشخص",name:"contactName",value:s.contactName,onChange:a,error:!!t.contactName,helperText:t.contactName,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"رقم الشخص",name:"phoneNumber",value:s.phoneNumber,onChange:a,error:!!t.phoneNumber,helperText:t.phoneNumber,size:"small"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(i,{fullWidth:!0,label:"ايميل الشخص",name:"contactEmail",value:s.contactEmail,onChange:a,error:!!t.contactEmail,helperText:t.contactEmail,size:"small"})})]}),Ne=({selectedSubRowId:s,onClose:a,mainAccounts:t})=>{const u=w(),r=s||u.id,[c,y]=d.useState({id:"",Name:"",code:"",accNo:"",company:"",brand:"",mobileNumber:"",emailAddress:"",vat:"",address:"",notes:"",balance:"",credit:0,debit:0,openingBalance:0,ClientMain:"",contactName:"",phoneNumber:"",contactEmail:"",avatar:null}),[x,z]=d.useState({}),[S,h]=d.useState(!1),[k,g]=d.useState(""),[E,v]=d.useState("success"),[b,B]=d.useState(0),[F,T]=d.useState(!0);d.useEffect(()=>{(async()=>{T(!0);try{const o=await H(r);y(o)}catch(o){console.error("Error fetching client details:",o),v("error"),g("Failed to fetch client details. Please try again."),h(!0)}finally{T(!1)}})()},[r]);const p=n=>{const{name:o,value:j}=n.target;y({...c,[o]:j})},D=n=>{const o=new FileReader;o.onload=()=>{const j=o.result.split(",")[1];y(R=>({...R,avatar:j}))},o.onerror=j=>{console.error("FileReader error:",j)},o.readAsDataURL(n)},M=()=>{const n={};return c.Name||(n.Name="الاسم اجباري."),z(n),Object.keys(n).length===0},A=async()=>{if(!M()){v("error"),g("Please fill in all required fields."),h(!0);return}try{const n=await _(r,c);console.log("Client updated:",n),v("success"),g("Client updated successfully!"),h(!0),typeof a=="function"&&a()}catch(n){console.error("Error updating client:",n),v("error"),g("Failed to update client. Please try again."),h(!0)}},W=()=>{h(!1)},I=(n,o)=>{B(o)};return e.jsxs(K,{open,onClose:a,maxWidth:"md",fullWidth:!0,sx:{"& .MuiDialog-paper":{maxWidth:"80%",width:"80%"}},children:[e.jsxs(X,{children:["تعديل العميل",e.jsx(O,{"aria-label":"close",onClick:a,sx:{position:"absolute",right:8,top:8,color:n=>n.palette.grey[500]},children:e.jsx(P,{})})]}),e.jsxs(Q,{children:[F?e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:e.jsx(Y,{})}):e.jsxs(m,{sx:{p:2.5},children:[e.jsxs(l,{container:!0,spacing:f,children:[e.jsx(l,{item:!0,xs:12,sm:6,md:6,children:e.jsxs(m,{sx:{border:"1px solid #ccc",p:2,borderRadius:1,mb:2},children:[e.jsx(m,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"الرئيسية"}),e.jsx(ee,{formData:c,handleInputChange:p,errors:x,mainAccounts:t})]})}),e.jsx(l,{item:!0,xs:12,sm:6,md:6,children:e.jsxs(m,{sx:{border:"1px solid #ccc",p:2,borderRadius:1,mb:2},children:[e.jsx(m,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"الحساب"}),e.jsx(ae,{formData:c,handleInputChange:p,errors:x})]})}),e.jsx(l,{item:!0,xs:12,sm:6,md:12})]}),e.jsxs(Z,{value:b,onChange:I,"aria-label":"Client Information Tabs",children:[e.jsx(C,{label:"معلومات الشركة",id:"tab-0","aria-controls":"tabpanel-0"}),e.jsx(C,{label:"معلومات التواصل",id:"tab-1","aria-controls":"tabpanel-1"}),e.jsx(C,{label:"رفع صورة",id:"tab-2","aria-controls":"tabpanel-2"}),e.jsx(C,{label:"ملاحظات",id:"tab-3","aria-controls":"tabpanel-3"})]}),e.jsx(N,{value:b,index:0,children:e.jsx(te,{formData:c,handleInputChange:p,errors:x})}),e.jsx(N,{value:b,index:1,children:e.jsx(le,{formData:c,handleInputChange:p,errors:x})}),e.jsx(N,{value:b,index:2,children:e.jsx(J,{handleFileSelect:D})}),e.jsx(N,{value:b,index:3,children:e.jsx(i,{fullWidth:!0,label:"ملاحظات",name:"notes",multiline:!0,value:c.notes,onChange:p,error:!!x.notes,size:"small",helperText:x.notes})}),e.jsx($,{sx:{my:3}}),e.jsxs(l,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{item:!0,children:e.jsx(q,{resourceId:r,resource:"client",entityName:"العميل",onDelete:a})}),e.jsx(l,{item:!0,children:e.jsx(L,{variant:"contained",size:"large",onClick:A,children:"حفظ"})})]})]}),e.jsx(G,{open:S,autoHideDuration:4e3,onClose:W,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(U,{onClose:W,severity:E,sx:{width:"100%"},children:k})})]})]})};export{Ne as default};
