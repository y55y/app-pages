import{t as re,r as c,j as a,S as Je,b1 as Qe,_ as L,b as ue,c as De,a as we,g as Re,s as fe,q as ce,an as Ae,u as Oe,aY as $e,d as Le,b6 as Ve,b5 as ie,h as _e,aZ as qe,b4 as et,B as oe,k as te,n as de,$ as tt,a0 as nt,R as xe,f as ot,i as rt,P as O,I as st,bD as lt,bE as it,G as Q,m as pe,M as at}from"./index-DFDjXJJD.js";import{d as ct}from"./Search-C_y4mX0P.js";import{f as dt}from"./fetchdata-SSWBG8pu.js";import{A as ut}from"./Autocomplete-CUx_OwI1.js";import{T as ft,M as pt}from"./TextField-BVwawPBZ.js";import{I as gt}from"./InputAdornment-D1vT-tQ4.js";import{C as Ne}from"./CircularProgress-oD_UnmhP.js";import{G as ht,a as xt,D as bt}from"./DataGrid-B1XWR2S5.js";import{M as mt}from"./MenuItem-DLq5gPQU.js";import{M as Nt}from"./MessageSnackbar-DgblGwr-.js";var ye=re("building-store","IconBuildingStore",[["path",{d:"M3 21l18 0",key:"svg-0"}],["path",{d:"M3 7v1a3 3 0 0 0 6 0v-1m0 1a3 3 0 0 0 6 0v-1m0 1a3 3 0 0 0 6 0v-1h-18l2 -4h14l2 4",key:"svg-1"}],["path",{d:"M5 21l0 -10.15",key:"svg-2"}],["path",{d:"M19 21l0 -10.15",key:"svg-3"}],["path",{d:"M9 21v-4a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v4",key:"svg-4"}]]),Te=re("building-warehouse","IconBuildingWarehouse",[["path",{d:"M3 21v-13l9 -4l9 4v13",key:"svg-0"}],["path",{d:"M13 13h4v8h-10v-6h6",key:"svg-1"}],["path",{d:"M13 21v-9a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v3",key:"svg-2"}]]),Ee=re("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]),je=re("folder","IconFolder",[["path",{d:"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2",key:"svg-0"}]]),Ct=re("tag","IconTag",[["path",{d:"M7.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M3 6v5.172a2 2 0 0 0 .586 1.414l7.71 7.71a2.41 2.41 0 0 0 3.408 0l5.592 -5.592a2.41 2.41 0 0 0 0 -3.408l-7.71 -7.71a2 2 0 0 0 -1.414 -.586h-5.172a3 3 0 0 0 -3 3z",key:"svg-1"}]]),St=re("tags","IconTags",[["path",{d:"M3 8v4.172a2 2 0 0 0 .586 1.414l5.71 5.71a2.41 2.41 0 0 0 3.408 0l3.592 -3.592a2.41 2.41 0 0 0 0 -3.408l-5.71 -5.71a2 2 0 0 0 -1.414 -.586h-4.172a2 2 0 0 0 -2 2z",key:"svg-0"}],["path",{d:"M18 19l1.592 -1.592a4.82 4.82 0 0 0 0 -6.816l-4.592 -4.592",key:"svg-1"}],["path",{d:"M7 10h-.01",key:"svg-2"}]]);const vt=()=>c.useRef({}),It=({setSelectedSubRowId:e,setSelectedRowId:t,apiSearchEndpoint:n,placeholder:r,noOptionsText:s,getOptionLabel:u=f=>f[l]?`${f[l]} - ${f[p]}`:f[p],dataKey:b,dataCode:l,Name:p,debounceDelay:d=500,options:h,setOptions:g,setQueryOptions:N})=>{const[f,o]=c.useState(null),[i,x]=c.useState(""),[m,v]=c.useState(!1),[I,y]=c.useState(null);c.useEffect(()=>{if(!i){g([]);return}const S=setTimeout(async()=>{v(!0),y(null);const{data:P,error:A}=await dt(n,i);A?(y(A),g([])):g(P),v(!1)},d);return()=>clearTimeout(S)},[i,n,d]);const C=(j,S)=>{o(S),x(""),S?S.isMain===0?(e(S[b]),t(null)):(t(S[b]),e(null)):(N(P=>({...P,filterModel:[null]})),x(""))},M=j=>{x(j.target.value)},F=()=>{g(j=>{if(e(null),!j.some(P=>P.Name===i)&&i){const P={Name:i};return o(P),[...j,P]}return j}),N(j=>({...j,filterModel:[{search:i}]}))};return a.jsx(Je,{direction:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",spacing:2,children:a.jsx(ut,{fullWidth:!0,id:"account-autocomplete",options:h,getOptionLabel:u,loading:m,renderInput:j=>a.jsx(ft,{...j,placeholder:r,size:"small",onChange:M,onKeyPress:S=>{S.key==="Enter"&&F()},InputProps:{...j.InputProps,startAdornment:a.jsx(gt,{position:"start",children:a.jsx(ct,{fontSize:"small",onClick:F,style:{cursor:"pointer"}})}),endAdornment:a.jsxs(a.Fragment,{children:[m?a.jsx(Ne,{color:"inherit",size:20}):null,j.InputProps.endAdornment]})}}),value:f,inputValue:i,onChange:C,noOptionsText:I?"خطأ في الحصول على البيانات":s,loadingText:"قيد التحميل..."})})},yt=["element"];function Tt(e,t){for(let n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}function Et(e,t){let n=0,r=e.length-1;for(;n<=r;){const s=Math.floor((n+r)/2);if(e[s].element===t)return s;e[s].element.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING?r=s-1:n=s+1}return n}const ze=c.createContext({});function jt(e){const t=c.useRef(null);return c.useEffect(()=>{t.current=e},[e]),t.current}const Pe=()=>{};function Pt(e){const[,t]=c.useState(),{registerDescendant:n=Pe,unregisterDescendant:r=Pe,descendants:s=[],parentId:u=null}=c.useContext(ze),b=Tt(s,d=>d.element===e.element),l=jt(s),p=s.some((d,h)=>l&&l[h]&&l[h].element!==d.element);return Qe(()=>{if(e.element)return n(L({},e,{index:b})),()=>{r(e.element)};t({})},[n,r,b,p,e]),{parentId:u,index:b}}function Be(e){const{children:t,id:n}=e,[r,s]=c.useState([]),u=c.useCallback(p=>{let{element:d}=p,h=ue(p,yt);s(g=>{if(g.length===0)return[L({},h,{element:d,index:0})];const N=Et(g,d);let f;if(g[N]&&g[N].element===d)f=g;else{const o=L({},h,{element:d,index:N});f=g.slice(),f.splice(N,0,o)}return f.forEach((o,i)=>{o.index=i}),f})},[]),b=c.useCallback(p=>{s(d=>d.filter(h=>p!==h.element))},[]),l=c.useMemo(()=>({descendants:r,registerDescendant:u,unregisterDescendant:b,parentId:n}),[r,u,b,n]);return a.jsx(ze.Provider,{value:l,children:t})}const Ue={instance:null,multiSelect:!1,disabledItemsFocusable:!1,treeId:void 0,icons:{defaultCollapseIcon:null,defaultExpandIcon:null,defaultParentIcon:null,defaultEndIcon:null}},Ge=c.createContext(Ue),He=()=>c.useContext(Ge);function kt(e){const{instance:t,multiSelect:n}=He(),r=t?t.isNodeExpandable(e):!1,s=t?t.isNodeExpanded(e):!1,u=t?t.isNodeFocused(e):!1,b=t?t.isNodeSelected(e):!1,l=t?t.isNodeDisabled(e):!1;return{disabled:l,expanded:s,selected:b,focused:u,handleExpansion:g=>{if(t&&!l){u||t.focusNode(g,e);const N=n&&(g.shiftKey||g.ctrlKey||g.metaKey);r&&!(N&&t.isNodeExpanded(e))&&t.toggleNodeExpansion(g,e)}},handleSelection:g=>{t&&!l&&(u||t.focusNode(g,e),n&&(g.shiftKey||g.ctrlKey||g.metaKey)?g.shiftKey?t.selectRange(g,{end:e}):t.selectNode(g,e,!0):t.selectNode(g,e))},preventSelection:g=>{(g.shiftKey||g.ctrlKey||g.metaKey||l)&&g.preventDefault()}}}const Mt=["classes","className","displayIcon","expansionIcon","icon","label","nodeId","onClick","onMouseDown"],We=c.forwardRef(function(t,n){const{classes:r,className:s,displayIcon:u,expansionIcon:b,icon:l,label:p,nodeId:d,onClick:h,onMouseDown:g}=t,N=ue(t,Mt),{disabled:f,expanded:o,selected:i,focused:x,handleExpansion:m,handleSelection:v,preventSelection:I}=kt(d),y=l||b||u,C=F=>{I(F),g&&g(F)},M=F=>{m(F),v(F),h&&h(F)};return a.jsxs("div",L({},N,{className:De(s,r.root,o&&r.expanded,i&&r.selected,x&&r.focused,f&&r.disabled),onClick:M,onMouseDown:C,ref:n,children:[a.jsx("div",{className:r.iconContainer,children:y}),a.jsx("div",{className:r.label,children:p})]}))});function Ft(e){return Re("MuiTreeItem",e)}const q=we("MuiTreeItem",["root","group","content","expanded","selected","focused","disabled","iconContainer","label"]),Dt=["children","className","collapseIcon","ContentComponent","ContentProps","endIcon","expandIcon","disabled","icon","id","label","nodeId","onClick","onMouseDown","TransitionComponent","TransitionProps"],wt=e=>{const{classes:t}=e;return Le({root:["root"],content:["content"],expanded:["expanded"],selected:["selected"],focused:["focused"],disabled:["disabled"],iconContainer:["iconContainer"],label:["label"],group:["group"]},Ft,t)},Rt=fe("li",{name:"MuiTreeItem",slot:"Root",overridesResolver:(e,t)=>t.root})({listStyle:"none",margin:0,padding:0,outline:0}),At=fe(We,{name:"MuiTreeItem",slot:"Content",overridesResolver:(e,t)=>[t.content,t.iconContainer&&{[`& .${q.iconContainer}`]:t.iconContainer},t.label&&{[`& .${q.label}`]:t.label}]})(({theme:e})=>({padding:"0 8px",width:"100%",boxSizing:"border-box",display:"flex",alignItems:"center",cursor:"pointer",WebkitTapHighlightColor:"transparent","&:hover":{backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${q.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,backgroundColor:"transparent"},[`&.${q.focused}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${q.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ce(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:ce(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ce(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${q.focused}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:ce(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`& .${q.iconContainer}`]:{marginRight:4,width:15,display:"flex",flexShrink:0,justifyContent:"center","& svg":{fontSize:18}},[`& .${q.label}`]:L({paddingLeft:4,width:"100%",boxSizing:"border-box",minWidth:0,position:"relative"},e.typography.body1)})),Ot=fe(Ae,{name:"MuiTreeItem",slot:"Group",overridesResolver:(e,t)=>t.group})({margin:0,padding:0,marginLeft:17}),$t=c.forwardRef(function(t,n){const r=Oe({props:t,name:"MuiTreeItem"}),{children:s,className:u,collapseIcon:b,ContentComponent:l=We,ContentProps:p,endIcon:d,expandIcon:h,disabled:g,icon:N,id:f,label:o,nodeId:i,onClick:x,onMouseDown:m,TransitionComponent:v=Ae,TransitionProps:I}=r,y=ue(r,Dt),{icons:C,multiSelect:M,disabledItemsFocusable:F,treeId:j,instance:S}=He();let P;f!=null?P=f:j&&i&&(P=`${j}-${i}`);const[A,ne]=c.useState(null),$=c.useRef(null),z=$e(ne,n),G=c.useMemo(()=>({element:A,id:i}),[i,A]),{index:Y,parentId:B}=Pt(G),H=!!(Array.isArray(s)?s.length:s),W=S?S.isNodeExpanded(i):!1,T=S?S.isNodeFocused(i):!1,U=S?S.isNodeSelected(i):!1,K=S?S.isNodeDisabled(i):!1,E=L({},r,{expanded:W,focused:T,selected:U,disabled:K}),k=wt(E);let V,w;H&&(W?w=b||C.defaultCollapseIcon:w=h||C.defaultExpandIcon),H?V=C.defaultParentIcon:V=d||C.defaultEndIcon,c.useEffect(()=>{if(S&&Y!==-1)return S.updateNode({id:i,idAttribute:P,index:Y,parentId:B,expandable:H,disabled:g}),()=>S.removeNode(i)},[S,B,Y,i,H,g,P]),c.useEffect(()=>{if(S&&o){var _,X;return S.mapFirstChar(i,((_=(X=$.current)==null?void 0:X.textContent)!=null?_:"").substring(0,1).toLowerCase())}},[S,i,o]);let D;M?D=U:U&&(D=!0);function Z(_){if(_.target===_.currentTarget){let R;typeof _.target.getRootNode=="function"?R=_.target.getRootNode():R=Ve(_.target),R.getElementById(j).focus({preventScroll:!0})}const X=!F&&K;S&&!T&&_.currentTarget===_.target&&!X&&S.focusNode(_,i)}return a.jsxs(Rt,L({className:De(k.root,u),role:"treeitem","aria-expanded":H?W:void 0,"aria-selected":D,"aria-disabled":K||void 0,id:P,tabIndex:-1},y,{ownerState:E,onFocus:Z,ref:z,children:[a.jsx(At,L({as:l,ref:$,classes:{root:k.content,expanded:k.expanded,selected:k.selected,focused:k.focused,disabled:k.disabled,iconContainer:k.iconContainer,label:k.label},label:o,nodeId:i,onClick:x,onMouseDown:m,icon:N,expansionIcon:w,displayIcon:V,ownerState:E},p)),s&&a.jsx(Be,{id:i,children:a.jsx(Ot,L({as:v,unmountOnExit:!0,className:k.group,in:W,component:"ul",role:"group"},I,{children:s}))})]}))});function Lt(e){return Re("MuiTreeView",e)}we("MuiTreeView",["root"]);const Vt=(e,t)=>{const n=c.useRef({}),[r,s]=c.useState(()=>{const b={};return e.forEach(l=>{l.models&&Object.entries(l.models).forEach(([p,d])=>{n.current[p]={controlledProp:d.controlledProp,defaultProp:d.defaultProp,isControlled:t[d.controlledProp]!==void 0},b[p]=t[d.defaultProp]})}),b});return Object.fromEntries(Object.entries(n.current).map(([b,l])=>{const p=l.isControlled?t[l.controlledProp]:r[b];return[b,{value:p,setValue:d=>{l.isControlled||s(h=>L({},h,{[b]:d}))}}]}))};class _t{constructor(){this.maxListeners=20,this.warnOnce=!1,this.events={}}on(t,n,r={}){let s=this.events[t];s||(s={highPriority:new Map,regular:new Map},this.events[t]=s),r.isFirst?s.highPriority.set(n,!0):s.regular.set(n,!0)}removeListener(t,n){this.events[t]&&(this.events[t].regular.delete(n),this.events[t].highPriority.delete(n))}removeAllListeners(){this.events={}}emit(t,...n){const r=this.events[t];if(!r)return;const s=Array.from(r.highPriority.keys()),u=Array.from(r.regular.keys());for(let b=s.length-1;b>=0;b-=1){const l=s[b];r.highPriority.has(l)&&l.apply(this,n)}for(let b=0;b<u.length;b+=1){const l=u[b];r.regular.has(l)&&l.apply(this,n)}}once(t,n){const r=this;this.on(t,function s(...u){r.removeListener(t,s),n.apply(r,u)})}}const ge=(e,t)=>{const n=e.getNode(t),r=e.getNavigableChildrenIds(n.parentId),s=r.indexOf(t);if(s===0)return n.parentId;let u=r[s-1];for(;e.isNodeExpanded(u)&&e.getNavigableChildrenIds(u).length>0;)u=e.getNavigableChildrenIds(u).pop();return u},le=(e,t)=>{if(e.isNodeExpanded(t)&&e.getNavigableChildrenIds(t).length>0)return e.getNavigableChildrenIds(t)[0];let n=e.getNode(t);for(;n!=null;){const r=e.getNavigableChildrenIds(n.parentId),s=r[r.indexOf(n.id)+1];if(s)return s;n=e.getNode(n.parentId)}return null},be=e=>{let t=e.getNavigableChildrenIds(null).pop();for(;e.isNodeExpanded(t);)t=e.getNavigableChildrenIds(t).pop();return t},me=e=>e.getNavigableChildrenIds(null)[0],se=(e,t)=>{Object.assign(e,t)},zt=e=>e.isPropagationStopped!==void 0,Bt=({instance:e})=>{const[t]=c.useState(()=>new _t),n=c.useCallback((...s)=>{const[u,b,l={}]=s;l.defaultMuiPrevented=!1,!(zt(l)&&l.isPropagationStopped())&&t.emit(u,b,l)},[t]),r=c.useCallback((s,u)=>(t.on(s,u),()=>{t.removeListener(s,u)}),[t]);se(e,{$$publishEvent:n,$$subscribeEvent:r})},Ut=[Bt],Gt=e=>{const t=[...Ut,...e.plugins],n=t.reduce((o,i)=>i.getDefaultizedParams?i.getDefaultizedParams(o):o,e),r=Vt(t,n),u=c.useRef({}).current,b=c.useRef(null),l=$e(b,e.rootRef),[p,d]=c.useState(()=>{const o={};return t.forEach(i=>{i.getInitialState&&Object.assign(o,i.getInitialState(n))}),o}),h=[];let g=Ue;const N=o=>{const i=o({instance:u,params:n,state:p,setState:d,rootRef:b,models:r})||{};i.getRootProps&&h.push(i.getRootProps),i.contextValue&&(g=i.contextValue)};return t.forEach(N),{getRootProps:(o={})=>{const i=L({role:"tree",tabIndex:0},o,{ref:l});return h.forEach(x=>{Object.assign(i,x(o))}),i},rootRef:l,contextValue:g}};function Ht(e){const{value:t,children:n}=e;return a.jsx(Ge.Provider,{value:t,children:a.jsx(Be,{children:n})})}const Wt=(e,t,n)=>{e.$$publishEvent(t,n)},Kt=({instance:e,params:t})=>{const n=c.useRef({}),r=c.useCallback(d=>n.current[d],[]),s=c.useCallback(d=>{n.current[d.id]=d},[]),u=c.useCallback(d=>{const h=L({},n.current);delete h[d],n.current=h,Wt(e,"removeNode",{id:d})},[e]),b=c.useCallback(d=>{if(d==null)return!1;let h=e.getNode(d);if(!h)return!1;if(h.disabled)return!0;for(;h.parentId!=null;)if(h=e.getNode(h.parentId),h.disabled)return!0;return!1},[e]),l=ie(d=>Object.values(n.current).filter(h=>h.parentId===d).sort((h,g)=>h.index-g.index).map(h=>h.id));se(e,{getNode:r,updateNode:s,removeNode:u,getChildrenIds:l,getNavigableChildrenIds:d=>{let h=e.getChildrenIds(d);return t.disabledItemsFocusable||(h=h.filter(g=>!e.isNodeDisabled(g))),h},isNodeDisabled:b})},Ce=({instance:e,params:t,models:n})=>{const r=c.useCallback(l=>Array.isArray(n.expanded.value)?n.expanded.value.indexOf(l)!==-1:!1,[n.expanded.value]),s=c.useCallback(l=>{var p;return!!((p=e.getNode(l))!=null&&p.expandable)},[e]),u=ie((l,p)=>{if(p==null)return;let d;n.expanded.value.indexOf(p)!==-1?d=n.expanded.value.filter(h=>h!==p):d=[p].concat(n.expanded.value),t.onNodeToggle&&t.onNodeToggle(l,d),n.expanded.setValue(d)});se(e,{isNodeExpanded:r,isNodeExpandable:s,toggleNodeExpansion:u,expandAllSiblings:(l,p)=>{const d=e.getNode(p),g=e.getChildrenIds(d.parentId).filter(f=>e.isNodeExpandable(f)&&!e.isNodeExpanded(f)),N=n.expanded.value.concat(g);g.length>0&&(n.expanded.setValue(N),t.onNodeToggle&&t.onNodeToggle(l,N))}})};Ce.models={expanded:{controlledProp:"expanded",defaultProp:"defaultExpanded"}};const Xt=[];Ce.getDefaultizedParams=e=>{var t;return L({},e,{defaultExpanded:(t=e.defaultExpanded)!=null?t:Xt})};const Yt=(e,t,n)=>{if(t===n)return[t,n];const r=e.getNode(t),s=e.getNode(n);if(r.parentId===s.id||s.parentId===r.id)return s.parentId===r.id?[r.id,s.id]:[s.id,r.id];const u=[r.id],b=[s.id];let l=r.parentId,p=s.parentId,d=b.indexOf(l)!==-1,h=u.indexOf(p)!==-1,g=!0,N=!0;for(;!h&&!d;)g&&(u.push(l),d=b.indexOf(l)!==-1,g=l!==null,!d&&g&&(l=e.getNode(l).parentId)),N&&!d&&(b.push(p),h=u.indexOf(p)!==-1,N=p!==null,!h&&N&&(p=e.getNode(p).parentId));const f=d?l:p,o=e.getChildrenIds(f),i=u[u.indexOf(f)-1],x=b[b.indexOf(f)-1];return o.indexOf(i)<o.indexOf(x)?[t,n]:[n,t]},Se=({instance:e,params:t,models:n})=>{const r=c.useRef(null),s=c.useRef(!1),u=c.useRef([]),b=o=>Array.isArray(n.selected.value)?n.selected.value.indexOf(o)!==-1:n.selected.value===o,l=(o,i,x=!1)=>{if(!t.disableSelection){if(x){if(Array.isArray(n.selected.value)){let m;n.selected.value.indexOf(i)!==-1?m=n.selected.value.filter(v=>v!==i):m=[i].concat(n.selected.value),t.onNodeSelect&&t.onNodeSelect(o,m),n.selected.setValue(m)}}else{const m=t.multiSelect?[i]:i;t.onNodeSelect&&t.onNodeSelect(o,m),n.selected.setValue(m)}r.current=i,s.current=!1,u.current=[]}},p=(o,i)=>{const[x,m]=Yt(e,o,i),v=[x];let I=x;for(;I!==m;)I=le(e,I),v.push(I);return v},d=(o,i)=>{let x=n.selected.value.slice();const{start:m,next:v,current:I}=i;!v||!I||(u.current.indexOf(I)===-1&&(u.current=[]),s.current?u.current.indexOf(v)!==-1?(x=x.filter(y=>y===m||y!==I),u.current=u.current.filter(y=>y===m||y!==I)):(x.push(v),u.current.push(v)):(x.push(v),u.current.push(I,v)),t.onNodeSelect&&t.onNodeSelect(o,x),n.selected.setValue(x))},h=(o,i)=>{let x=n.selected.value.slice();const{start:m,end:v}=i;s.current&&(x=x.filter(C=>u.current.indexOf(C)===-1));let I=p(m,v);I=I.filter(C=>!e.isNodeDisabled(C)),u.current=I;let y=x.concat(I);y=y.filter((C,M)=>y.indexOf(C)===M),t.onNodeSelect&&t.onNodeSelect(o,y),n.selected.setValue(y)};return se(e,{isNodeSelected:b,selectNode:l,selectRange:(o,i,x=!1)=>{if(t.disableSelection)return;const{start:m=r.current,end:v,current:I}=i;x?d(o,{start:m,next:v,current:I}):m!=null&&v!=null&&h(o,{start:m,end:v}),s.current=!0},rangeSelectToLast:(o,i)=>{r.current||(r.current=i);const x=s.current?r.current:i;e.selectRange(o,{start:x,end:be(e)})},rangeSelectToFirst:(o,i)=>{r.current||(r.current=i);const x=s.current?r.current:i;e.selectRange(o,{start:x,end:me(e)})}}),{getRootProps:()=>({"aria-multiselectable":t.multiSelect})}};Se.models={selected:{controlledProp:"selected",defaultProp:"defaultSelected"}};const Zt=[];Se.getDefaultizedParams=e=>{var t,n,r;return L({},e,{disableSelection:(t=e.disableSelection)!=null?t:!1,multiSelect:(n=e.multiSelect)!=null?n:!1,defaultSelected:(r=e.defaultSelected)!=null?r:e.multiSelect?Zt:null})};const ke=1e3;class Jt{constructor(t=ke){this.timeouts=new Map,this.cleanupTimeout=ke,this.cleanupTimeout=t}register(t,n,r){this.timeouts||(this.timeouts=new Map);const s=setTimeout(()=>{typeof n=="function"&&n(),this.timeouts.delete(r.cleanupToken)},this.cleanupTimeout);this.timeouts.set(r.cleanupToken,s)}unregister(t){const n=this.timeouts.get(t.cleanupToken);n&&(this.timeouts.delete(t.cleanupToken),clearTimeout(n))}reset(){this.timeouts&&(this.timeouts.forEach((t,n)=>{this.unregister({cleanupToken:n})}),this.timeouts=void 0)}}class Qt{constructor(){this.registry=new FinalizationRegistry(t=>{typeof t=="function"&&t()})}register(t,n,r){this.registry.register(t,n,r)}unregister(t){this.registry.unregister(t)}reset(){}}class qt{}function en(e){let t=0;return function(r,s,u){e.registry===null&&(e.registry=typeof FinalizationRegistry<"u"?new Qt:new Jt);const[b]=c.useState(new qt),l=c.useRef(null),p=c.useRef();p.current=u;const d=c.useRef(null);if(!l.current&&p.current){const h=(g,N)=>{if(!N.defaultMuiPrevented){var f;(f=p.current)==null||f.call(p,g,N)}};l.current=r.$$subscribeEvent(s,h),t+=1,d.current={cleanupToken:t},e.registry.register(b,()=>{var g;(g=l.current)==null||g.call(l),l.current=null,d.current=null},d.current)}else!p.current&&l.current&&(l.current(),l.current=null,d.current&&(e.registry.unregister(d.current),d.current=null));c.useEffect(()=>{if(!l.current&&p.current){const h=(g,N)=>{if(!N.defaultMuiPrevented){var f;(f=p.current)==null||f.call(p,g,N)}};l.current=r.$$subscribeEvent(s,h)}return d.current&&e.registry&&(e.registry.unregister(d.current),d.current=null),()=>{var h;(h=l.current)==null||h.call(l),l.current=null}},[r,s])}}const tn={registry:null},nn=en(tn),ve=({instance:e,params:t,state:n,setState:r,models:s,rootRef:u})=>{const b=ie(f=>{const o=typeof f=="function"?f(n.focusedNodeId):f;r(i=>L({},i,{focusedNodeId:o}))}),l=c.useCallback(f=>n.focusedNodeId===f,[n.focusedNodeId]),p=ie((f,o)=>{o&&(b(o),t.onNodeFocus&&t.onNodeFocus(f,o))});se(e,{isNodeFocused:l,focusNode:p}),nn(e,"removeNode",({id:f})=>{b(o=>o===f&&u.current===Ve(u.current).activeElement?e.getChildrenIds(null)[0]:o)});const d=f=>o=>{var i;if((i=f.onFocus)==null||i.call(f,o),o.target===o.currentTarget){const x=v=>{const I=e.getNode(v);return I&&(I.parentId==null||e.isNodeExpanded(I.parentId))};let m;Array.isArray(s.selected.value)?m=s.selected.value.find(x):s.selected.value!=null&&x(s.selected.value)&&(m=s.selected.value),m==null&&(m=e.getNavigableChildrenIds(null)[0]),e.focusNode(o,m)}},h=f=>o=>{var i;(i=f.onBlur)==null||i.call(f,o),b(null)},g=e.getNode(n.focusedNodeId),N=g?g.idAttribute:null;return{getRootProps:f=>({onFocus:d(f),onBlur:h(f),"aria-activedescendant":N??void 0})}};ve.getInitialState=()=>({focusedNodeId:null});ve.getDefaultizedParams=e=>{var t;return L({},e,{disabledItemsFocusable:(t=e.disabledItemsFocusable)!=null?t:!1})};function on(e){return e&&e.length===1&&e.match(/\S/)}function Me(e,t,n){for(let r=t;r<e.length;r+=1)if(n===e[r])return r;return-1}const rn=({instance:e,params:t,state:n})=>{const s=_e().direction==="rtl",u=c.useRef({}),b=ie((f,o)=>(u.current[f]=o,()=>{const i=L({},u.current);delete i[f],u.current=i}));se(e,{mapFirstChar:b});const l=f=>(n.focusedNodeId!=null&&e.isNodeExpandable(n.focusedNodeId)&&(e.isNodeExpanded(n.focusedNodeId)?e.focusNode(f,le(e,n.focusedNodeId)):e.isNodeDisabled(n.focusedNodeId)||e.toggleNodeExpansion(f,n.focusedNodeId)),!0),p=f=>{if(n.focusedNodeId==null)return!1;if(e.isNodeExpanded(n.focusedNodeId)&&!e.isNodeDisabled(n.focusedNodeId))return e.toggleNodeExpansion(f,n.focusedNodeId),!0;const o=e.getNode(n.focusedNodeId).parentId;return o?(e.focusNode(f,o),!0):!1},d=(f,o,i)=>{let x,m;const v=i.toLowerCase(),I=[],y=[];Object.keys(u.current).forEach(C=>{const M=e.getNode(C),F=M.parentId?e.isNodeExpanded(M.parentId):!0,j=t.disabledItemsFocusable?!1:e.isNodeDisabled(C);F&&!j&&(I.push(C),y.push(u.current[C]))}),x=I.indexOf(o)+1,x>=I.length&&(x=0),m=Me(y,x,v),m===-1&&(m=Me(y,0,v)),m>-1&&e.focusNode(f,I[m])},h=(f,o)=>{e.isNodeDisabled(le(e,o))||e.selectRange(f,{end:le(e,o),current:o},!0)},g=(f,o)=>{e.isNodeDisabled(ge(e,o))||e.selectRange(f,{end:ge(e,o),current:o},!0)},N=f=>o=>{var i;(i=f.onKeyDown)==null||i.call(f,o);let x=!1;const m=o.key;if(o.altKey||o.currentTarget!==o.target||n.focusedNodeId==null)return;const v=o.ctrlKey||o.metaKey;switch(m){case" ":!t.disableSelection&&!e.isNodeDisabled(n.focusedNodeId)&&(x=!0,t.multiSelect&&o.shiftKey?e.selectRange(o,{end:n.focusedNodeId}):t.multiSelect?e.selectNode(o,n.focusedNodeId,!0):e.selectNode(o,n.focusedNodeId)),o.stopPropagation();break;case"Enter":e.isNodeDisabled(n.focusedNodeId)||(e.isNodeExpandable(n.focusedNodeId)?(e.toggleNodeExpansion(o,n.focusedNodeId),x=!0):t.disableSelection||(x=!0,t.multiSelect?e.selectNode(o,n.focusedNodeId,!0):e.selectNode(o,n.focusedNodeId))),o.stopPropagation();break;case"ArrowDown":t.multiSelect&&o.shiftKey&&!t.disableSelection&&h(o,n.focusedNodeId),e.focusNode(o,le(e,n.focusedNodeId)),x=!0;break;case"ArrowUp":t.multiSelect&&o.shiftKey&&!t.disableSelection&&g(o,n.focusedNodeId),e.focusNode(o,ge(e,n.focusedNodeId)),x=!0;break;case"ArrowRight":s?x=p(o):x=l(o);break;case"ArrowLeft":s?x=l(o):x=p(o);break;case"Home":t.multiSelect&&v&&o.shiftKey&&!t.disableSelection&&!e.isNodeDisabled(n.focusedNodeId)&&e.rangeSelectToFirst(o,n.focusedNodeId),e.focusNode(o,me(e)),x=!0;break;case"End":t.multiSelect&&v&&o.shiftKey&&!t.disableSelection&&!e.isNodeDisabled(n.focusedNodeId)&&e.rangeSelectToLast(o,n.focusedNodeId),e.focusNode(o,be(e)),x=!0;break;default:m==="*"?(e.expandAllSiblings(o,n.focusedNodeId),x=!0):t.multiSelect&&v&&m.toLowerCase()==="a"&&!t.disableSelection?(e.selectRange(o,{start:me(e),end:be(e)}),x=!0):!v&&!o.shiftKey&&on(m)&&(d(o,n.focusedNodeId,m),x=!0)}x&&(o.preventDefault(),o.stopPropagation())};return{getRootProps:f=>({onKeyDown:N(f)})}},sn=({instance:e,params:t})=>{const n=qe(t.id);return{getRootProps:()=>({id:n}),contextValue:{treeId:n,instance:e,multiSelect:t.multiSelect,disabledItemsFocusable:t.disabledItemsFocusable,icons:{defaultCollapseIcon:t.defaultCollapseIcon,defaultEndIcon:t.defaultEndIcon,defaultExpandIcon:t.defaultExpandIcon,defaultParentIcon:t.defaultParentIcon}}}},ln=[Kt,Ce,Se,ve,rn,sn],an=["disabledItemsFocusable","expanded","defaultExpanded","onNodeToggle","onNodeFocus","disableSelection","defaultSelected","selected","multiSelect","onNodeSelect","id","defaultCollapseIcon","defaultEndIcon","defaultExpandIcon","defaultParentIcon","children"],cn=e=>{const{classes:t}=e;return Le({root:["root"]},Lt,t)},Fe=fe("ul",{name:"MuiTreeView",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:0,margin:0,listStyle:"none",outline:0}),dn=c.forwardRef(function(t,n){const r=Oe({props:t,name:"MuiTreeView"}),s=r,u=r,{disabledItemsFocusable:b,expanded:l,defaultExpanded:p,onNodeToggle:d,onNodeFocus:h,disableSelection:g,defaultSelected:N,selected:f,multiSelect:o,onNodeSelect:i,id:x,defaultCollapseIcon:m,defaultEndIcon:v,defaultExpandIcon:I,defaultParentIcon:y,children:C}=u,M=ue(u,an),{getRootProps:F,contextValue:j}=Gt({disabledItemsFocusable:b,expanded:l,defaultExpanded:p,onNodeToggle:d,onNodeFocus:h,disableSelection:g,defaultSelected:N,selected:f,multiSelect:o,onNodeSelect:i,id:x,defaultCollapseIcon:m,defaultEndIcon:v,defaultExpandIcon:I,defaultParentIcon:y,plugins:ln,rootRef:n}),S=cn(r),P=et({elementType:Fe,externalSlotProps:{},externalForwardedProps:M,className:S.root,getSlotProps:F,ownerState:s});return a.jsx(Ht,{value:j,children:a.jsx(Fe,L({},P,{children:C}))})}),he=({type:e,isExpanded:t,isTypeIcon:n})=>{const r=_e();r.palette.secondary.main,r.palette.error.main;const s=r.palette.primary.main;r.palette.warning.main;const u={Shop:{expanded:{component:ye,color:s},collapsed:{component:ye,color:s}},Store:{expanded:{component:Te,color:s},collapsed:{component:Te,color:s}},Category:{expanded:{component:Ct,color:s},collapsed:{component:St,color:s}}};if(!n)return t?a.jsx(Ee,{size:18,color:s}):a.jsx(je,{size:18,color:s});const{component:b,color:l}=u[e]?t?u[e].expanded:u[e].collapsed:{component:t?Ee:je,color:s};return a.jsx(b,{size:18,color:l})},un=({rows:e,mainAccounts:t=[],treeData:n,selectedRowId:r,setSelectedRowId:s,setParents:u,setSelectedSubRowId:b,dataKey:l,dataCode:p,Name:d,addLabel:h="اضافة",editLabel:g="تعديل",PopupAddMain:N,PopupEditMain:f,fetchTreeData:o,setMessage:i,disableIDTree:x,isTypeIcon:m=!0,mainName:v="الرئيسي"})=>{const[I,y]=c.useState(!1),[C,M]=c.useState(!1),[F,j]=c.useState([]),[S,P]=c.useState(!1),[A,ne]=c.useState(""),[$,z]=c.useState(!1),G=c.useRef({}),Y=()=>y(!0),B=()=>{y(!1),o()},H=()=>M(!0),W=()=>{M(!1),o()},T=(E,k)=>{j(k)},U=(E,k)=>{const V=[],w=D=>{if(D[l]===k)return!0;if(D.children){for(const Z of D.children)if(w(Z))return V.includes(D[l].toString())||V.unshift(D[l].toString()),!0}return!1};for(const D of E)if(w(D)){V.includes(D[l].toString())||V.unshift(D[l].toString());break}return u(V),V};c.useEffect(()=>{const E=U(n,r);r&&!$&&E.length>0&&j(k=>[...new Set([...k,...E])]),z(!1)},[r]),c.useEffect(()=>{if(r&&G.current[r]&&!$){const E=G.current[r];E.focus(),E.scrollIntoView({behavior:"smooth",block:"nearest"})}z(!1)},[r]);const K=c.useCallback(E=>{if(!E)return null;const k=E[l];if(k==null)return null;const V=k===r;return a.jsx($t,{nodeId:k.toString(),ref:w=>{w&&(G.current[k]=w)},onClick:()=>{z(!0),s(k),b(null)},label:a.jsx(oe,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{lineHeight:1.4},children:a.jsx(te,{variant:"body2",sx:{lineHeight:1.4,fontWeight:500},children:x?`${E[d]||""}`:`${E[p]||""} - ${E[d]||""}`})}),collapseIcon:a.jsx(he,{type:E.Type,isExpanded:!0,isTypeIcon:m}),expandIcon:a.jsx(he,{type:E.Type,isExpanded:!1,isTypeIcon:m}),endIcon:a.jsx(he,{type:E.Type,isExpanded:!0,isTypeIcon:m}),sx:{"& > .MuiTreeItem-content":{backgroundColor:V?"rgba(33, 150, 243, 0.2)":"transparent","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}},children:Array.isArray(E.children)?E.children.map(w=>K(w)):null},k.toString())},[r,s,l,x,d,m]);return a.jsxs(a.Fragment,{children:[a.jsx(oe,{sx:{height:"71.7vh",flexGrow:1,maxWidth:500,overflowY:"auto",display:"flex",flexDirection:"column",borderStyle:"groove"},children:a.jsx(dn,{expanded:F,onNodeToggle:T,sx:{"& .MuiCollapse-wrapper":{border:"#000000",borderWidth:"0 0 0 1px",borderStyle:"dashed"},"& .MuiTreeItem-content .MuiTreeItem-label":{marginBottom:"5px",marginTop:"5px"},"& .MuiTypography-root":{lineHeight:"1.4"},"& .MuiTreeItem-content .MuiTreeItem-iconContainer":{width:"18px"}},children:Array.isArray(n)&&n.length>0?n.map(E=>K(E)):a.jsx(te,{variant:"body2",sx:{p:2},children:"لا يوجد بيانات"})})}),a.jsxs(oe,{sx:{display:"flex",justifyContent:"flex-start",mt:2,gap:2},children:[a.jsxs(de,{variant:"contained",color:"primary",size:"small",onClick:Y,children:[h," ",v]}),a.jsx(de,{variant:"outlined",color:"secondary",size:"small",onClick:H,disabled:!r,children:g})]}),a.jsx(tt,{open:S,autoHideDuration:6e3,onClose:()=>P(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:a.jsx(nt,{onClose:()=>P(!1),severity:"warning",sx:{width:"100%"},children:A})}),N&&a.jsx(N,{open:I,onClose:B,rows:e,selectedRowId:r,mainAccounts:t,setMessage:i}),f&&a.jsx(f,{open:C,onClose:W,rows:e,selectedRowId:r,mainAccounts:t,setMessage:i})]})},fn=({rows:e,columns:t,rowCount:n,page:r,pageSize:s,setPage:u,setPageSize:b,selectedRowId:l,selectedSubRowId:p,setSelectedSubRowId:d,AddEntityComponent:h,EditEntityComponent:g,entityName:N,noRowsText:f="لا يوجد بيانات",addLabel:o="اضافة",editLabel:i="تعديل",dataKey:x,fetchSubTreeData:m,mainAccounts:v,isLoading:I,setMessage:y,queryOptions:C,setQueryOptions:M})=>{const[F,j]=c.useState(!1),[S,P]=c.useState(!1),[A,ne]=c.useState(!1),$=vt(),z=()=>j(T=>!T),G=()=>P(T=>!T),Y=c.useCallback(T=>{d(null),M(U=>({...U,sortModel:[...T]}))},[]),B=(T,U)=>{var V,w,D,Z,_,X;const K=((w=(V=C==null?void 0:C.filterModel)==null?void 0:V[0])==null?void 0:w.search)||null,E=p?null:((Z=(D=C==null?void 0:C.sortModel)==null?void 0:D[0])==null?void 0:Z.field)||null,k=p?null:((X=(_=C==null?void 0:C.sortModel)==null?void 0:_[0])==null?void 0:X.sort)||null;m(l,T!==void 0?T:r,s,U===1?null:p,K,E,k)};c.useEffect(()=>{l&&B()},[s]),c.useEffect(()=>{l&&B(0)},[l,C]),c.useEffect(()=>{p&&$.current&&($.current.scrollToIndexes({rowIndex:p}),$.current.setCellFocus(p,"Name"),$.current.setRowSelectionModel([p]))},[p,$,e]);const H=T=>{u(T),l&&B(T,1)},W=xe.useMemo(()=>T=>a.jsxs(ht,{children:[a.jsxs(oe,{sx:{display:"flex",justifyContent:"flex-start",gap:2,p:1},children:[a.jsx(de,{variant:"contained",color:"primary",size:"small",onClick:z,disabled:A,startIcon:A?a.jsx(Ne,{size:20,color:"inherit"}):null,children:A?"جاري الإضافة...":`${o} ${N}`}),a.jsx(de,{variant:"outlined",color:"secondary",size:"small",onClick:G,disabled:!p,children:i})]}),a.jsx(xt,{...T})]}),[z,G,A,o,i,N,p]);return a.jsxs(a.Fragment,{children:[a.jsx(oe,{sx:{height:"80vh",width:"100%",display:"flex",flexDirection:"column"},children:a.jsx(oe,{sx:{flexGrow:1,borderStyle:"groove"},children:a.jsx(bt,{apiRef:$,rows:e,columns:t.map(T=>({...T,minWidth:150})),getRowId:T=>T[x],pagination:!0,paginationMode:"server",sortingMode:"server",onSortModelChange:Y,rowCount:n,onPaginationModelChange:T=>{d(null),H(T.page),b(T.pageSize)},paginationModel:{page:r,pageSize:s},pageSizeOptions:[5,10,25,50],localeText:{noRowsLabel:f},onRowClick:T=>d(T.row[x]),selectionModel:p?[p]:[],loading:I,getRowClassName:T=>T.indexRelativeToCurrentPage%2===0?"even-row":"odd-row",rowHeight:45,disableColumnFilter:!0,disableColumnMenu:!0,disableColumnSelector:!0,components:{Footer:W},sx:{"& .odd-row":{backgroundColor:"rgba(0, 0, 0, 0.02)"},"& .even-row":{backgroundColor:"white"},"& .MuiDataGrid-cell:focus":{outline:"none"}}})})}),F&&a.jsx(h,{open:F,onClose:()=>{z(),B(null,1)},mainAccounts:v,selectedRowId:l,setMessage:y,rows:e,setIsLoading:T=>ne(T)}),S&&a.jsx(g,{open:S,onClose:()=>{G(),B(null,1)},mainAccounts:v,selectedRowId:l,selectedSubRowId:p,setMessage:y,rows:e})]})};var Ie={},pn=rt;Object.defineProperty(Ie,"__esModule",{value:!0});var Ke=Ie.default=void 0,gn=pn(ot()),hn=a;Ke=Ie.default=(0,gn.default)((0,hn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"}),"AssessmentOutlined");const Xe=({parents:e,selectedRowId:t,selectedSubRowId:n,mainAccounts:r,reportOptions:s=[],dataKey:u,Name:b,rows:l,setMessage:p})=>{const[d,h]=c.useState(null),[g,N]=c.useState(!1),[f,o]=c.useState(!1),i=c.useCallback(C=>{const M=r.find(F=>String(F[u])===String(C));return M?M[b]:""},[r,u]),x=c.useCallback(C=>{const M=r.find(F=>String(F[u])===String(C));return M?parseFloat(M.Balance).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},[r,u]),m=c.useCallback(C=>{h(C),N(!0)},[]),v=xe.memo(()=>{const[C,M]=c.useState(null),F=c.useCallback(S=>{M(S.currentTarget)},[]),j=c.useCallback(()=>{M(null)},[]);return a.jsxs(a.Fragment,{children:[f?a.jsx(Ne,{size:24,style:{color:"white"}}):a.jsx(st,{color:"primary",size:"small",onClick:F,"aria-controls":"report-menu","aria-haspopup":"true",children:a.jsx(Ke,{style:{color:"white"}})}),a.jsx(pt,{id:"report-menu",anchorEl:C,keepMounted:!0,open:!!C,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:s.map((S,P)=>a.jsx(mt,{onClick:()=>{o(!0),m(P),j()},disabled:S.isDisabled,children:S.text},P))}),s.map((S,P)=>P===d?xe.createElement(S.component,{open:g,onClose:()=>{h(null),o(!1),N(!1),setTimeout(()=>h(null),300)},selectedRowId:t,selectedSubRowId:n,rows:l,mainAccounts:r,selectedSubRowData:l.find(A=>String(A.id)===String(n)),dataKey:u,setMessage:p}):null)]})}),I=c.useMemo(()=>e.map(C=>a.jsx(te,{color:"white",children:i(C)},C)),[e,i]),y=c.useMemo(()=>x(t),[x,t]);return a.jsx("div",{style:{display:"flex",alignItems:"center",height:"100%",justifyContent:"space-between"},children:e.length===1&&String(e[0])===String(t)?a.jsxs(a.Fragment,{children:[a.jsx(te,{variant:"h4",color:"white",children:i(t)}),a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsx(te,{variant:"h3",color:"white",style:{marginLeft:"10px"},children:y}),s.length>0&&a.jsx(v,{})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(lt,{separator:a.jsx(it,{fontSize:"small",sx:{color:"white"}}),"aria-label":"breadcrumb",children:[I,a.jsx(te,{variant:"h4",color:"white",children:i(t)})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsx(te,{variant:"h3",color:"white",style:{marginLeft:"10px"},children:y}),s.length>0&&a.jsx(v,{})]})]})})};Xe.propTypes={parents:O.arrayOf(O.oneOfType([O.string,O.number])),selectedRowId:O.oneOfType([O.string,O.number]),selectedSubRowId:O.oneOfType([O.string,O.number]),mainAccounts:O.array,reportOptions:O.arrayOf(O.shape({text:O.string,component:O.elementType,isDisabled:O.bool})),dataKey:O.string,rows:O.array,setMessage:O.func};const En=({mainData:e,rows:t,dataKey:n,dataCode:r="Code",Name:s="Name",PopupAddMain:u,PopupEditMain:b,AddEntityComponent:l,EditEntityComponent:p,fetchTreeData:d,fetchSubTreeData:h,columns:g,rowCount:N,apiSearchEndpoint:f,reportOptions:o,isLoading:i,entityName:x,mainName:m,page:v,setPage:I,disableIDTree:y=!1,isTypeIcon:C=!1,onSelectedRowIdChange:M})=>{const[F,j]=c.useState([]),[S,P]=c.useState(null),[A,ne]=c.useState(e||[]),[$,z]=c.useState(null),[G,Y]=c.useState([]),[B,H]=c.useState(10),[W,T]=c.useState([]),[U,K]=c.useState({}),[E,k]=c.useState({open:!1,type:"",text:""});c.useEffect(()=>{if($){const w=W.find(D=>String(D[n])===String($));w&&P(w.Father)}},[$]),c.useEffect(()=>{M&&M(S)},[S]),c.useEffect(()=>{if(e&&e.length>0){const w=new Map,D=e.filter(R=>R[n]!==R.Father);D.forEach(R=>w.set(R[n],{...R,children:[]}));const Z=R=>{let J=parseFloat(R.Balance)||0;const ae=D.filter(ee=>ee.Father===R[n]);for(const ee of ae){const Ze=Z(ee);J+=Ze.balance}const Ye=t.filter(ee=>ee.Father===R[n]);for(const ee of Ye)J+=parseFloat(ee.Balance)||0;return{balance:J}},_=D.map(R=>{const J=Z(R);return{...R,Balance:J.balance}});ne(_);const X=[];D.forEach(R=>{const J=w.get(R[n]);if(R.Father===0)X.push(J);else{const ae=w.get(R.Father);ae&&ae.children.push(J)}}),j(X)}},[e,t,n]);const V=()=>{k({...E,open:!1})};return a.jsxs(Q,{container:!0,spacing:pe,children:[a.jsx(Q,{item:!0,xs:12,children:a.jsxs(at,{content:!1,children:[a.jsxs(Q,{container:!0,spacing:pe,xs:13,sx:{padding:"9px",backgroundColor:"primary.main"},children:[a.jsx(Q,{item:!0,xs:12,md:3,children:a.jsx(It,{mainAccounts:A,rows:t,setSelectedSubRowId:z,setSelectedRowId:P,apiSearchEndpoint:f,placeholder:"البحث عن "+x,noOptionsText:"لا يوجد بيانات مطابقة",dataKey:n,dataCode:r,Name:s,options:W,setOptions:T,queryOptions:U,setQueryOptions:K})}),a.jsx(Q,{item:!0,xs:12,md:9,children:a.jsx(Xe,{parents:G,selectedRowId:S,selectedSubRowId:$,mainAccounts:A,reportOptions:o,dataKey:n,Name:s,rows:t,setMessage:k})})]}),a.jsxs(Q,{container:!0,spacing:pe,xs:13,sx:{p:2},children:[a.jsx(Q,{item:!0,xs:12,md:3,children:a.jsx(un,{rows:t,mainAccounts:A,treeData:F,selectedRowId:S,setSelectedRowId:P,setParents:Y,setSelectedSubRowId:z,dataKey:n,dataCode:r,Name:s,PopupAddMain:u,PopupEditMain:b,fetchTreeData:d,setMessage:k,disableIDTree:y,isTypeIcon:C,mainName:m})}),a.jsx(Q,{item:!0,xs:12,md:9,children:a.jsx(fn,{rows:t,columns:g,dataKey:n,mainAccounts:A,selectedRowId:S,selectedSubRowId:$,setSelectedSubRowId:z,AddEntityComponent:l,EditEntityComponent:p,fetchSubTreeData:h,rowCount:N,page:v,pageSize:B,setPage:I,setPageSize:H,isLoading:i,entityName:x,setMessage:k,queryOptions:U,setQueryOptions:K})})]})]})}),a.jsx(Nt,{open:E.open,type:E.type,text:E.text,handleClose:V})]})};export{En as B};
