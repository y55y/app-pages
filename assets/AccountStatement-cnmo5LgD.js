import{r as o,bF as T,R,j as n,ax as C,B as x,k as a,ak as D}from"./index-B0WSqbsu.js";import{S as k}from"./SubCard-S3Bm2fjm.js";import{R as v}from"./index-DPM_OJLP.js";import{T as S,a as N,b as g,c as w}from"./TableRow-DrLn4BSI.js";import{T as I}from"./TableHead-BivyvsJd.js";import{T as r}from"./TableCell-BBwK6Z2L.js";const F=({open:p,onClose:h,selectedSubRowId:l,rows:m,dataKey:b,setMessage:c})=>{const[t,y]=o.useState(null),j=o.useRef(!1),f=o.useRef(),q=o.useCallback(async()=>{if(l||(c({open:!0,type:"error",text:"حدد الحساب"}),h()),j.current||!p||!l)return;const i=m.find(d=>d[b]===l);if(!i||!i.AccID){c({open:!0,type:"error",text:"لم يتم العثور على حساب محاسبي"}),h();return}try{const d=await T(i.AccID);d.entries&&d.entries.length>0?(y({accountId:l,accountName:i.Name||"",accountRef:i.Ref||"",transactions:d.entries}),j.current=!0):c({open:!0,type:"warning",text:"No entries found for this account"})}catch(d){console.error("Error fetching statement:",d),c({open:!0,type:"error",text:"An error occurred while fetching the account statement"})}},[p]);o.useEffect(()=>{q()},[p]),o.useEffect(()=>{if(t&&t.transactions&&t.transactions.length>0){console.log("Statement data updated:",t);const i=document.querySelector('button[style="display: none;"]');i&&i.click(),h()}},[t]);const A=R.forwardRef((i,d)=>!t||!t.transactions||t.transactions.length===0?null:n.jsxs(k,{darkTitle:!0,ref:d,title:"كشف حساب",secondary:n.jsx(C,{}),sx:{direction:"ltr",maxWidth:900,margin:"auto",display:"none","@media print":{display:"block"}},children:[n.jsxs(x,{display:"flex",justifyContent:"space-between",mb:3,children:[n.jsxs(x,{children:[n.jsxs(a,{variant:"body1",mb:2,children:[n.jsx("strong",{children:"رقم الحساب:"})," ",t.accountId]}),n.jsxs(a,{variant:"body1",mb:2,children:[n.jsx("strong",{children:"اسم الحساب:"})," ",t.accountName]})]}),n.jsxs(x,{children:[n.jsxs(a,{variant:"body1",mb:2,children:[n.jsx("strong",{children:"رقم المرجع:"})," ",t.accountRef]}),n.jsxs(a,{variant:"body1",mb:2,children:[n.jsx("strong",{children:"الرصيد الافتتاحي:"})," ",0]})]})]}),n.jsx(S,{component:D,sx:{border:"1px solid #ddd",boxShadow:"none"},children:n.jsxs(N,{size:"small",children:[n.jsx(I,{children:n.jsxs(g,{sx:{backgroundColor:"#d3d3d3",fontWeight:"bold"},children:[n.jsx(r,{align:"left",sx:{padding:"2px 4px"},children:n.jsx("strong",{sx:{color:"primary.main"},children:"رقم القيد"})}),n.jsx(r,{align:"left",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:"الفرع"})}),n.jsx(r,{align:"left",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:"التاريخ"})}),n.jsx(r,{align:"left",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:"البيان"})}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:"دائن"})}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:"مدين"})}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:"الرصيد"})})]})}),n.jsxs(w,{children:[t.transactions.map((e,s)=>n.jsxs(g,{sx:{backgroundColor:s%2===0?"#f9f9f9":"#fff"},children:[n.jsx(r,{align:"left",sx:{padding:"2px 4px"},children:e.qidID}),n.jsx(r,{align:"left",sx:{padding:"2px 4px"},children:e.qidIstore}),n.jsx(r,{align:"left",sx:{padding:"2px 4px"},children:e.qidDate}),n.jsxs(r,{align:"left",sx:{padding:"2px 4px"},children:[e.qidINV?`${e.TypeN} (${e.qidINV})`:"",e.qidRef?`${e.TypeR} (${e.qidRef})`:"",e.qidEnote?` - ${e.qidEnote}`:""]}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:e.qidEAmountC}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:e.qidEAmountD}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:s===0?e.qidEAmountC-e.qidEAmountD:t.transactions.slice(0,s+1).reduce((E,u)=>E+u.qidEAmountC-u.qidEAmountD,0)})]},s)),n.jsxs(g,{sx:{backgroundColor:"#f0f0f0",fontWeight:"bold"},children:[n.jsx(r,{colSpan:4,align:"left",sx:{padding:"4px 4px"},children:n.jsx("strong",{children:"الإجمالي"})}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:t.transactions.reduce((e,s)=>e+s.qidEAmountC,0)})}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:t.transactions.reduce((e,s)=>e+s.qidEAmountD,0)})}),n.jsx(r,{align:"right",sx:{padding:"2px 4px"},children:n.jsx("strong",{children:t.transactions.reduce((e,s)=>e+s.qidEAmountC,0)-t.transactions.reduce((e,s)=>e+s.qidEAmountD,0)})})]})]})]})}),n.jsxs(x,{mt:4,mb:4,display:"flex",justifyContent:"space-between",sx:{borderTop:"2px solid #000",paddingTop:2},children:[n.jsxs(x,{textAlign:"center",children:[n.jsx(a,{variant:"body1",sx:{fontWeight:"bold"},children:"توقيع معد الكشف"}),n.jsx(a,{variant:"body1",mt:2,children:".............................."})]}),n.jsxs(x,{textAlign:"center",children:[n.jsx(a,{variant:"body1",sx:{fontWeight:"bold"},children:"توقيع العميل علي صحة الرصيد"}),n.jsx(a,{variant:"body1",mt:2,children:".............................."})]})]})]}));return n.jsxs("div",{children:[n.jsx(v,{trigger:()=>n.jsx("button",{style:{display:"none"}}),content:()=>f.current}),t&&n.jsx(A,{ref:f})]})};export{F as A};
