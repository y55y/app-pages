import{P as b,r as c,O as N,j as e,S as I,V as T,I as C,z as w,B as U,W as je,k as j,h as Se,K as ve,R as ye,X as ke,Y as Te,M as W,A as Ce,Z as q,T as E,n as L,$ as Ie,a0 as De,a1 as Pe,q as g,F as Re,a2 as M,a3 as H,e as we}from"./index-DOK7aCTJ.js";import{d as ze}from"./Search-ZrCv_Edx.js";import{d as _e,a as Ae,T as Fe,v as Oe,b as $e,c as qe}from"./EditTwoTone-CqRDZMMK.js";import{d as Ee}from"./PrintTwoTone-DkPcRK0U.js";import{F as Le,d as Me}from"./AddTwoTone-dLx9hLK2.js";import{T as He}from"./TextField-DpzXL4Ju.js";import{I as Be}from"./InputAdornment-C1RBlpLr.js";import{T as Ne}from"./TableHead-DituZabM.js";import{b as R,T as Ue,a as We,c as Ke}from"./TableRow-_YPF1XSs.js";import{T as o}from"./TableCell-C3RUmQ-j.js";import{C as K}from"./Checkbox-DY0zuuHu.js";import{g as Ve,I as Ge}from"./getImageUrl-me2J3vIL.js";import{d as Xe}from"./invoice-DL0uFFc9.js";import{d as Ye}from"./DeleteTwoTone-BjqK3A1m.js";import{T as Ze}from"./TablePagination-rvU7ByLE.js";import{D as Je,a as Qe,b as es}from"./DialogContent-Djw2bZG_.js";import{D as ss}from"./DialogTitle-uQU4vRl-.js";import{D as ts}from"./DialogContentText-AwY6IYYq.js";import"./FormHelperText-CEQeOJZI.js";import"./KeyboardArrowRight-OGCTZ71I.js";import"./MenuItem-B9bun-nE.js";const V=({originalRows:t,setRows:a})=>{const[n,r]=c.useState(""),{status:h}=N(),d=k=>{const l=k.target.value.toLowerCase();if(r(l||""),l){const i=t.filter(x=>Object.keys(x).some(S=>{const v=x[S];return v&&v.toString().toLowerCase().includes(l)}));a(i)}else a(t)};return e.jsxs(I,{direction:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",spacing:2,children:[e.jsx(He,{InputProps:{startAdornment:e.jsx(Be,{position:"start",children:e.jsx(ze,{fontSize:"small"})})},onChange:d,placeholder:"البحث عن فاتورة",value:n,size:"small",sx:{width:{xs:1,sm:"auto"}}}),e.jsxs(I,{direction:"row",alignItems:"center",spacing:1.25,children:[e.jsx(T,{title:"Copy",children:e.jsx(C,{size:"large",children:e.jsx(_e,{})})}),e.jsx(T,{title:"Print",children:e.jsx(C,{size:"large",children:e.jsx(Ee,{})})}),e.jsx(T,{title:"Filter",children:e.jsx(C,{size:"large",children:e.jsx(Ae,{})})}),e.jsx(T,{title:"اضافة فاتورة",children:e.jsx(w,{to:`/apps/invoice/create-invoice/${h}`,children:e.jsx(Le,{color:"primary",size:"small",sx:{boxShadow:"none",width:32,height:32,minHeight:32},children:e.jsx(Me,{fontSize:"small"})})})})]})]})};V.propTypes={setRows:b.func,originalRows:b.array};const rs=[{id:"id",numeric:!0,label:"الرقم",align:"center"},{id:"store",numeric:!1,label:"المخزن",align:"center"},{id:"supplierinv",numeric:!1,label:"الفاتورة",align:"center"},{id:"name",numeric:!1,label:"اسم المورد"},{id:"amount",numeric:!0,label:"المبلغ",align:"left"},{id:"status",numeric:!0,label:"الحالة",align:"center"},{id:"date",numeric:!0,label:"التاريخ",align:"center"},{id:"note",numeric:!1,label:"الملاحظات",align:"center"},{id:"payment_status",numeric:!1,label:"السداد",align:"center"},{id:"payment",numeric:!0,label:"المدفوع",align:"left"}],G=({numSelected:t})=>e.jsxs(je,{sx:{p:0,pl:1,pr:1,...t>0&&{color:"secondary.main"}},children:[t>0?e.jsxs(j,{color:"inherit",variant:"h4",children:[t," Selected"]}):e.jsx(j,{variant:"h6",id:"tableTitle",children:"Nutrition"}),e.jsx(U,{sx:{flexGrow:1}})]});G.propTypes={numSelected:b.number.isRequired};const X=({onSelectAllClick:t,order:a,orderBy:n,numSelected:r,rowCount:h,onRequestSort:d,selected:k})=>{const l=i=>x=>{d(x,i)};return e.jsx(Ne,{children:e.jsxs(R,{children:[e.jsx(o,{padding:"checkbox",sx:{pl:3},children:e.jsx(K,{color:"primary",indeterminate:r>0&&r<h,checked:h>0&&r===h,onChange:t,inputProps:{"aria-label":"select all desserts"}})}),r>0&&e.jsx(o,{padding:"none",colSpan:12,children:e.jsx(G,{numSelected:k.length})}),r<=0&&rs.map((i,x)=>{const S=n===i.id;return e.jsx(o,{align:i.align,padding:i.disablePadding?"none":"normal",sortDirection:S?a:void 0,children:e.jsxs(Fe,{active:S,direction:S?a:void 0,onClick:l(i.id),children:[i.label,S&&e.jsx(U,{component:"span",sx:Oe,children:a==="desc"?"sorted descending":"sorted ascending"})]})},x)}),r<=0&&e.jsx(o,{sortDirection:!1,align:"center",sx:{pr:3},children:"الإجراءات"})]})})};X.propTypes={selected:b.array,numSelected:b.number.isRequired,onRequestSort:b.func.isRequired,onSelectAllClick:b.func.isRequired,order:b.oneOf(["asc","desc"]).isRequired,orderBy:b.string.isRequired,rowCount:b.number.isRequired};const B=(t,a,n)=>a[n]<t[n]?-1:a[n]>t[n]?1:0,ls=(t,a)=>t==="desc"?(n,r)=>B(n,r,a):(n,r)=>-B(n,r,a),as=(t,a)=>{const n=t.map((r,h)=>[r,h]);return n.sort((r,h)=>{const d=a(r[0],h[0]);return d!==0?d:r[1]-h[1]}),n.map(r=>r[0])},Y=({rows:t,reloadInvoiceList:a})=>{const n=Se(),[r,h]=c.useState("asc"),[d,k]=c.useState("calories"),[l,i]=c.useState([]),[x,S]=c.useState(0),[v,Z]=c.useState(5),[z,_]=c.useState(null),[J,D]=c.useState(!1),[Q,P]=c.useState(!1),[ee,A]=c.useState(""),[se,F]=c.useState("success");ve();const[y,O]=c.useState(t);c.useEffect(()=>{O(t)},[t]);const m=ye.useMemo(()=>ke({},Pe,n,{direction:"rtl"}),[n]),te=(s,u)=>{h(d===u&&r==="asc"?"desc":"asc"),k(u)},re=async()=>{try{await Xe(z);const s=y.filter(u=>u.invoice_id!==z);O(s),A("تم حذف الفاتورة بنجاح"),F("success"),P(!0),a()}catch(s){console.error("Error deleting invoice:",s),A(s.message||"Error deleting invoice"),F("error"),P(!0)}D(!1),_(null)},le=s=>{if(s.target.checked){if(l.length>0)i([]);else{const u=y.map(p=>p.customer_name);i(u)}return}i([])},ae=(s,u)=>{const p=l.indexOf(u);let f=[];p===-1?f=f.concat(l,u):p===0?f=f.concat(l.slice(1)):p===l.length-1?f=f.concat(l.slice(0,-1)):p>0&&(f=f.concat(l.slice(0,p),l.slice(p+1))),i(f)},ne=(s,u)=>{S(u)},ie=s=>{s!=null&&s.target.value&&Z(parseInt(s==null?void 0:s.target.value,10)),S(0)},oe=s=>l.indexOf(s)!==-1,$=x>0?Math.max(0,(1+x)*v-y.length):0,ce=s=>{switch(s){case 1:return{label:"غير مدفوع",color:"error.main",chipcolor:g(m.palette.error.light,.2)};case 2:return{label:"مدفوع جزئي",color:"#fb6300",chipcolor:g(m.palette.warning.light,.5)};case 3:return{label:"مدفوع",color:"success.dark",chipcolor:g(m.palette.success.light,.5)};default:return{label:"غير مدفوع",color:"error.main",chipcolor:g(m.palette.error.light,.2)}}},de=s=>{switch(s){case 1:return{closedlabel:"تحت الاجراء",closedcolor:"black",closedchipcolor:g("#D3D3D3",.3)};case 2:return{closedlabel:"مطلوب التعديل",closedcolor:"info.dark",closedchipcolor:g(m.palette.info.light,.5)};case 3:return{closedlabel:"موقف",closedcolor:"error.main",closedchipcolor:g(m.palette.error.light,.5)};case 4:return{closedlabel:"تحت التسليم",closedcolor:"black",closedchipcolor:g("#ffecad",.5)};case 5:return{closedlabel:"مستلم",closedcolor:"success.dark",closedchipcolor:g(m.palette.success.light,.5)};case 7:return{closedlabel:"مستلم غير مطابق",closedcolor:"black",closedchipcolor:g(m.palette.success.light,.5)};case 9:return{closedlabel:"مستلم ناقص",closedcolor:"black",closedchipcolor:g(m.palette.success.light,.5)};default:return{closedlabel:"تحت الاجراء",closedcolor:"warning.dark",closedchipcolor:g(m.palette.warning.light,.5)}}},he=s=>s===8?e.jsx(j,{variant:"subtitle1",style:{color:"#673ab7"},children:"مكتملة"}):e.jsx(j,{variant:"subtitle1",style:{color:"grey"},children:"مسودة"});return e.jsxs(Te,{theme:m,children:[e.jsxs(W,{content:!1,children:[e.jsx(Ue,{children:e.jsxs(We,{sx:{minWidth:750},"aria-labelledby":"tableTitle",children:[e.jsx(X,{numSelected:l.length,order:r,orderBy:d,onSelectAllClick:le,onRequestSort:te,rowCount:y.length,selected:l}),e.jsxs(Ke,{children:[y.length===0?e.jsx(R,{children:e.jsx(o,{colSpan:12,align:"center",children:"لا توجد فواتير مضافة"})}):as(y,ls(r,d)).slice(x*v,x*v+v).map((s,u)=>{if(typeof s=="number")return null;const p=oe(s.customer_name),f=`enhanced-table-checkbox-${u}`,{label:ue,color:me,chipcolor:pe}=ce(s.payment_status),{closedlabel:xe,closedcolor:ge,closedchipcolor:fe}=de(s.closed);return e.jsxs(R,{hover:!0,role:"checkbox","aria-checked":p,tabIndex:-1,selected:p,children:[e.jsx(o,{padding:"checkbox",sx:{pl:3},onClick:be=>ae(be,s.customer_name),children:e.jsx(K,{color:"primary",checked:p,inputProps:{"aria-labelledby":f}})}),e.jsxs(o,{children:[e.jsxs(j,{variant:"h5",align:"center",children:["#",s.reference_number]}),he(s.status)]}),e.jsx(o,{align:"center",children:e.jsx(j,{variant:"subtitle1",children:s.StoreName})}),e.jsx(o,{align:"center",children:s.SupplierInvoiceNumber}),e.jsx(o,{children:e.jsxs(I,{direction:"row",spacing:2,children:[e.jsx(Ce,{alt:"",src:Ve(`avatar-${s.avatar}.png`,Ge.USERS)}),e.jsxs(I,{children:[e.jsx(j,{variant:"subtitle1",children:s.customer_name}),e.jsx(j,{variant:"caption",children:s.email})]})]})}),e.jsx(o,{align:"left",children:e.jsx(j,{variant:"h3",style:{fontSize:"1rem",fontWeight:500},children:new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s.total)})}),e.jsx(o,{align:"center",children:e.jsx(q,{label:xe,size:"small",sx:{bgcolor:m.palette.mode===E.DARK?"dark.main":fe,color:ge,cursor:"pointer"}})}),e.jsx(o,{align:"center",sx:{padding:"11px"},children:s.date}),e.jsx(o,{align:"center",children:s.Comment}),e.jsx(o,{align:"center",children:e.jsx(q,{label:ue,size:"small",sx:{bgcolor:m.palette.mode===E.DARK?"dark.main":pe,color:me,cursor:"pointer"}})}),e.jsx(o,{align:"left",children:e.jsx(j,{variant:"h3",style:{fontSize:"1rem",fontWeight:500},children:new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s.Paid)})}),e.jsx(o,{align:"center",sx:{pr:3},children:e.jsxs(I,{direction:"row",alignItems:"center",spacing:1,justifyContent:"center",children:[e.jsx(T,{title:"مشاهدة",children:e.jsx(C,{color:"primary",component:w,to:`/apps/invoice/invoice-details/${s.invoice_id}`,size:"small","aria-label":"View",children:e.jsx($e,{sx:{fontSize:"1.3rem"}})})}),s.status!==8&&e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"تعديل",children:e.jsx(C,{color:"secondary",component:w,to:`/apps/invoice/edit/${s.invoice_id}`,size:"small","aria-label":"Edit",children:e.jsx(qe,{sx:{fontSize:"1.3rem"}})})}),e.jsx(T,{title:"حذف",children:e.jsx(C,{color:"error",size:"small","aria-label":"Delete",onClick:()=>{_(s.invoice_id),D(!0)},children:e.jsx(Ye,{sx:{fontSize:"1.3rem"}})})})]}),"                                                "]})})]},u)}),y.length>0&&$>0&&e.jsx(R,{sx:{height:53*$},children:e.jsx(o,{colSpan:10})})]})]})}),e.jsx(Ze,{rowsPerPageOptions:[5,10,25],component:"div",count:y.length,rowsPerPage:v,page:x,onPageChange:ne,onRowsPerPageChange:ie}),e.jsxs(Je,{open:J,onClose:()=>D(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ss,{id:"alert-dialog-title",children:"حذف الفاتورة"}),e.jsx(Qe,{children:e.jsx(ts,{id:"alert-dialog-description",children:"هل انت متاكد من حذف الفاتورة؟"})}),e.jsxs(es,{children:[e.jsx(L,{onClick:()=>D(!1),color:"primary",children:"الغاء"}),e.jsx(L,{onClick:re,color:"primary",autoFocus:!0,children:"حذف"})]})]})]}),e.jsx(Ie,{open:Q,autoHideDuration:6e3,onClose:()=>P(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(De,{onClose:()=>P(!1),severity:se,sx:{width:"100%"},children:ee})})]})};Y.propTypes={rows:b.array};const Ds=()=>{const{invoicelist:t}=Re(l=>l.customer),{status:a}=N(),[n,r]=c.useState([]),[h,d]=c.useState([]);c.useEffect(()=>{M(H())},[]);const k=()=>{M(H()).then(()=>{console.log("Invoice list reloaded successfully")}).catch(l=>{console.error("Error reloading invoice list:",l)})};return c.useEffect(()=>{if(t)if(r(t),console.log("Filtering invoices based on status:",a),console.log("Original rows:",t),a)if(parseInt(a)===5){const l=t.filter(i=>[5,6,7,8].includes(parseInt(i.status)));d(l)}else{const l=t.filter(i=>parseInt(i.status)===parseInt(a));d(l)}else d(t)},[t,a]),e.jsxs(W,{content:!1,children:[e.jsx(we,{children:e.jsx(V,{originalRows:n,setRows:d})}),e.jsx(Y,{rows:h,reloadInvoiceList:k})]})};export{Ds as default};
