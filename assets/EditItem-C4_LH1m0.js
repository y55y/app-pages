import{r as m,j as e,I as G,as as H,B as i,G as s,m as Q,n as T,$ as V,a0 as J,P as W}from"./index-XVM9mx7l.js";import{I as K}from"./InputFileUpload-Dsx1KH4z.js";import{a as X,u as Y}from"./item-bd31sZIv.js";import{A as S}from"./AutocompleteSearch-OpUgRaPg.js";import{D as Z}from"./DeleteComponent-DnYORHOy.js";import{D as ee,a as re,b as te}from"./DialogContent-FwKKfc-z.js";import{D as ae}from"./DialogTitle-Cmfixd_M.js";import{C as se}from"./CircularProgress-nxJx_2CH.js";import{T as c}from"./TextField-DYZP-4er.js";import{T as ie,a as R}from"./Tabs-BK4vrhAw.js";import"./formik.esm-BHBcBD92.js";import"./CardMedia-Dy-fI3Nx.js";import"./Delete-D6ocRBy5.js";import"./FormHelperText-DqzDUD1o.js";import"./Search-DS-NdOMX.js";import"./fetchdata-CmVIc4Xo.js";import"./Autocomplete-D95ZHlWZ.js";import"./InputAdornment-BGInT8Rh.js";import"./MessageSnackbar-w94oQx8o.js";import"./DialogContentText-CPuE_UhI.js";import"./KeyboardArrowRight-2p2ScMJN.js";const F=({children:b,value:u,index:x,...D})=>e.jsx("div",{role:"tabpanel",hidden:u!==x,id:`tabpanel-${x}`,"aria-labelledby":`tab-${x}`,...D,children:u===x&&e.jsx(i,{sx:{p:3},children:b})}),oe=({open:b,onClose:u,selectedSubRowId:x,onUpdate:D})=>{const g=x,[t,n]=m.useState({ID:"",ItemLookupCode:"",BarCodeNo:"",Name:"",Description:"",Notes:"",Cost:"",Price:"",salePrice:"",Quantity:"",DepartmentID:"",CategoryID:"",CategoryName:"",SupplierID:"",StoreID:0,SupplierPurchaseInvoiceNumber:"",image_base64:null,image:0,imageurl:"",uploadedimage:0}),[q,h]=m.useState(!1),[B,j]=m.useState(""),[_,f]=m.useState("success"),[y,v]=m.useState({}),[L,N]=m.useState(!0),[I,w]=m.useState(0);m.useEffect(()=>{g&&(async()=>{N(!0);try{const a=await X(g);a&&a.item&&n({...a.item,image_base64:a.item.image_base64||null}),N(!1)}catch(a){console.error("Error fetching item data:",a),f("error"),j("Failed to fetch item data. Please try again."),h(!0)}})()},[b]);const z=r=>{n(a=>({...a,SupplierID:r.ID,SupplierName:r.Name}))},O=r=>{n(a=>({...a,StoreID:r.ID,StoreName:r.Name}))},A=r=>{n(a=>({...a,CategoryID:r.ID,CategoryName:r.Name}))},d=r=>{const{name:a,value:o}=r.target;n(p=>({...p,[a]:o})),a==="DepartmentID"&&n(p=>({...p,CategoryID:""}))},E=r=>{if(r===0){n(o=>({...o,image_base64:null,uploadedimage:1}));return}if(!(r instanceof Blob)){console.error("The provided file is not of type Blob or File.");return}const a=new FileReader;a.onload=()=>{const o=a.result.split(",")[1];n(p=>({...p,image_base64:o,uploadedimage:1}))},a.onerror=o=>{console.error("FileReader error:",o)},a.readAsDataURL(r)},U=()=>{n(r=>({...r,image_base64:null,image:0,uploadedimage:1,imageurl:""}))},$=async r=>{r.preventDefault();const o=["Name"].reduce((l,P)=>(t[P]||(l[P]=!0),l),{});if(Object.keys(o).length>0){v(o),f("error"),j("Please fill in the required field (Name)."),h(!0);return}const p={...t,StoreID:t.StoreID||0};try{const l=await Y(g,p);l&&l.item_id?(D({...t,itemid:l.item_id,Supplier_Item_ID:t.ItemLookupCode,name:t.Name}),v({}),u()):(f("error"),j("Unexpected error: Item ID missing in response."),h(!0))}catch(l){console.error("Error updating item:",l.response?l.response.data:l.message),f("error"),j("Failed to update item. Please try again."),h(!0)}},k=()=>{h(!1)},C=r=>({error:!!y[r],helperText:y[r]?"This field is required":""}),M=(r,a)=>{w(a)};return e.jsxs(ee,{open:b,onClose:u,fullWidth:!0,maxWidth:"md",sx:{"& .MuiDialog-paper":{maxWidth:"80%",width:"80%"}},children:[e.jsxs(ae,{children:["تعديل منتج",e.jsx(G,{"aria-label":"close",onClick:u,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(H,{})})]}),e.jsx(re,{children:L?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:e.jsx(se,{})}):e.jsx(i,{sx:{p:2.5},children:e.jsxs(s,{container:!0,spacing:Q,children:[e.jsx(s,{item:!0,xs:6,children:e.jsxs(i,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(i,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"الرئيسية"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,sm:8,children:e.jsx(c,{fullWidth:!0,label:"اسم المنتج",name:"Name",value:t.Name,onChange:d,size:"small",required:!0,...C("Name")})}),e.jsx(s,{item:!0,xs:12,sm:4,children:e.jsx(c,{fullWidth:!0,label:"رقم المنتج",name:"BarCodeNo",value:t.BarCodeNo,onChange:d,size:"small",required:!0})})]})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(i,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(i,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"الاسعار"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,sm:4,children:e.jsx(c,{fullWidth:!0,label:"التكلفة",name:"Cost",value:t.Cost,onChange:d,size:"small",required:!0,...C("Cost")})}),e.jsx(s,{item:!0,xs:12,sm:4,children:e.jsx(c,{fullWidth:!0,label:"سعر البيع",name:"Price",value:t.Price,onChange:d,size:"small",required:!0,...C("Price")})}),e.jsx(s,{item:!0,xs:12,sm:4,children:e.jsx(c,{fullWidth:!0,label:"سعر التخفيض",name:"salePrice",value:t.salePrice,onChange:d,size:"small"})})]})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(i,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(i,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"المورد"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(S,{placeholder:"بحث عن المورد",noOptionsText:"لا يوجد موردين",onOptionSelect:z,value:t.SupplierID?{ID:t.SupplierID,Name:t.SupplierName}:null,type:"Supplier"})}),e.jsx(s,{item:!0,xs:12,sm:3,children:e.jsx(c,{fullWidth:!0,label:"رقم الفاتورة",name:"SupplierPurchaseInvoiceNumber",value:t.SupplierPurchaseInvoiceNumber,onChange:d,size:"small",required:!0,disabled:!0})}),e.jsx(s,{item:!0,xs:12,sm:3,children:e.jsx(c,{fullWidth:!0,label:"كود المنتج",name:"ItemLookupCode",value:t.ItemLookupCode,onChange:d,size:"small",required:!0})})]})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(i,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(i,{sx:{fontWeight:"bold",mb:1,backgroundColor:"#ede7f66b",p:1,borderRadius:"4px"},children:"التصنيفات"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(S,{onOptionSelect:O,placeholder:"ابحث عن موقع",type:"Store",LoadAllData:!0,value:t.StoreID?{ID:t.StoreID,Name:t.StoreName}:null})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(S,{onOptionSelect:A,placeholder:"ابحث عن تصنيف",type:"Category",getOptionLabel:r=>`${r.Name}`,LoadAllData:!0,value:t.CategoryID?{ID:t.CategoryID,Name:t.CategoryName}:null})})]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsxs(i,{sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsxs(ie,{value:I,onChange:M,"aria-label":"Description and Image Tabs",children:[e.jsx(R,{label:"الوصف",id:"tab-0","aria-controls":"tabpanel-0"}),e.jsx(R,{label:"الصورة",id:"tab-1","aria-controls":"tabpanel-1"})]}),e.jsxs(F,{value:I,index:0,children:[e.jsx(c,{fullWidth:!0,label:"الوصف",multiline:!0,rows:2,name:"Description",value:t.Description,onChange:d}),e.jsx(c,{fullWidth:!0,label:"ملاحظات",multiline:!0,rows:2,name:"Notes",value:t.Notes,onChange:d,sx:{mt:2}})]}),e.jsx(F,{value:I,index:1,children:e.jsx(i,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:e.jsx(K,{handleFileSelect:E,imageUrl:t.image===1?t.imageurl:void 0,handleDelete:U})})})]})})]})})}),e.jsxs(te,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Z,{resourceId:g,resource:"item",entityName:"المنتج",onDelete:u}),e.jsxs(i,{children:[e.jsx(T,{onClick:u,sx:{mr:1},children:"إلغاء"}),e.jsx(T,{onClick:$,variant:"contained",color:"primary",children:"حفظ التغييرات"})]})]}),e.jsx(V,{open:q,autoHideDuration:4e3,onClose:k,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(J,{onClose:k,severity:_,sx:{width:"100%"},children:B})})]})};oe.propTypes={open:W.bool.isRequired,onClose:W.func.isRequired};export{oe as default};
