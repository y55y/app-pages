import{r as c,j as e,B as y,n as j}from"./index-BVdUMQzQ.js";import{g as k}from"./fetchdata-EOtbV5TB.js";import $ from"./index-Di5qrhth.js";import M from"./index-BTCE-Dod.js";import{B as q}from"./index-BaA9yc1y.js";import{A as L}from"./AccountStatement-DOLQCZk5.js";import{a as z,d as G,e as K}from"./client-Dka7Z19Y.js";import{D as I,a as R,b as v}from"./DialogContent-8g-uaxVZ.js";import{D as F}from"./DialogTitle-De5HDiQS.js";import{T as f}from"./TextField-BpMEqyGd.js";import{A as O}from"./Autocomplete-D9EHyKg-.js";import{C as B}from"./CircularProgress-CEBJzR_F.js";import{D as H}from"./DialogContentText-BqtvGEMb.js";import"./InputFileUpload-BKoAOPSU.js";import"./formik.esm-jehN7sSp.js";import"./CardMedia-CNpcyg8V.js";import"./Delete-BgrzcClf.js";import"./FormHelperText-Ddk6A_UX.js";import"./Tabs-BG6yMNAL.js";import"./KeyboardArrowRight-w44rCLkW.js";import"./DeleteComponent-DuBIyZFp.js";import"./MessageSnackbar-Dd6YaDgZ.js";import"./Search-C8CX3S6J.js";import"./InputAdornment-CrMgPK6V.js";import"./TablePagination-ZYSYCgUV.js";import"./TableCell-y3q6i7yU.js";import"./MenuItem-BOBO7Pa6.js";import"./DataGrid-DMIjrIuv.js";import"./typeof-QjJsDpFa.js";import"./Checkbox-J416lFQR.js";import"./Skeleton-BEOxZ8sC.js";import"./FormControlLabel-DHYN22g9.js";import"./SubCard-DJAk_xUy.js";import"./index-C5VPwIRQ.js";import"./TableRow-DtswgKf-.js";import"./TableHead-kyMlb7gP.js";const J=({open:S,onClose:d,addType:D,rows:A,selectedRowId:b,mainAccounts:u,setMessage:h})=>{const[t,m]=c.useState({accountName:"",notes:"",accountNumber:"",mainAccount:null,accountType:1,permission:null,Ref:""}),[i,g]=c.useState({}),[C,p]=c.useState(!1);c.useEffect(()=>{const n=u.find(l=>l.ClientID===b);n&&o("mainAccount")(null,n)},[b,u]);const E=n=>{if(!n){const r=u.filter(x=>x.Father===0);let a;r.length>0?a=((Math.max(...r.map(w=>parseInt(w.Code)))||0)+1).toString():a="1",m(x=>({...x,accountNumber:a,accountType:1}));return}const l=n.AccD?1:0,s=D===1?u.filter(r=>r.Father===n.ClientID):A.filter(r=>r.Father===n.ClientID);let N;s.length>0?N=(Math.max(...s.map(a=>parseInt(a.Code)))+1).toString():N=n.Code+(D===1?"01":"001"),m(r=>({...r,accountNumber:N,accountType:l}))},o=n=>(l,s)=>{n==="mainAccount"?(m({...t,mainAccount:s}),E(s)):m(n==="permission"?{...t,[n]:s}:n==="accountType"?{...t,accountType:parseInt(l.target.value)}:{...t,[n]:l.target.value}),g({...i,[n]:""})},T=async()=>{const n={};if(t.accountName.trim()||(n.accountName="اسم مجموعة المورد مطلوب"),t.accountNumber.trim()||(n.accountNumber="رقم مجموعة المورد مطلوب"),Object.keys(n).length>0){g(n);return}p(!0);try{const l={ClientMainType:1,ClientMainID:t.accountNumber,ClientMainName:t.accountName,Father:t.mainAccount?t.mainAccount.ClientID:0,Note:t.notes,Ref:t.Ref};await z(l),d(),h({open:!0,type:"success",text:"تمت إضافة مجموعة الموردين بنجاح"})}catch(l){console.error("Error submitting form:",l),h({open:!0,type:"error",text:"حدث خطأ أثناء إضافة مجموعة الموردين"})}finally{p(!1)}};return e.jsxs(I,{open:S,onClose:d,maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{children:"اضافة مجموعة موردين"}),e.jsx(R,{children:e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[e.jsxs(y,{sx:{flex:1},children:[e.jsx(f,{label:"اسم مجموعة الموردين",value:t.accountName,onChange:o("accountName"),fullWidth:!0,required:!0,margin:"normal",error:!!i.accountName,helperText:i.accountName}),e.jsx(f,{label:"رقم المرجع",value:t.Ref,onChange:o("Ref"),type:"number",fullWidth:!0,margin:"normal",error:!!i.Ref,helperText:i.Ref}),e.jsx(f,{label:"ملاحظات",value:t.notes,onChange:o("notes"),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]}),e.jsxs(y,{sx:{flex:1},children:[e.jsx(f,{label:"رقم مجموعة الموردين",value:t.accountNumber,onChange:o("accountNumber"),type:"number",fullWidth:!0,required:!0,margin:"normal",error:!!i.accountNumber,helperText:i.accountNumber}),e.jsx(O,{options:u,getOptionLabel:n=>`${n.Code} - ${n.Name}`,value:t.mainAccount||null,onChange:o("mainAccount"),renderInput:n=>e.jsx(f,{...n,label:"مجموعة الموردين",margin:"normal"}),fullWidth:!0})]})]})}),e.jsxs(v,{children:[e.jsx(j,{onClick:d,color:"secondary",children:"إلغاء"}),e.jsx(j,{onClick:T,color:"primary",variant:"contained",disabled:C,children:C?e.jsxs(e.Fragment,{children:["قيد الاضافة",e.jsx(B,{size:24,sx:{ml:1}})]}):"إضافة مجموعة موردين"})]})]})},Q=({open:S,onClose:d,rows:D,setSelectedRowId:A,selectedRowId:b,mainAccounts:u,setMessage:h})=>{const[t,m]=c.useState({accountName:"",notes:"",accountNumber:"",mainAccount:null,Ref:"",Code:""}),[i,g]=c.useState({}),[C,p]=c.useState(!1),[E,o]=c.useState(!1);c.useEffect(()=>{if(b){const r=u.find(a=>a.ClientID===b);r&&m({accountName:r.Name,notes:r.Note||"",accountNumber:r.ClientID,mainAccount:u.find(a=>a.ClientID===r.Father)||null,Ref:r.Ref||"",Code:r.Code})}},[b,D,u]);const T=()=>{o(!0)},n=async()=>{p(!0);try{await G(t.accountNumber),A(null),h({open:!0,type:"success",text:"تم حذف المورد بنجاح"}),d()}catch(r){console.error("Error deleting account:",r),h({open:!0,type:"error",text:"حدث خطأ أثناء حذف المورد"})}finally{p(!1),o(!1)}},l=()=>{o(!1)},s=r=>(a,x)=>{m(r==="mainAccount"?{...t,mainAccount:x}:{...t,[r]:a.target.value}),g({...i,[r]:""})},N=async()=>{const r={};if(t.accountName.trim()||(r.accountName="اسم المورد مطلوب"),String(t.accountNumber).trim()||(r.accountNumber="رقم المورد مطلوب"),Object.keys(r).length>0){g(r);return}p(!0);try{const a={ClientMainType:2,ClientMainID:t.accountNumber,ClientMainName:t.accountName,Father:t.mainAccount?t.mainAccount.ClientID:0,Note:t.notes,Ref:t.Ref};await K(a),h({open:!0,type:"success",text:"تم تحديث بيانات المورد بنجاح"}),d()}catch(a){console.error("Error updating form:",a),h({open:!0,type:"error",text:"حدث خطأ أثناء تحديث بيانات المورد"})}finally{p(!1)}};return e.jsxs(I,{open:S,onClose:d,maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{children:"تعديل مجموعة مورد"}),e.jsx(R,{children:e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[e.jsxs(y,{sx:{flex:1},children:[e.jsx(f,{label:"اسم المورد",value:t.accountName,onChange:s("accountName"),fullWidth:!0,required:!0,margin:"normal",error:!!i.accountName,helperText:i.accountName}),e.jsx(f,{label:"رقم المرجع",value:t.Ref,onChange:s("Ref"),type:"number",fullWidth:!0,margin:"normal",error:!!i.Ref,helperText:i.Ref}),e.jsx(f,{label:"ملاحظات",value:t.notes,onChange:s("notes"),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]}),e.jsxs(y,{sx:{flex:1},children:[e.jsx(f,{label:"رقم المورد",value:t.Code,onChange:s("Code"),type:"number",fullWidth:!0,required:!0,margin:"normal",error:!!i.Code,helperText:i.Code,disabled:!0}),e.jsx(O,{options:u.filter(r=>{const a=r.ClientID!==t.accountNumber,x=w=>{if(w.Father===t.accountNumber)return!1;const W=u.find(P=>P.ClientID===w.Father);return W?x(W):!0};return a&&x(r)}),getOptionLabel:r=>`${r.Code} - ${r.Name}`,value:t.mainAccount||null,onChange:s("mainAccount"),renderInput:r=>e.jsx(f,{...r,label:"المورد الرئيسي",margin:"normal"}),fullWidth:!0})]})]})}),e.jsxs(v,{children:[e.jsx(j,{onClick:T,color:"error",variant:"outlined",disabled:C,children:"حذف"}),e.jsx(y,{sx:{flexGrow:1}}),e.jsx(j,{onClick:d,color:"secondary",children:"إلغاء"}),e.jsx(j,{onClick:N,color:"primary",variant:"contained",disabled:C,children:C?e.jsxs(e.Fragment,{children:["قيد الحفظ",e.jsx(B,{size:24,sx:{ml:1}})]}):"حفظ التغييرات"})]}),e.jsxs(I,{open:E,onClose:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(F,{id:"alert-dialog-title",children:"تأكيد الحذف"}),e.jsx(R,{children:e.jsx(H,{id:"alert-dialog-description",children:"هل أنت متأكد من حذف هذا المورد؟"})}),e.jsxs(v,{children:[e.jsx(j,{onClick:l,children:"إلغاء"}),e.jsx(j,{onClick:n,autoFocus:!0,children:"تأكيد"})]})]})]})},Re=()=>{const[S,d]=c.useState([]),[D,A]=c.useState([]),[b,u]=c.useState(0),[h,t]=c.useState(!1),[m,i]=c.useState(0),g=[{text:"كشف حساب",component:L,isDisabled:!1},{text:"Edit Client",component:M,isDisabled:!1}],C=[{field:"Name",headerName:"العميل",flex:2,valueGetter:o=>`${o.row.Code} - ${o.row.Name}`},{field:"MobileNumber",headerName:"رقم الجوال",flex:1},{field:"vat",headerName:"الرقم الضريبي",flex:1},{field:"Balance",headerName:"الرصيد",flex:1}],p=async()=>{try{const o=await k("/api/client/list/main",{type:1});d(o)}catch(o){console.error("Error fetching client tree data:",o)}},E=async(o,T,n,l,s,N,r)=>{try{t(!0);const a=await k("/api/client/list/sub",{Father:o,page:T,pageSize:n,type:1,rowID:l,search:s,field:N,sort:r});t(!1),A(a.data),u(a.totalRows),a.page!==null&&i(a.page)}catch(a){console.error("Error fetching client tree data:",a),t(!1)}};return c.useEffect(()=>{p()},[]),e.jsx(q,{mainData:S,rows:D,dataKey:"ClientID",dataCode:"Code",fetchTreeData:p,fetchSubTreeData:E,columns:C,apiSearchEndpoint:"/api/supplier/search",PopupAddMain:J,PopupEditMain:Q,AddEntityComponent:$,EditEntityComponent:M,rowCount:b,isLoading:h,entityName:"مورد",mainName:"مجموعة",page:m,setPage:i,reportOptions:g})};export{Re as default};
