import{r as i,j as t,n as C,h as P,k as u,S as k}from"./index-BVdUMQzQ.js";import{p as L,u as $,g as D}from"./fetchdata-EOtbV5TB.js";import{B as z}from"./index-BaA9yc1y.js";import{A as B}from"./AccountStatement-DOLQCZk5.js";import q from"./AddItem-CMloWsrj.js";import _ from"./EditItem-CXUvHrWv.js";import{A as j}from"./item-DodNbPzd.js";import{D as N,a as S,b as I}from"./DialogContent-8g-uaxVZ.js";import{D as F}from"./DialogTitle-De5HDiQS.js";import{T as v}from"./TextField-BpMEqyGd.js";import{D as G}from"./DeleteComponent-DuBIyZFp.js";import"./Search-C8CX3S6J.js";import"./Autocomplete-D9EHyKg-.js";import"./FormHelperText-Ddk6A_UX.js";import"./InputAdornment-CrMgPK6V.js";import"./CircularProgress-CEBJzR_F.js";import"./TablePagination-ZYSYCgUV.js";import"./KeyboardArrowRight-w44rCLkW.js";import"./TableCell-y3q6i7yU.js";import"./MenuItem-BOBO7Pa6.js";import"./DataGrid-DMIjrIuv.js";import"./typeof-QjJsDpFa.js";import"./Checkbox-J416lFQR.js";import"./Skeleton-BEOxZ8sC.js";import"./FormControlLabel-DHYN22g9.js";import"./MessageSnackbar-Dd6YaDgZ.js";import"./SubCard-DJAk_xUy.js";import"./index-C5VPwIRQ.js";import"./TableRow-DtswgKf-.js";import"./TableHead-kyMlb7gP.js";import"./InputFileUpload-BKoAOPSU.js";import"./formik.esm-jehN7sSp.js";import"./CardMedia-CNpcyg8V.js";import"./Delete-BgrzcClf.js";import"./Tabs-BG6yMNAL.js";import"./DialogContentText-BqtvGEMb.js";const K=({open:h,onClose:c,setMessage:m,selectedRowId:p,mainAccounts:l})=>{const[o,n]=i.useState({Name:"",FatherID:null}),[y,s]=i.useState(null);i.useEffect(()=>{if(p&&l){const e=l.find(r=>r.ID===p);e&&e.Type==="Category"?(s(e),n(r=>({...r,FatherID:e.Code}))):(s(null),n(r=>({...r,FatherID:null})))}},[p,l]);const d=e=>{n({...o,[e.target.name]:e.target.value})},g=e=>{s(e),n({...o,FatherID:e?e.ID:null})},x=async()=>{if(!o.Name.trim()){m({open:!0,type:"error",text:"يرجى إدخال اسم التصنيف"});return}try{const e=await L("/api/items/category",o);e&&e.CategoryID?(m({open:!0,type:"success",text:"تم إنشاء التصنيف بنجاح"}),a()):e&&e.error?m({open:!0,type:"error",text:`حدث خطأ أثناء إنشاء التصنيف: ${e.error}`}):m({open:!0,type:"error",text:"حدث خطأ غير متوقع أثناء إنشاء التصنيف"})}catch(e){console.error("Error creating new category:",e),m({open:!0,type:"error",text:`حدث خطأ أثناء الاتصال بالخادم: ${e.message}`})}},a=()=>{n({Name:"",FatherID:null}),s(null),c()};return t.jsxs(N,{open:h,onClose:a,children:[t.jsx(F,{children:"إضافة تصنيف جديد"}),t.jsxs(S,{children:[t.jsx(j,{onOptionSelect:g,placeholder:"ابحث عن تصنيف رئيسي",type:"Category",getOptionLabel:e=>`${e.Name}`,value:y,LoadAllData:!0}),t.jsx(v,{autoFocus:!0,margin:"dense",name:"Name",label:"اسم التصنيف",type:"text",size:"small",fullWidth:!0,variant:"outlined",value:o.Name,onChange:d})]}),t.jsxs(I,{children:[t.jsx(C,{onClick:a,children:"إلغاء"}),t.jsx(C,{onClick:x,children:"حفظ"})]})]})},O=({open:h,onClose:c,selectedRowId:m,mainAccounts:p,setMessage:l})=>{const[o,n]=i.useState(null),[y,s]=i.useState(null);i.useEffect(()=>{if(m){n(null),s(null);const a=p.find(e=>e.ID===m);if(a)if(a.Type==="Category"){n({...a});const e=p.find(r=>r.ID===a.Father);e&&e.Type==="Category"?s(e):s(null)}else a.Type==="CategoryAuto"?(l({open:!0,type:"error",text:"لا يمكن تعديل تصنيف الي"}),c()):(l({open:!0,type:"error",text:"يمكن تعديل التصنيفات فقط"}),c())}},[h]);const d=a=>{n(e=>({...e,[a.target.name]:a.target.value}))},g=a=>{s(a),n(e=>({...e,FatherID:a?a.ID:null}))},x=async()=>{if(o&&o.Type==="Category")try{const a={Name:o.Name,FatherID:o.FatherID||0};await $("/api/items/category",o.Code,a),l({open:!0,type:"success",text:"تم تحديث التصنيف بنجاح"}),c()}catch(a){console.error("Error updating category:",a),l({open:!0,type:"error",text:"حدث خطأ أثناء تحديث التصنيف"})}else l({open:!0,type:"error",text:"لا يمكن حفظ التغييرات. هذا الحساب ليس تصنيفًا."})};return t.jsxs(N,{open:h,onClose:c,children:[t.jsx(F,{children:"تعديل التصنيف"}),t.jsx(S,{children:o&&t.jsxs(t.Fragment,{children:[t.jsx(j,{onOptionSelect:g,placeholder:"ابحث عن تصنيف رئيسي",type:"Category",getOptionLabel:a=>`${a.Name}`,value:y}),t.jsx(v,{autoFocus:!0,margin:"dense",name:"Name",label:"اسم التصنيف",type:"text",size:"small",fullWidth:!0,value:o.Name||"",onChange:d})]})}),t.jsxs(I,{children:[o&&o.Type==="Category"&&t.jsx(G,{resourceId:o.Code,resource:"category",entityName:"التصنيف",onDelete:c,size:"medium",variant:"text"}),t.jsx("div",{style:{flexGrow:1}}),t.jsx(C,{onClick:c,children:"إلغاء"}),t.jsx(C,{onClick:x,disabled:!o,children:"حفظ"})]})]})},ve=()=>{const[h,c]=i.useState([]),[m,p]=i.useState([]),[l,o]=i.useState(0),[n,y]=i.useState(0),[s,d]=i.useState(!1);P();const g=[{text:"كشف حساب",component:B,isDisabled:!1}],x=[{field:"ID",headerName:"الرقم",minWidth:100,flex:.5,align:"left",renderCell:r=>t.jsx(u,{variant:"h5",children:r.row.ID})},{field:"Name",headerName:"اسم الصنف",minWidth:150,flex:2,align:"left",renderCell:r=>t.jsx(u,{variant:"h5",children:r.row.Name})},{field:"CategoryName",headerName:"التصنيف",minWidth:120,flex:1,align:"left",renderCell:r=>t.jsx(u,{children:r.row.CategoryName})},{field:"quantity",headerName:"الكمية",minWidth:100,flex:1,align:"left",renderCell:r=>t.jsx(u,{variant:"h5",children:r.row.quantity})},{field:"Price",headerName:"السعر",minWidth:100,flex:1,align:"left",renderCell:r=>t.jsx(u,{variant:"h5",children:r.row.Price})},{field:"SupplierName",headerName:"المورد",minWidth:150,flex:2,align:"left",renderCell:r=>t.jsxs(k,{children:[t.jsx(u,{variant:"h5",children:r.row.SupplierName}),t.jsx(u,{variant:"caption",children:r.row.Supplier_Item_ID})]})}],a=async()=>{try{const r=await D("/api/items/list/main",{});c(r)}catch(r){console.error("Error fetching client tree data:",r)}},e=async(r,w,T,E,b,A,W)=>{try{d(!0);const f=await D("/api/items/list/sub",{Father:r,page:w,pageSize:T,rowID:E,search:b,field:A,sort:W});p(f.data),o(f.totalRows),f.page!==null&&y(f.page),d(!1)}catch(f){console.error("Error fetching client tree data:",f),d(!1)}};return i.useEffect(()=>{a()},[]),t.jsx(z,{mainData:h,rows:m,dataKey:"ID",dataCode:"Code",Name:"Name",fetchTreeData:a,fetchSubTreeData:e,columns:x,apiSearchEndpoint:"/api/accounting/entry/search",PopupAddMain:K,PopupEditMain:O,AddEntityComponent:q,EditEntityComponent:_,rowCount:l,entityName:"صنف",mainName:"تصنيف",page:n,isLoading:s,setPage:y,reportOptions:g,disableIDTree:!0,isTypeIcon:!0})};export{ve as default};
