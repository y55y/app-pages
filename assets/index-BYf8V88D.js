import{t as Se,j as e,P as T,r as n,aH as se,B as R,G as i,n as O,aL as be,aM as De,I as ne,D as X,S as ee,ay as Z,h as Ie,k as q,q as V,Z as ve}from"./index-C1vuB0Zl.js";import{g as ae}from"./fetchdata-C5vvU8P_.js";import{B as Ce}from"./index-CLN1TN4c.js";import{A as Ne}from"./AccountStatement-Db1W44fv.js";import{s as Q,g as Me,c as Ae,a as ke,e as We}from"./payment-BzZFT7CQ.js";import{g as re}from"./userinfo-Cbh1fxrs.js";import{T as x,S as $}from"./TextField-DemmnEBt.js";import{A as U}from"./Autocomplete-B7EW2UmI.js";import{M as L}from"./MenuItem-DVgWCHz_.js";import{R as oe,a as _}from"./RadioGroup-B4ZkIa2c.js";import{F as J}from"./FormControlLabel-BS626x8O.js";import{a as G,I as K}from"./FormHelperText-CJz8FjPU.js";import{C as te}from"./CircularProgress-Bi4DA5uq.js";import{D as le}from"./DeleteComponent-BJN9-6tL.js";import{d as H,A as ie}from"./AdapterDayjs-Cfdt5q4h.js";import{P as ce,d as de}from"./PaymentTitle-D2huIcU6.js";import{D as ue,a as me,b as we}from"./DialogContent-V_Nk_Bat.js";import{D as he}from"./DialogTitle-uXUM5z9C.js";import{I as fe}from"./InputAdornment-v6BUM93t.js";import{L as pe,D as xe}from"./DatePicker-zj88NoKH.js";import{C as Ee}from"./CardActions-D5oSPY-n.js";import"./Search-HRIUStz7.js";import"./DataGrid-BzpaBjwl.js";import"./typeof-QjJsDpFa.js";import"./Checkbox-C7FWu3vy.js";import"./Skeleton-V7VDMUJl.js";import"./TablePagination-BmCpF8HE.js";import"./KeyboardArrowRight-DWAz6Niz.js";import"./TableCell-CvzL8Kly.js";import"./MessageSnackbar-tMyAch-w.js";import"./SubCard-DYnv5ytM.js";import"./index-B7QVJcTw.js";import"./TableRow-mJQmyyGs.js";import"./TableHead-BykaoHle.js";import"./DialogContentText-JcoReyo0.js";import"./ListItem-BoO_L8J_.js";var ze=Se("file","IconFile",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}]]);const Be=({dateString:g})=>{const m=I=>{const h=new Date(I);if(isNaN(h))return"Invalid Date";const y=String(h.getDate()).padStart(2,"0"),k=String(h.getMonth()+1).padStart(2,"0"),f=h.getFullYear();return`${y}/${k}/${f}`};return e.jsx("div",{children:m(g)})},ye=({open:g,onClose:m,setMessage:I})=>{const[h,y]=n.useState(""),[k,f]=n.useState(""),[v,N]=n.useState(!1),[S,W]=n.useState(""),[w,M]=n.useState(""),[E,z]=n.useState(""),[d,C]=n.useState(!1),[D,o]=n.useState([]),[p,c]=n.useState({paymentMethod:""}),[j,u]=n.useState(null),[B,b]=n.useState({}),[P,F]=n.useState([]);n.useEffect(()=>{(async()=>{try{const l=await Q(["paymentMethods"]);console.log("Payment methods:",l.paymentMethods),o(l.paymentMethods),l.paymentMethods.length>0&&c(A=>({...A,paymentMethod:l.paymentMethods[0].paymentMethodID}))}catch(l){console.error("Error fetching payment methods:",l)}})()},[]),n.useEffect(()=>{a()},[]);const a=async()=>{try{const t=await re();t&&Array.isArray(t.stores)?(F(t.stores),t.stores.length>0&&u(t.stores[0])):console.error("Fetched data does not contain stores array:",t)}catch(t){console.error("Error fetching locations:",t.message)}},r=t=>{const{name:l,value:A}=t.target;c(Y=>({...Y,[l]:A}))},s=async t=>{if(t.preventDefault(),C(!0),!p.paymentMethod||!j){I({open:!0,type:"error",text:"يجب تحديد طريقة دفع ومتجر قبل الإضافة."}),C(!1);return}const l={safeName:h,safeACC:k,isBank:v,safeBankN:v?S:null,safeBankA:v?w:null,safeNote:E,safePD:p.paymentMethod,store:j?j.StoreID:null};try{const A=await be(l);console.log("Safe added successfully:",A),m()}catch(A){console.error("Error adding safe:",A)}finally{C(!1)}};return e.jsx(se,{open:g,onClose:m,children:e.jsx(R,{sx:{width:400,margin:"100px auto",padding:4,backgroundColor:"white",borderRadius:2},children:e.jsxs("form",{onSubmit:s,children:[e.jsx("h2",{children:"إضافة خزينة"}),e.jsx(x,{fullWidth:!0,label:"اسم الخزينة",value:h,onChange:t=>y(t.target.value),required:!0,margin:"normal"}),e.jsx(U,{fullWidth:!0,options:P,getOptionLabel:t=>t.StoreName,renderInput:t=>e.jsx(x,{...t,label:"الموقع",margin:"normal"}),value:j,onChange:(t,l)=>u(l||null),noOptionsText:"لا توجد مواقع",renderOption:(t,l)=>n.createElement(L,{...t,key:l.StoreID,value:l.StoreID},l.StoreName)}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsxs(oe,{row:!0,value:v,onChange:t=>N(t.target.value==="true"),children:[e.jsx(J,{value:!1,control:e.jsx(_,{}),label:"خزينة"}),e.jsx(J,{value:!0,control:e.jsx(_,{}),label:"بنك"})]})}),e.jsx(i,{item:!0,xs:6,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(K,{id:"payment-method-label",size:"small",children:"طريقة الدفع الرئيسية"}),e.jsx($,{labelId:"payment-method-label",label:"طريقة الدفع الرئيسية",size:"small",name:"paymentMethod",value:p.paymentMethod,onChange:r,error:!!B.paymentMethod,children:D.map(t=>e.jsx(L,{value:t.paymentMethodID,children:t.paymentMethodName},t.paymentMethodID))})]})})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx(x,{fullWidth:!0,label:"اسم الحساب البنكي",value:S,onChange:t=>W(t.target.value),margin:"normal"}),e.jsx(x,{fullWidth:!0,label:"رقم الحساب البنكي",value:w,onChange:t=>M(t.target.value),margin:"normal"})]}),e.jsx(x,{fullWidth:!0,label:"ملاحظات",value:E,onChange:t=>z(t.target.value),multiline:!0,rows:3,margin:"normal"}),e.jsx(O,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:24,color:"inherit",sx:{marginRight:1}}),"قيد الاضافة"]}):"إضافة"})]})})})};ye.propTypes={open:T.bool.isRequired,onClose:T.func.isRequired,setMessage:T.func.isRequired};const je=({open:g,onClose:m,selectedRowId:I,mainAccounts:h,setMessage:y})=>{const[k,f]=n.useState(""),[v,N]=n.useState(""),[S,W]=n.useState(!1),[w,M]=n.useState(""),[E,z]=n.useState(""),[d,C]=n.useState(""),[D,o]=n.useState(!1),[p,c]=n.useState([]),[j,u]=n.useState(""),[B,b]=n.useState(""),[P,F]=n.useState([]),a=h.find(s=>(s==null?void 0:s.ID)===I);n.useEffect(()=>{g&&a&&(a.Type==="Safe"?(f(a.Name||""),N(a.Account||""),W(a.SafeBank||!1),M(a.BankName||""),z(a.BankA||""),C(a.Note||""),u(a.safePD||""),b(parseInt(a.store)||0)):(y({open:!0,type:"error",text:"يمكن تعديل الخزائن فقط."}),m()))},[g,a,y,m]),n.useEffect(()=>{g&&(async()=>{try{const t=await Q(["paymentMethods"]);c(t.paymentMethods||[])}catch(t){console.error("Error fetching payment methods:",t),y({open:!0,type:"error",text:"Failed to fetch payment methods."})}})()},[g,y]),n.useEffect(()=>{g&&(async()=>{try{const t=await re();F(t.stores||[])}catch(t){console.error("Error fetching locations:",t),y({open:!0,type:"error",text:"Failed to fetch locations."})}})()},[g,y]);const r=async s=>{s.preventDefault(),o(!0);const t={safeID:a.ID,safeName:k||a.Name,safeACC:v||a.Account,isBank:S||a.SafeBank,safeBankN:S?w||a.BankName:null,safeBankA:S?E||a.BankA:null,safeNote:d||a.Note,safePD:j||a.safePD,store:B||a.store};try{await De(t),y({open:!0,type:"success",text:"تم تحديث بيانات الخزينة بنجاح!"}),m()}catch(l){console.error("Error updating safe:",l),y({open:!0,type:"error",text:"Failed to update safe."})}finally{o(!1)}};return a?e.jsx(se,{open:g&&a.Type==="Safe",onClose:m,children:e.jsx(R,{sx:{width:400,margin:"100px auto",padding:4,backgroundColor:"white",borderRadius:2},children:e.jsxs("form",{onSubmit:r,children:[e.jsx("h2",{children:"تعديل الخزينة"}),e.jsx(x,{fullWidth:!0,label:"اسم الخزينة",value:k,onChange:s=>f(s.target.value),required:!0,margin:"normal"}),e.jsx(x,{fullWidth:!0,label:"رقم الحساب في المحاسبة",value:v,onChange:s=>N(s.target.value),required:!0,margin:"normal"}),e.jsx(U,{fullWidth:!0,options:P,getOptionLabel:s=>s?s.StoreName:"",renderInput:s=>e.jsx(x,{...s,label:"الموقع",margin:"normal"}),value:P.find(s=>s.StoreID===B),onChange:(s,t)=>{b(t?t.StoreID:0)},noOptionsText:"لا توجد مواقع",renderOption:(s,t)=>n.createElement(L,{...s,key:t.StoreID,value:t.StoreID},t.StoreName)}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsxs(oe,{row:!0,value:S,onChange:s=>W(s.target.value==="true"),children:[e.jsx(J,{value:!1,control:e.jsx(_,{}),label:"خزينة"}),e.jsx(J,{value:!0,control:e.jsx(_,{}),label:"بنك"})]})}),e.jsx(i,{item:!0,xs:6,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(K,{id:"payment-method-label",size:"small",children:"طريقة الدفع الرئيسية"}),e.jsx($,{labelId:"payment-method-label",label:"طريقة الدفع الرئيسية",size:"small",value:j,onChange:s=>u(s.target.value),children:p.map(s=>e.jsx(L,{value:s.paymentMethodID,children:s.paymentMethodName},s.paymentMethodID))})]})})]}),S&&e.jsxs(e.Fragment,{children:[e.jsx(x,{fullWidth:!0,label:"اسم الحساب البنكي",value:w,onChange:s=>M(s.target.value),margin:"normal"}),e.jsx(x,{fullWidth:!0,label:"رقم الحساب البنكي",value:E,onChange:s=>z(s.target.value),margin:"normal"})]}),e.jsx(x,{fullWidth:!0,label:"ملاحظات",value:d,onChange:s=>C(s.target.value),multiline:!0,rows:3,margin:"normal"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsx(O,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:24,color:"inherit",sx:{marginRight:1}}),"قيد التعديل"]}):"تعديل"})}),e.jsx(i,{item:!0,xs:6,children:(a==null?void 0:a.ID)&&e.jsx(le,{resourceId:a.ID,resource:"safe",entityName:"الخزينة",onDelete:m})})]})]})})}):null};je.propTypes={open:T.bool.isRequired,onClose:T.func.isRequired,selectedRowId:T.number.isRequired,mainAccounts:T.array.isRequired,setMessage:T.func.isRequired};const Pe=({open:g,onClose:m,mainAccounts:I,selectedRowId:h,setMessage:y,rows:k})=>{const[f,v]=n.useState(""),[N,S]=n.useState(H()),[W,w]=n.useState(""),[M,E]=n.useState([]),[z,d]=n.useState([]),[C,D]=n.useState([]),[o,p]=n.useState([]),[c,j]=n.useState({sandNo:W,amount:"",SandType:f,reference:"",note:"",clientID:"",paymentMethod:"",safe:"",comment:"",account:"",transactions:[]}),[u,B]=n.useState({});n.useEffect(()=>{if(h&&I.length>0){const a=I.find(r=>r.ID===h);if(a){const{Type:r}=a;console.log(r),/[1-4]/.test(r)?(v(r),j(s=>({...s,SandType:r,safe:h.slice(0,-2)}))):(y({open:!0,type:"error",text:"اختر نوع السند"}),m())}}},[h]),n.useEffect(()=>{(async()=>{try{const s=await Me(f);w(s.nextSandNo)}catch(s){console.error("Failed to fetch new رقم السند:",s)}})(),(async()=>{let s=[];try{const t=await Q();s=t.safes.filter(l=>parseInt(f)===1||parseInt(f)===2?!l.isBank:l.isBank),E(s),d(t.paymentMethods),D(t.AccList),p(t.ClientList)}catch(t){console.error("Failed to fetch safes:",t)}if(s.length>0){const t=s.find(l=>parseInt(l.safeID)===parseInt(c.safe));t?j(l=>({...l,safe:t.safeID,paymentMethod:t.safePD})):console.error("No matching safe found for the selected ID.")}})()},[f]);const b=a=>{j({...c,[a.target.name]:a.target.value}),a.target.name==="amount"&&u.amount&&B({...u,amount:""})},P=()=>{const a={};return c.amount||(a.amount="المبلغ المستلم مطلوب"),c.safe||(a.safe="الصندوق مطلوب"),c.paymentMethod||(a.paymentMethod="طريقة الدفع مطلوبة"),c.account||(a.account="الحساب مطلوب"),a},F=async a=>{a.preventDefault();const r=P();if(Object.keys(r).length>0)B(r);else try{const s={...c,sandNo:W,date:N.toISOString()};await Ae(s),m()}catch(s){console.error("Error creating new payment:",s)}};return e.jsxs(ue,{open:g&&f,onClose:m,fullWidth:!0,maxWidth:"md",children:[e.jsx(he,{children:e.jsx(ce,{PaymentType:f})}),e.jsx(me,{children:e.jsxs("form",{onSubmit:F,children:[e.jsx(R,{sx:{p:2.5},children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:6,children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,label:"المبلغ",id:"amount",name:"amount",size:"small",value:c.amount,onChange:b,error:!!u.amount,helperText:u.amount,sx:{"& .MuiOutlinedInput-input":{fontSize:"xx-large"}},InputProps:{endAdornment:e.jsx(fe,{position:"end",children:e.jsx(ne,{onClick:()=>j({...c,amount:"0.00"}),children:e.jsx(de,{})})})}})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(U,{fullWidth:!0,id:"account-autocomplete",options:C,getOptionLabel:a=>`${a.AccID} - ${a.AccName}`,renderInput:a=>e.jsx(x,{...a,label:"الحساب",size:"small",required:!0,error:!!u.account,helperText:u.account}),value:C.find(a=>a.AccID===c.account)||null,onChange:(a,r)=>{j({...c,account:r?r.AccID:""})},noOptionsText:"لا يوجد حسابات مضافة"})}),e.jsx(i,{item:!0,xs:8,children:e.jsx(x,{fullWidth:!0,label:parseInt(f)===2||parseInt(f)===3?"المستلم":"وذلك مقابل",id:"comment",name:"comment",size:"small",value:c.comment,onChange:b})}),e.jsx(i,{item:!0,xs:4,children:e.jsx(x,{fullWidth:!0,label:"المرجع",id:"reference",name:"reference",size:"small",value:c.reference,onChange:b})})]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"رقم السند",id:"receiptID",name:"receiptID",size:"small",value:W,required:!0,onChange:a=>w(a.target.value)})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(pe,{dateAdapter:ie,children:e.jsx(xe,{slotProps:{textField:{fullWidth:!0,size:"small"}},label:"التاريخ",value:N,onChange:a=>S(a)})})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(G,{fullWidth:!0,children:[e.jsxs(K,{id:"box-select-label",size:"small",children:[parseInt(f)===1||parseInt(f)===2?"الصندوق":"البنك"," "]}),e.jsx($,{labelId:"box-select-label",label:parseInt(f)===1||parseInt(f)===2?"الصندوق":"البنك",size:"small",name:"safe",value:c.safe||(M.length>0?M[0].safeID:""),onChange:b,error:!!u.safe,children:M.map(a=>e.jsx(L,{value:a.safeID,children:a.safeName},a.safeID))})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(K,{id:"payment-method-label",size:"small",children:"طريقة الدفع"}),e.jsx($,{labelId:"payment-method-label",label:"طريقة الدفع",size:"small",name:"paymentMethod",value:c.paymentMethod||(z.length>0?M[0].safePD:""),onChange:b,error:!!u.paymentMethod,children:z.map(a=>e.jsx(L,{value:a.paymentMethodID,children:a.paymentMethodName},a.paymentMethodID))})]})})]})})]})}),e.jsx(X,{}),e.jsx(R,{sx:{p:2.5},children:e.jsx(x,{fullWidth:!0,multiline:!0,rows:2,label:"ملاحظات",id:"note",name:"note",value:c.note,onChange:b})}),e.jsx(X,{})]})}),e.jsxs(we,{children:[e.jsx(O,{onClick:m,color:"secondary",children:"إلغاء"}),e.jsx(O,{onClick:F,variant:"contained",color:"primary",children:"حفظ"})]})]})},Fe=({open:g,onClose:m,selectedSubRowId:I,setMessage:h})=>{const[y,k]=n.useState(H()),[f,v]=n.useState(""),[N,S]=n.useState(""),[W,w]=n.useState([]),[M,E]=n.useState([]),[z,d]=n.useState([]),[C,D]=n.useState([]),[o,p]=n.useState({sandNo:N,amount:"",reference:"",note:"",clientID:"",paymentMethod:"",safe:"",comment:"",account:"",type:"",date:H(),closed:!1,transactions:[]}),[c,j]=n.useState({}),[u,B]=n.useState(!1);n.useEffect(()=>{if(!I){h({open:!0,type:"error",text:"No payment selected for editing"}),m();return}let r={};const s=async()=>{try{r=await ke(I);const{safe:l,sandNo:A,date:Y,...ge}=r.payment;S(A),p({...o,sandNo:A||N,date:H(Y),safe:l||"",...ge}),k(H(Y))}catch(l){console.error("Failed to fetch payment details:",l),h({open:!0,type:"error",text:"Failed to fetch payment details"}),m()}},t=async()=>{try{const l=await Q();w(l.safes.filter(A=>parseInt(r.payment.type)===1||parseInt(r.payment.type)===2?!A.isBank:A.isBank)),E(l.paymentMethods),d(l.AccList),D(l.ClientList)}catch(l){console.error("Failed to fetch safes:",l),h({open:!0,type:"error",text:"Failed to fetch safes and payment methods"})}};s(),t()},[I]);const b=r=>{const{name:s,value:t}=r.target;p({...o,[s]:t}),c[s]&&j({...c,[s]:""})},P=()=>{const r={};return o.amount||(r.amount="المبلغ المستلم مطلوب"),o.safe||(r.safe="الصندوق مطلوب"),o.paymentMethod||(r.paymentMethod="طريقة الدفع مطلوبة"),o.account||(r.account="الحساب مطلوب"),r},F=async r=>{r.preventDefault();const s=P();if(Object.keys(s).length>0)j(s);else{B(!0);try{await We({...o,sandNo:N,date:y.toISOString()}),h({open:!0,type:"success",text:"تم تحديث السند بنجاح!"}),m()}catch(t){t.message==="SafeACC not found"?(console.error("SafeACC not found"),h({open:!0,type:"error",text:"يجب اضافة رقم حساب صحيح للخزينة."})):(console.error("Error updating payment:",t),h({open:!0,type:"error",text:"فشل في تحديث السند. الرجاء المحاولة مرة أخرى."})),p(l=>({...l,closed:f}))}finally{B(!1)}}},a=r=>{const{name:s,value:t}=r.target;if(s==="amount"){const l=formatAmount(t);p({...o,amount:l})}};return e.jsxs(ue,{open:g,onClose:m,fullWidth:!0,maxWidth:"md",children:[e.jsx(he,{children:e.jsx(ce,{PaymentType:o.type})}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(me,{children:[e.jsx(R,{sx:{p:2.5},children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:6,children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:6,children:e.jsx(x,{fullWidth:!0,label:"المبلغ",id:"amount",name:"amount",size:"small",value:o.amount,onChange:b,onBlur:a,onKeyDown:r=>{r.key==="Enter"&&a(r)},error:!!c.amount,helperText:c.amount,sx:{"& .MuiOutlinedInput-input":{fontSize:"xx-large"}},InputProps:{endAdornment:e.jsx(fe,{position:"end",children:e.jsx(ne,{onClick:()=>p({...o,amount:"123.00"}),children:e.jsx(de,{})})})}})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(U,{fullWidth:!0,id:"account-autocomplete",options:z,getOptionLabel:r=>`${r.AccID} - ${r.AccName}`,renderInput:r=>e.jsx(x,{...r,label:"الحساب",size:"small",required:!0,error:!!c.account,helperText:c.account}),value:z.find(r=>r.AccID===o.account)||null,onChange:(r,s)=>{p({...o,account:s?s.AccID:""})},noOptionsText:"لا يوجد حسابات مضافة"})}),e.jsx(i,{item:!0,xs:8,children:e.jsx(x,{fullWidth:!0,label:parseInt(o.type)===2||parseInt(o.type)===3?"المستلم":"وذلك مقابل",id:"comment",name:"comment",size:"small",value:o.comment,onChange:b})}),e.jsx(i,{item:!0,xs:4,children:e.jsx(x,{fullWidth:!0,label:"المرجع",id:"reference",name:"reference",size:"small",value:o.reference,onChange:b})})]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"رقم السند",id:"receiptID",name:"receiptID",size:"small",value:N,required:!0,disabled:!0,onChange:r=>S(r.target.value)})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(pe,{dateAdapter:ie,children:e.jsx(xe,{slotProps:{textField:{fullWidth:!0,size:"small"}},label:"التاريخ",value:y,onChange:r=>k(r)})})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(K,{id:"box-select-label",size:"small",children:parseInt(o.type)===1||parseInt(o.type)===2?"الصندوق":"البنك"}),e.jsx($,{labelId:"box-select-label",label:parseInt(o.type)===1||parseInt(o.type)===2?"الصندوق":"البنك",size:"small",name:"safe",value:o.safe||0,onChange:b,error:!!c.safe,children:W.map(r=>e.jsx(L,{value:r.safeID,children:r.safeName},r.safeID))})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(K,{id:"payment-method-label",size:"small",children:"طريقة الدفع"}),e.jsx($,{labelId:"payment-method-label",label:"طريقة الدفع",size:"small",name:"paymentMethod",value:o.paymentMethod,onChange:b,error:!!c.paymentMethod,children:M.map(r=>e.jsx(L,{value:r.paymentMethodID,children:r.paymentMethodName},r.paymentMethodID))})]})})]})})]})}),e.jsx(X,{}),e.jsx(R,{sx:{p:2.5},children:e.jsx(x,{fullWidth:!0,multiline:!0,rows:2,label:"ملاحظات",id:"note",name:"note",value:o.note,onChange:b})})]}),e.jsxs(Ee,{sx:{justifyContent:"space-between"},children:[e.jsxs(ee,{direction:"row",spacing:1.5,children:[e.jsx(Z,{children:e.jsx(O,{type:"submit",variant:"outlined",size:"large",color:"secondary",onClick:()=>{v(o.closed),p({...o,closed:!o.closed})},disabled:u,children:o.closed?"الغاء الترحيل":"ترحيل"})}),!o.closed&&e.jsx(Z,{children:e.jsx(le,{disabled:u,size:"large",resourceId:I,resource:"payment",entityName:"السند",onDelete:m})})]}),e.jsxs(ee,{direction:"row",spacing:1.5,children:[e.jsx(Z,{children:e.jsx(O,{variant:"contained",size:"large",type:"submit",disabled:u,children:u?e.jsx(te,{size:24}):"حفظ"})}),e.jsx(Z,{children:e.jsx(O,{variant:"outlined",onClick:m,size:"large",disabled:u,children:"الغاء"})})]})]})]})]})},gt=()=>{const[g,m]=n.useState([]),[I,h]=n.useState([]),[y,k]=n.useState(0),[f,v]=n.useState(0),[N,S]=n.useState(!1),W=Ie(),w=[{text:"كشف حساب",component:Ne,isDisabled:!1}],M=[{field:"sandNo",headerName:"رقم السند",minWidth:100,flex:1,renderCell:d=>e.jsx(q,{variant:"h5",children:d.row.sandNo})},{field:"date",headerName:"التاريخ",minWidth:100,flex:2,renderCell:d=>e.jsx(q,{children:e.jsx(Be,{dateString:d.row.date})})},{field:"AccName",headerName:"الحساب",minWidth:150,flex:2,renderCell:d=>e.jsx(i,{container:!0,spacing:1.25,alignItems:"center",children:e.jsxs(i,{item:!0,xs:!0,zeroMinWidth:!0,children:[e.jsx(ee,{direction:"row",alignItems:"center",spacing:.5,children:e.jsx(q,{variant:"h5",noWrap:!0,children:d.row.AccName})}),e.jsx(q,{variant:"subtitle2",children:d.row.ACC})]})})},{field:"paymentMethodName",headerName:"طريقة الدفع",minWidth:150,flex:1,align:"center",renderCell:d=>e.jsx(q,{variant:"h5",children:d.row.paymentMethodName})},{field:"amount",headerName:"المبلغ",minWidth:100,flex:1,align:"left",renderCell:d=>e.jsx(q,{variant:"h5",children:d.row.amount})},{field:"closed",headerName:"الحالة",minWidth:100,flex:1,align:"left",renderCell:d=>{const{closed:C}=d.row;let D,o,p;switch(C){case!1:D="مسودة",o="black",p=V("#D3D3D3",.3);break;case!0:D="مكتمل",o="success.dark",p=V(W.palette.success.light,.5);break;default:D="مسودة",o="black",p=V("#D3D3D3",.3)}return e.jsx(ve,{label:D,size:"small",sx:{bgcolor:p,color:o,cursor:"pointer"}})}}],E=async()=>{try{const d=await ae("/api/sand/list/main",{});m(d)}catch(d){console.error("Error fetching client tree data:",d)}},z=async(d,C,D,o,p,c,j)=>{try{S(!0),console.log("Fetching sub accounts for:",d,C,D,o,p,c,j);const u=await ae("/api/sand/list/sub",{Father:d,page:C,pageSize:D,rowID:o,search:p,field:c,sort:j});h(u.data),k(u.totalRows),u.page!==null&&v(u.page),S(!1)}catch(u){console.error("Error fetching client tree data:",u),S(!1)}};return n.useEffect(()=>{E()},[]),e.jsx(Ce,{mainData:g,rows:I,dataKey:"ID",dataCode:"Code",Name:"Name",fetchTreeData:E,fetchSubTreeData:z,columns:M,apiSearchEndpoint:"/api/sand/list/search",PopupAddMain:ye,PopupEditMain:je,AddEntityComponent:Pe,EditEntityComponent:Fe,rowCount:y,entityName:"سند",mainName:"خزينة",page:f,isLoading:N,setPage:v,reportOptions:w,leafIcon:ze,disableIDTree:!0})};export{gt as default};
