import{P as u,r as x,j as e,S as y,V as T,I as k,B as _,W as ce,k as v,n as C,h as de,R as he,X as ue,Y as pe,M as z,A as me,Z as ge,T as xe,z as fe,a1 as je,q as g,F as be,a2 as Se,a3 as ve,e as Ce}from"./index-CK2eHZDS.js";import{d as ye}from"./Search-BXw6LGI1.js";import{d as Te,a as ke,T as Ie,v as De,b as Re,c as Pe}from"./EditTwoTone-DpwzjxCu.js";import{d as we}from"./PrintTwoTone-6qO7arNh.js";import{T as Ae}from"./TextField--NRucxkR.js";import{I as qe}from"./InputAdornment-B3MGI1qD.js";import{T as _e}from"./TableHead-CqBhAkUl.js";import{b as I,T as ze,a as Oe,c as Ee}from"./TableRow-Cpxk0AAS.js";import{T as h}from"./TableCell-BJINaop2.js";import{C as O}from"./Checkbox-CKFEckdw.js";import{g as Fe,I as $e}from"./getImageUrl-4pp_NHfR.js";import{d as Le,u as Be}from"./invoice-BCKW537N.js";import{D as E,a as F,b as $}from"./DialogContent-B6RC-5yg.js";import{D as L}from"./DialogTitle-Do-b2gQd.js";import{T as Me}from"./TablePagination-0KQBaQp2.js";import{D as Ve}from"./DialogContentText-BTgKtHs8.js";import"./FormHelperText-DhsFkHK6.js";import"./KeyboardArrowRight-CmUX_fuU.js";import"./MenuItem-CGopNoQ2.js";const B=({originalRows:t,setRows:n})=>{const[l,r]=x.useState(""),o=f=>{const a=f.target.value.toLowerCase();if(r(a||""),a){const b=t.filter(d=>Object.keys(d).some(S=>{const p=d[S];return p&&p.toString().toLowerCase().includes(a)}));n(b)}else n(t)};return e.jsxs(y,{direction:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",spacing:2,children:[e.jsx(Ae,{InputProps:{startAdornment:e.jsx(qe,{position:"start",children:e.jsx(ye,{fontSize:"small"})})},onChange:o,placeholder:"البحث عن فاتورة",value:l,size:"small",sx:{width:{xs:1,sm:"auto"}}}),e.jsxs(y,{direction:"row",alignItems:"center",spacing:1.25,children:[e.jsx(T,{title:"Copy",children:e.jsx(k,{size:"large",children:e.jsx(Te,{})})}),e.jsx(T,{title:"Print",children:e.jsx(k,{size:"large",children:e.jsx(we,{})})}),e.jsx(T,{title:"Filter",children:e.jsx(k,{size:"large",children:e.jsx(ke,{})})})]})]})};B.propTypes={setRows:u.func,originalRows:u.array};const He=[{id:"id",numeric:!0,label:"الرقم",align:"center"},{id:"store",numeric:!1,label:"المخزن",align:"center"},{id:"supplierinv",numeric:!1,label:"الفاتورة",align:"center"},{id:"name",numeric:!1,label:"اسم المورد"},{id:"amount",numeric:!0,label:"المبلغ",align:"left"},{id:"status",numeric:!1,label:"الحالة",align:"center"},{id:"date",numeric:!0,label:"التاريخ",align:"center"},{id:"note",numeric:!1,label:"الملاحظات",align:"center"}],M=({numSelected:t})=>e.jsxs(ce,{sx:{p:0,pl:1,pr:1,...t>0&&{color:"secondary.main"}},children:[t>0?e.jsxs(v,{color:"inherit",variant:"h4",children:[t," Selected"]}):e.jsx(v,{variant:"h6",id:"tableTitle",children:"Nutrition"}),e.jsx(_,{sx:{flexGrow:1}})]});M.propTypes={numSelected:u.number.isRequired};const V=({onSelectAllClick:t,order:n,orderBy:l,numSelected:r,rowCount:o,onRequestSort:f,selected:a})=>{const b=d=>S=>{f(S,d)};return e.jsx(_e,{children:e.jsxs(I,{children:[e.jsx(h,{padding:"checkbox",sx:{pl:3},children:e.jsx(O,{color:"primary",indeterminate:r>0&&r<o,checked:o>0&&r===o,onChange:t,inputProps:{"aria-label":"select all desserts"}})}),r>0&&e.jsx(h,{padding:"none",colSpan:12,children:e.jsx(M,{numSelected:a.length})}),r<=0&&He.map((d,S)=>{const p=l===d.id;return e.jsx(h,{align:d.align,padding:d.disablePadding?"none":"normal",sortDirection:p?n:void 0,children:e.jsxs(Ie,{active:p,direction:p?n:void 0,onClick:b(d.id),children:[d.label,p&&e.jsx(_,{component:"span",sx:De,children:n==="desc"?"sorted descending":"sorted ascending"})]})},S)}),r<=0&&e.jsx(h,{sortDirection:!1,align:"center",sx:{pr:3},children:"الإجراءات"})]})})};V.propTypes={selected:u.array,numSelected:u.number.isRequired,onRequestSort:u.func.isRequired,onSelectAllClick:u.func.isRequired,order:u.oneOf(["asc","desc"]).isRequired,orderBy:u.string.isRequired,rowCount:u.number.isRequired};const H=({open:t,onClose:n,onStatusChange:l})=>e.jsxs(E,{open:t,onClose:n,"aria-labelledby":"received-dialog-title",children:[e.jsx(L,{id:"received-dialog-title",children:"تغيير الحالة"}),e.jsxs(F,{children:[e.jsx(v,{variant:"body1",gutterBottom:!0,children:"اختر الحالة الجديدة للفاتورة:"}),e.jsxs(y,{direction:"row",spacing:2,justifyContent:"center",children:[e.jsx(C,{variant:"contained",color:"success",onClick:()=>l("مستلم"),children:"مستلم"}),e.jsx(C,{variant:"contained",color:"warning",onClick:()=>l("نقص"),children:"نقص"}),e.jsx(C,{variant:"contained",color:"error",onClick:()=>l("غير مطابق"),children:"غير مطابق"})]})]}),e.jsx($,{children:e.jsx(C,{onClick:n,color:"primary",children:"إلغاء"})})]});H.propTypes={open:u.bool.isRequired,onClose:u.func.isRequired,onStatusChange:u.func.isRequired};const q=(t,n,l)=>n[l]<t[l]?-1:n[l]>t[l]?1:0,Ne=(t,n)=>t==="desc"?(l,r)=>q(l,r,n):(l,r)=>-q(l,r,n),Ue=(t,n)=>{const l=t.map((r,o)=>[r,o]);return l.sort((r,o)=>{const f=n(r[0],o[0]);return f!==0?f:r[1]-o[1]}),l.map(r=>r[0])},N=({rows:t})=>{const n=de(),[l,r]=x.useState("asc"),[o,f]=x.useState("calories"),[a,b]=x.useState([]),[d,S]=x.useState(0),[p,U]=x.useState(5),[D,W]=x.useState(null),[G,R]=x.useState(!1),[K,P]=x.useState(!1),j=he.useMemo(()=>ue({},je,n,{direction:"rtl"}),[n]),X=(s,c)=>{r(o===c&&l==="asc"?"desc":"asc"),f(c)},Y=async()=>{try{await Le(D),window.location.reload()}catch(s){console.error("Error deleting invoice:",s)}R(!1)},Z=s=>{if(s.target.checked){if(a.length>0)b([]);else{const c=t.map(i=>i.customer_name);b(c)}return}b([])},J=(s,c)=>{const i=a.indexOf(c);let m=[];i===-1?m=m.concat(a,c):i===0?m=m.concat(a.slice(1)):i===a.length-1?m=m.concat(a.slice(0,-1)):i>0&&(m=m.concat(a.slice(0,i),a.slice(i+1))),b(m)},Q=(s,c)=>{S(c)},ee=s=>{s!=null&&s.target.value&&U(parseInt(s==null?void 0:s.target.value,10)),S(0)},se=s=>a.indexOf(s)!==-1,A=d>0?Math.max(0,(1+d)*p-t.length):0,te=s=>{switch(console.log("Getting payment status label and color for:",s),s){case 1:return{label:"غير مدفوع",color:"error.main",chipcolor:g(j.palette.error.light,.2)};case 2:return{label:"مدفوع جزئي",color:"#fb6300",chipcolor:g(j.palette.warning.light,.5)};case 3:return{label:"مدفوع",color:"#64bd00",chipcolor:g(j.palette.success.light,.3)};default:return{label:"غير مدفوع",color:"error.main",chipcolor:g(j.palette.error.light,.2)}}},le=s=>{switch(s){case 1:return{closedlabel:"تحت الاجراء",closedcolor:"black",closedchipcolor:g("#D3D3D3",.3)};case 2:return{closedlabel:"مطلوب التعديل",closedcolor:"info.dark",closedchipcolor:g(j.palette.info.light,.5)};case 3:return{closedlabel:"موقف",closedcolor:"error.main",closedchipcolor:g(j.palette.error.light,.5)};case 4:return{closedlabel:"تحت التسليم",closedcolor:"black",closedchipcolor:g("#D3D3D3",.5)};case 5:return{closedlabel:"مستلم",closedcolor:"#64bd00",closedchipcolor:g(j.palette.success.light,.3)};case 7:return{closedlabel:"غير مطابق",closedcolor:"error.main",closedchipcolor:g(j.palette.error.light,.2)};case 8:return{closedlabel:"مرتجع",closedcolor:"#fb6300",closedchipcolor:g(j.palette.warning.light,.5)};case 9:return{closedlabel:"نقص",closedcolor:"black",closedchipcolor:g("#ffecad",.5)};default:return{closedlabel:"تحت الاجراء",closedcolor:"warning.dark",closedchipcolor:g(j.palette.warning.light,.5)}}},re=s=>{W(s),P(!0)},ne=async s=>{if(!D)return;let c,i;switch(s){case"مستلم":i=5,c=6;break;case"غير مطابق":i=7,c=7;break;case"نقص":i=9,c=7;break;default:return}const m={id:D.invoice_id,closed:i,status:c};try{await Be(m),console.log("Invoice status updated successfully"),window.location.reload()}catch(w){console.error("Error updating invoice status:",w)}P(!1)};return e.jsx(pe,{theme:j,children:e.jsxs(z,{content:!1,children:[e.jsx(ze,{children:e.jsxs(Oe,{sx:{minWidth:750},"aria-labelledby":"tableTitle",children:[e.jsx(V,{numSelected:a.length,order:l,orderBy:o,onSelectAllClick:Z,onRequestSort:X,rowCount:t.length,selected:a}),e.jsxs(Ee,{children:[t.length===0?e.jsx(I,{children:e.jsx(h,{colSpan:10,align:"center",children:"لا توجد سندات مخزنية"})}):Ue(t,Ne(l,o)).slice(d*p,d*p+p).map((s,c)=>{if(typeof s=="number")return null;const i=se(s.customer_name),m=`enhanced-table-checkbox-${c}`;te(s.payment_status);const{closedlabel:w,closedcolor:ae,closedchipcolor:ie}=le(s.closed);return e.jsxs(I,{hover:!0,role:"checkbox","aria-checked":i,tabIndex:-1,selected:i,children:[e.jsx(h,{padding:"checkbox",sx:{pl:3},onClick:oe=>J(oe,s.customer_name),children:e.jsx(O,{color:"primary",checked:i,inputProps:{"aria-labelledby":m}})}),e.jsx(h,{children:e.jsxs(v,{variant:"h5",align:"center",children:["#",s.reference_number]})}),e.jsx(h,{align:"center",children:s.StoreName}),e.jsx(h,{align:"center",children:s.SupplierInvoiceNumber}),e.jsx(h,{children:e.jsxs(y,{direction:"row",spacing:2,children:[e.jsx(me,{alt:"",src:Fe(`avatar-${s.avatar}.png`,$e.USERS)}),e.jsxs(y,{children:[e.jsx(v,{variant:"subtitle1",children:s.customer_name}),e.jsx(v,{variant:"caption",children:s.email})]})]})}),e.jsx(h,{align:"left",children:e.jsx(v,{variant:"h3",style:{fontSize:"1rem",fontWeight:500},children:new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s.total)})}),e.jsx(h,{align:"center",children:e.jsx(ge,{label:w,size:"small",sx:{bgcolor:j.palette.mode===xe.DARK?"dark.main":ie,color:ae,cursor:"pointer"}})}),e.jsx(h,{align:"center",sx:{padding:"11px"},children:s.date}),e.jsx(h,{align:"center",children:s.Comment}),e.jsx(h,{align:"center",sx:{pr:3},children:e.jsxs(y,{direction:"row",alignItems:"center",spacing:1,justifyContent:"center",children:[e.jsx(T,{title:"مشاهدة",children:e.jsx(k,{color:"primary",component:fe,to:`/apps/invoice/invoice-details/${s.invoice_id}`,size:"small","aria-label":"View",children:e.jsx(Re,{sx:{fontSize:"1.3rem"}})})}),s.closed<=4&&e.jsx(T,{title:"تعديل",children:e.jsx(k,{color:"secondary",size:"small","aria-label":"Edit",onClick:()=>re(s),children:e.jsx(Pe,{sx:{fontSize:"1.3rem"}})})})]})})]},c)}),t.length>0&&A>0&&e.jsx(I,{sx:{height:53*A},children:e.jsx(h,{colSpan:10})})]})]})}),e.jsx(Me,{rowsPerPageOptions:[5,10,25],component:"div",count:t.length,rowsPerPage:p,page:d,onPageChange:Q,onRowsPerPageChange:ee}),e.jsxs(E,{open:G,onClose:()=>R(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(L,{id:"alert-dialog-title",children:"Delete Invoice"}),e.jsx(F,{children:e.jsx(Ve,{id:"alert-dialog-description",children:"Are you sure you want to delete this invoice?"})}),e.jsxs($,{children:[e.jsx(C,{onClick:()=>R(!1),color:"primary",children:"Cancel"}),e.jsx(C,{onClick:Y,color:"primary",autoFocus:!0,children:"Delete"})]})]}),e.jsx(H,{open:K,onClose:()=>P(!1),onStatusChange:ne})]})})};N.propTypes={rows:u.array};const hs=()=>{const{invoicelist:t}=be(f=>f.customer),[n,l]=x.useState([]),[r,o]=x.useState([]);return x.useEffect(()=>{Se(ve())},[]),x.useEffect(()=>{if(t){l(t);const f=t.filter(a=>[5,6,7,8].includes(parseInt(a.status))&&parseInt(a.closed)>3);o(f)}},[t]),e.jsxs(z,{content:!1,children:[e.jsx(Ce,{children:e.jsx(B,{originalRows:n,setRows:o})}),e.jsx(N,{rows:r})]})};export{hs as default};
