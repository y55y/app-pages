import{P as m,r as s,j as e,aH as ae,B as Q,G as $,n as K,aL as ye,S as Z,k as P,V as O,I as _,W as Ce,aM as ve,h as ke,K as Ie,R as De,X as Ne,Y as Te,M as ne,z as Me,$ as Ae,a0 as Pe,a1 as Be,aR as Re,O as we,e as Ee,aS as Le}from"./index-CK2eHZDS.js";import{d as ze}from"./Search-BXw6LGI1.js";import{d as Oe,a as qe,T as Fe,v as We,b as $e,c as _e}from"./EditTwoTone-DpwzjxCu.js";import{d as He}from"./PrintTwoTone-6qO7arNh.js";import{F as Ge,d as Ve}from"./AddTwoTone-NMCIR7d0.js";import{s as re}from"./payment-KmgVbcvK.js";import{g as oe}from"./userinfo-Dj6RO7mX.js";import{T as k,S as le}from"./TextField--NRucxkR.js";import{A as ie}from"./Autocomplete-DwoJzscJ.js";import{M as X}from"./MenuItem-CGopNoQ2.js";import{R as ce,a as Y}from"./RadioGroup-jxLq89ID.js";import{F as J}from"./FormControlLabel-Bwr4sx4_.js";import{a as de,I as ue}from"./FormHelperText-DhsFkHK6.js";import{C as he}from"./CircularProgress-CbH74Q3r.js";import{I as Ke}from"./InputAdornment-B3MGI1qD.js";import{T as Xe}from"./TableHead-CqBhAkUl.js";import{b as V,T as Ye,a as Je,c as Qe}from"./TableRow-Cpxk0AAS.js";import{T as j}from"./TableCell-BJINaop2.js";import{C as fe}from"./Checkbox-CKFEckdw.js";import{d as Ue}from"./DeleteTwoTone-B6ncKXH3.js";import{T as Ze}from"./TablePagination-0KQBaQp2.js";import{D as et,a as tt,b as st}from"./DialogContent-B6RC-5yg.js";import{D as at}from"./DialogTitle-Do-b2gQd.js";import{D as nt}from"./DialogContentText-BTgKtHs8.js";import"./KeyboardArrowRight-CmUX_fuU.js";const me=({open:i,onClose:o,reloadSafesList:c})=>{const[t,u]=s.useState(""),[h,v]=s.useState(""),[r,d]=s.useState(!1),[f,x]=s.useState(""),[b,M]=s.useState(""),[I,D]=s.useState(""),[R,T]=s.useState(!1),[B,A]=s.useState([]),[q,w]=s.useState({paymentMethod:""}),[E,L]=s.useState(""),[y,F]=s.useState({}),[H,W]=s.useState([]);s.useEffect(()=>{(async()=>{try{const g=await re(["paymentMethods"]);console.log("Payment methods:",g.paymentMethods),A(g.paymentMethods)}catch(g){console.error("Error fetching payment methods:",g)}})()},[]);const G=n=>{const{name:g,value:z}=n.target;w(U=>({...U,[g]:z}))};s.useEffect(()=>{a()},[]);const a=async()=>{try{const n=await oe();n&&Array.isArray(n.stores)?W(n.stores):console.error("Fetched data does not contain stores array:",n)}catch(n){console.error("Error fetching locations:",n.message)}},p=async n=>{n.preventDefault(),T(!0);const g={safeName:t,safeACC:h,isBank:r,safeBankN:r?f:null,safeBankA:r?b:null,safeNote:I,safePD:q.paymentMethod,store:E.StoreID};try{const z=await ye(g);console.log("Safe added successfully:",z),c(),o()}catch(z){console.error("Error adding safe:",z)}finally{T(!1)}};return e.jsx(ae,{open:i,onClose:o,children:e.jsx(Q,{sx:{width:400,margin:"100px auto",padding:4,backgroundColor:"white",borderRadius:2},children:e.jsxs("form",{onSubmit:p,children:[e.jsx("h2",{children:"إضافة خزينة"}),e.jsx(k,{fullWidth:!0,label:"اسم الخزينة",value:t,onChange:n=>u(n.target.value),required:!0,margin:"normal"}),e.jsx(ie,{fullWidth:!0,options:[{StoreID:0,StoreName:"عام"},...H],getOptionLabel:n=>n?n.StoreName:"",renderInput:n=>e.jsx(k,{...n,label:"الموقع",margin:"normal"}),value:E||{StoreID:0,StoreName:"عام"},onChange:(n,g)=>{L(g)},noOptionsText:"لا توجد مواقع",renderOption:(n,g)=>s.createElement(X,{...n,key:g.StoreID,value:g.StoreID},g.StoreName)}),e.jsxs($,{container:!0,spacing:2,children:[e.jsx($,{item:!0,xs:6,children:e.jsxs(ce,{row:!0,value:r,onChange:n=>d(n.target.value==="true"),children:[e.jsx(J,{value:!1,control:e.jsx(Y,{}),label:"خزينة"}),e.jsx(J,{value:!0,control:e.jsx(Y,{}),label:"بنك"})]})}),e.jsx($,{item:!0,xs:6,children:e.jsxs(de,{fullWidth:!0,children:[e.jsx(ue,{id:"payment-method-label",size:"small",children:"طريقة الدفع الرئيسية"}),e.jsx(le,{labelId:"payment-method-label",label:"طريقة الدفع الرئيسية",size:"small",name:"paymentMethod",value:q.paymentMethod||(B.length>0?B[0].paymentMethodID:""),onChange:G,error:!!y.paymentMethod,children:B.map(n=>e.jsx(X,{value:n.paymentMethodID,children:n.paymentMethodName},n.paymentMethodID))})]})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(k,{fullWidth:!0,label:"اسم الحساب البنكي",value:f,onChange:n=>x(n.target.value),margin:"normal"}),e.jsx(k,{fullWidth:!0,label:"رقم الحساب البنكي",value:b,onChange:n=>M(n.target.value),margin:"normal"})]}),e.jsx(k,{fullWidth:!0,label:"ملاحظات",value:I,onChange:n=>D(n.target.value),multiline:!0,rows:3,margin:"normal"}),e.jsx(K,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(he,{size:24,color:"inherit",sx:{marginRight:1}}),"قيد الاضافة"]}):"إضافة"})]})})})};me.propTypes={open:m.bool.isRequired,onClose:m.func.isRequired,reloadSafesList:m.func.isRequired};const rt=({originalRows:i,setRows:o,reloadSafesList:c})=>{const[t,u]=s.useState(""),h="قائمة الخزائن والبنوك",[v,r]=s.useState(!1),d=f=>{const x=f.target.value.toLowerCase();if(u(x||""),x){const b=i.filter(M=>Object.keys(M).some(I=>{const D=M[I];return D&&D.toString().toLowerCase().includes(x)}));o(b)}else o(i)};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{direction:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",spacing:2,children:[e.jsx(P,{variant:"h3",component:"div",sx:{flexGrow:1},children:h}),e.jsx(k,{InputProps:{startAdornment:e.jsx(Ke,{position:"start",children:e.jsx(ze,{fontSize:"small"})})},onChange:d,placeholder:"البحث عن خزنة",value:t,size:"small",sx:{width:{xs:1,sm:"auto"}}}),e.jsxs(Z,{direction:"row",alignItems:"center",spacing:1.25,children:[e.jsx(O,{title:"نسخ",children:e.jsx(_,{size:"large",children:e.jsx(Oe,{})})}),e.jsx(O,{title:"طباعة",children:e.jsx(_,{size:"large",children:e.jsx(He,{})})}),e.jsx(O,{title:"تصفية",children:e.jsx(_,{size:"large",children:e.jsx(qe,{})})}),e.jsx(O,{title:"اضافة خزنة",children:e.jsx(Ge,{color:"primary",size:"small",sx:{boxShadow:"none",width:32,height:32,minHeight:32},onClick:()=>r(!0),children:e.jsx(Ve,{fontSize:"small"})})})]})]}),e.jsx(me,{open:v,onClose:()=>r(!1),reloadSafesList:c})]})},te=[{id:"safeID",numeric:!0,label:"الرقم",align:"center"},{id:"safeName",numeric:!1,label:"اسم الخزنة",align:"center"},{id:"safeACC",numeric:!1,label:"رقم الحساب",align:"center"},{id:"safeNote",numeric:!1,label:"ملاحظات",align:"center"},{id:"safeBankN",numeric:!1,label:"اسم البنك",align:"center"},{id:"safeBankA",numeric:!0,label:"رقم الحساب البنكي",align:"center"},{id:"SafeBank",numeric:!0,label:"المدفوعات",align:"center"}],xe=({numSelected:i})=>e.jsxs(Ce,{sx:{p:0,pl:1,pr:1,...i>0&&{color:"secondary.main"}},children:[i>0?e.jsxs(P,{color:"inherit",variant:"h4",children:[i," Selected"]}):e.jsx(P,{variant:"h6",id:"tableTitle",children:"Safes"}),e.jsx(Q,{sx:{flexGrow:1}})]});xe.propTypes={numSelected:m.number.isRequired};const pe=({onSelectAllClick:i,order:o,orderBy:c,numSelected:t,rowCount:u,onRequestSort:h,selected:v})=>{const r=d=>f=>{h(f,d)};return e.jsx(Xe,{children:e.jsxs(V,{children:[e.jsx(j,{padding:"checkbox",sx:{pl:3},children:e.jsx(fe,{color:"primary",indeterminate:t>0&&t<u,checked:u>0&&t===u,onChange:i,inputProps:{"aria-label":"select all safes"}})}),t>0&&e.jsx(j,{padding:"none",colSpan:te.length+1,children:e.jsx(xe,{numSelected:v.length})}),t<=0&&te.map((d,f)=>{const x=c===d.id;return e.jsx(j,{align:d.align,padding:d.disablePadding?"none":"normal",sortDirection:x?o:void 0,children:e.jsxs(Fe,{active:x,direction:x?o:void 0,onClick:r(d.id),children:[d.label,x&&e.jsx(Q,{component:"span",sx:We,children:o==="desc"?"sorted descending":"sorted ascending"})]})},f)}),t<=0&&e.jsx(j,{sortDirection:!1,align:"center",sx:{pr:3},children:"الإجراءات"})]})})};pe.propTypes={selected:m.array,numSelected:m.number.isRequired,onRequestSort:m.func.isRequired,onSelectAllClick:m.func.isRequired,order:m.oneOf(["asc","desc"]).isRequired,orderBy:m.string.isRequired,rowCount:m.number.isRequired};const ge=({open:i,onClose:o,reloadSafesList:c,safe:t})=>{const[u,h]=s.useState(""),[v,r]=s.useState(""),[d,f]=s.useState(!1),[x,b]=s.useState(""),[M,I]=s.useState(""),[D,R]=s.useState(""),[T,B]=s.useState(!1),[A,q]=s.useState([]),[w,E]=s.useState(""),[L,y]=s.useState(""),[F,H]=s.useState([]);s.useEffect(()=>{t&&(console.log("Safe:",t),h(t.safeName||""),r(t.safeACC||""),f(t.SafeBank||!1),b(t.safeBankN||""),I(t.safeBankA||""),R(t.safeNote||""),E(t.safePD||""),y(parseInt(t.store)||0))},[t]),s.useEffect(()=>{(async()=>{try{const p=await re(["paymentMethods"]);q(p.paymentMethods)}catch(p){console.error("Error fetching payment methods:",p)}})()},[]),s.useEffect(()=>{W()},[]);const W=async()=>{try{const a=await oe();a&&Array.isArray(a.stores)?(H(a.stores),console.log(a)):console.error("Fetched data does not contain stores array:",a)}catch(a){console.error("Error fetching locations:",a.message)}},G=async a=>{a.preventDefault(),B(!0);const p={safeID:t.safeID,safeName:u||t.safeName,safeACC:v||t.safeACC,isBank:d||t.SafeBank,safeBankN:d?x||t.safeBankN:null,safeBankA:d?M||t.safeBankA:null,safeNote:D||t.safeNote,safePD:w||t.safePD,store:L||t.store};try{const n=await ve(p);console.log("Safe updated successfully:",n),c(),o()}catch(n){console.error("Error updating safe:",n)}finally{B(!1)}};return e.jsx(ae,{open:i,onClose:o,children:e.jsx(Q,{sx:{width:400,margin:"100px auto",padding:4,backgroundColor:"white",borderRadius:2},children:e.jsxs("form",{onSubmit:G,children:[e.jsx("h2",{children:"تعديل الخزينة"}),e.jsx(k,{fullWidth:!0,label:"اسم الخزينة",value:u,onChange:a=>h(a.target.value),required:!0,margin:"normal"}),e.jsx(k,{fullWidth:!0,label:"رقم الحساب في المحاسبة",value:v,onChange:a=>r(a.target.value),required:!0,margin:"normal"}),e.jsx(ie,{fullWidth:!0,options:[{StoreID:0,StoreName:"عام"},...F],getOptionLabel:a=>a?a.StoreName:"",renderInput:a=>e.jsx(k,{...a,label:"الموقع",margin:"normal"}),value:F.find(a=>a.StoreID===L)||{StoreID:0,StoreName:"عام"},onChange:(a,p)=>{y(p?p.StoreID:0)},noOptionsText:"لا توجد مواقع",renderOption:(a,p)=>s.createElement(X,{...a,key:p.StoreID,value:p.StoreID},p.StoreName)}),e.jsxs($,{container:!0,spacing:2,children:[e.jsx($,{item:!0,xs:6,children:e.jsxs(ce,{row:!0,value:d,onChange:a=>f(a.target.value==="true"),children:[e.jsx(J,{value:!1,control:e.jsx(Y,{}),label:"خزينة"}),e.jsx(J,{value:!0,control:e.jsx(Y,{}),label:"بنك"})]})}),e.jsx($,{item:!0,xs:6,children:e.jsxs(de,{fullWidth:!0,children:[e.jsx(ue,{id:"payment-method-label",size:"small",children:"طريقة الدفع الرئيسية"}),e.jsx(le,{labelId:"payment-method-label",label:"طريقة الدفع الرئيسية",size:"small",name:"paymentMethod",value:w||(A.length>0?A[0].paymentMethodID:""),onChange:a=>E(a.target.value),children:A.map(a=>e.jsx(X,{value:a.paymentMethodID,children:a.paymentMethodName},a.paymentMethodID))})]})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(k,{fullWidth:!0,label:"اسم الحساب البنكي",value:x,onChange:a=>b(a.target.value),margin:"normal"}),e.jsx(k,{fullWidth:!0,label:"رقم الحساب البنكي",value:M,onChange:a=>I(a.target.value),margin:"normal"})]}),e.jsx(k,{fullWidth:!0,label:"ملاحظات",value:D,onChange:a=>R(a.target.value),multiline:!0,rows:3,margin:"normal"}),e.jsx(K,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx(he,{size:24,color:"inherit",sx:{marginRight:1}}),"قيد التعديل"]}):"تعديل"})]})})})};ge.propTypes={open:m.bool.isRequired,onClose:m.func.isRequired,reloadSafesList:m.func.isRequired,safe:m.object};const se=(i,o,c)=>o[c]<i[c]?-1:o[c]>i[c]?1:0,ot=(i,o)=>i==="desc"?(c,t)=>se(c,t,o):(c,t)=>-se(c,t,o),lt=(i,o)=>{const c=i.map((t,u)=>[t,u]);return c.sort((t,u)=>{const h=o(t[0],u[0]);return h!==0?h:t[1]-u[1]}),c.map(t=>t[0])},je=({rows:i,reloadSafesList:o})=>{const c=ke();Ie();const[t,u]=s.useState("asc"),[h,v]=s.useState("safeID"),[r,d]=s.useState([]),[f,x]=s.useState(0),[b,M]=s.useState(5),[I,D]=s.useState(null),[R,T]=s.useState(!1),[B,A]=s.useState(!1),[q,w]=s.useState(""),[E,L]=s.useState("success"),[y,F]=s.useState(i),[H,W]=s.useState(!1);console.log("Initial rows:",i),s.useEffect(()=>{F(i)},[i]);const G=De.useMemo(()=>Ne({},Be,c,{direction:"rtl"}),[c]),a=(l,S)=>{u(h===S&&t==="asc"?"desc":"asc"),v(S)},p=async()=>{try{await Re(I);const l=y.filter(S=>S.safeID!==I);F(l),w("تم حذف الخزنة بنجاح"),L("success"),o()}catch(l){console.error("Error deleting safe:",l),w(l.message||"Error deleting safe"),L("error")}finally{A(!0),T(!1),D(null)}},n=l=>{if(l.target.checked){const S=y.map(C=>C.safeName);d(S)}else d([])},g=(l,S)=>{const C=r.indexOf(S);let N=[];C===-1?N=N.concat(r,S):C===0?N=N.concat(r.slice(1)):C===r.length-1?N=N.concat(r.slice(0,-1)):C>0&&(N=N.concat(r.slice(0,C),r.slice(C+1))),d(N)},z=(l,S)=>{x(S)},U=l=>{M(parseInt(l.target.value,10)),x(0)},Se=l=>r.indexOf(l)!==-1,ee=f>0?Math.max(0,(1+f)*b-y.length):0;return e.jsxs(Te,{theme:G,children:[e.jsxs(ne,{content:!1,children:[e.jsx(Ye,{children:e.jsxs(Je,{sx:{minWidth:750},"aria-labelledby":"tableTitle",children:[e.jsx(pe,{numSelected:r.length,order:t,orderBy:h,onSelectAllClick:n,onRequestSort:a,rowCount:y.length,selected:r}),e.jsxs(Qe,{children:[y.length===0?e.jsx(V,{children:e.jsx(j,{colSpan:12,align:"center",children:"لا توجد خزائن مضافة"})}):lt(y,ot(t,h)).slice(f*b,f*b+b).map((l,S)=>{if(typeof l=="number")return null;const C=Se(l.safeName),N=`enhanced-table-checkbox-${S}`;return e.jsxs(V,{hover:!0,role:"checkbox","aria-checked":C,tabIndex:-1,selected:C,children:[e.jsx(j,{padding:"checkbox",sx:{pl:3},onClick:be=>g(be,l.safeName),children:e.jsx(fe,{color:"primary",checked:C,inputProps:{"aria-labelledby":N}})}),e.jsx(j,{children:e.jsxs(P,{variant:"h5",align:"center",children:["#",l.safeID]})}),e.jsx(j,{align:"center",children:e.jsx(P,{variant:"subtitle1",children:l.safeName})}),e.jsx(j,{align:"center",children:l.safeACC}),e.jsx(j,{children:e.jsx(P,{variant:"body2",children:l.safeNote})}),e.jsx(j,{align:"center",children:e.jsx(P,{variant:"subtitle1",children:l.safeBankN})}),e.jsx(j,{align:"center",children:e.jsx(P,{variant:"subtitle1",children:l.safeBankA})}),e.jsx(j,{align:"center",children:e.jsx(P,{variant:"subtitle1",children:l.SafeBank})}),e.jsx(j,{align:"center",sx:{pr:3},children:e.jsxs(Z,{direction:"row",alignItems:"center",spacing:1,justifyContent:"center",children:[e.jsx(O,{title:"مشاهدة",children:e.jsx(_,{color:"primary",component:Me,to:`/apps/safe/details/${l.safeID}`,size:"small","aria-label":"View",children:e.jsx($e,{sx:{fontSize:"1.3rem"}})})}),e.jsx(O,{title:"تعديل",children:e.jsx(_,{color:"secondary",size:"small","aria-label":"Edit",onClick:()=>{D(l),W(!0)},children:e.jsx(_e,{sx:{fontSize:"1.3rem"}})})}),e.jsx(O,{title:"حذف",children:e.jsx(_,{color:"error",size:"small","aria-label":"Delete",onClick:()=>{D(l.safeID),T(!0)},children:e.jsx(Ue,{sx:{fontSize:"1.3rem"}})})})]})})]},S)}),y.length>0&&ee>0&&e.jsx(V,{sx:{height:53*ee},children:e.jsx(j,{colSpan:10})})]})]})}),e.jsx(Ze,{rowsPerPageOptions:[5,10,25],component:"div",count:y.length,rowsPerPage:b,page:f,onPageChange:z,onRowsPerPageChange:U}),e.jsxs(et,{open:R,onClose:()=>T(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(at,{id:"alert-dialog-title",children:"حذف الخزنة"}),e.jsx(tt,{children:e.jsx(nt,{id:"alert-dialog-description",children:"هل انت متاكد من حذف الخزنة؟"})}),e.jsxs(st,{children:[e.jsx(K,{onClick:()=>T(!1),color:"primary",children:"الغاء"}),e.jsx(K,{onClick:p,color:"primary",autoFocus:!0,children:"حذف"})]})]})]}),e.jsx(Ae,{open:B,autoHideDuration:6e3,onClose:()=>A(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Pe,{onClose:()=>A(!1),severity:E,sx:{width:"100%"},children:q})}),e.jsx(ge,{open:H,onClose:()=>W(!1),safe:I,reloadSafesList:o})]})};je.propTypes={rows:m.array.isRequired,reloadSafesList:m.func.isRequired};const Rt=()=>{const{status:i}=we(),[o,c]=s.useState([]),[t,u]=s.useState([]),h=async()=>{try{console.log("Fetching safes...");const r=await Le();console.log("Safes fetched successfully:",r),c(r.safes)}catch(r){console.error("Error fetching safes:",r)}};s.useEffect(()=>{h()},[]);const v=()=>{h()};return s.useEffect(()=>{o&&u(o)},[o,i]),e.jsxs(ne,{content:!1,children:[e.jsx(Ee,{children:e.jsx(rt,{originalRows:t,setRows:u,reloadSafesList:v})}),e.jsx(je,{rows:t,reloadSafesList:v})]})};export{Rt as default};
